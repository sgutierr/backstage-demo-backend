{"version":3,"file":"ScaffolderEntitiesProcessor-021c5dcb.cjs.js","sources":["../../src/scaffolder/actions/builtin/catalog/register.ts","../../src/scaffolder/actions/builtin/catalog/write.ts","../../src/scaffolder/actions/builtin/catalog/fetch.ts","../../src/scaffolder/actions/builtin/debug/log.ts","../../src/scaffolder/actions/builtin/debug/wait.ts","../../src/scaffolder/actions/builtin/fetch/helpers.ts","../../src/scaffolder/actions/builtin/fetch/plain.ts","../../src/scaffolder/actions/builtin/fetch/plainFile.ts","../../src/lib/templating/SecureTemplater.ts","../../src/scaffolder/actions/builtin/publish/util.ts","../../src/lib/templating/filters.ts","../../src/scaffolder/actions/builtin/fetch/template.ts","../../src/scaffolder/actions/builtin/filesystem/delete.ts","../../src/scaffolder/actions/builtin/filesystem/rename.ts","../../src/scaffolder/actions/builtin/helpers.ts","../../src/scaffolder/actions/builtin/github/helpers.ts","../../src/scaffolder/actions/builtin/github/githubActionsDispatch.ts","../../src/scaffolder/actions/builtin/github/githubIssuesLabel.ts","../../src/scaffolder/actions/builtin/github/inputProperties.ts","../../src/scaffolder/actions/builtin/github/outputProperties.ts","../../src/scaffolder/actions/builtin/github/githubRepoCreate.ts","../../src/scaffolder/actions/builtin/github/githubRepoPush.ts","../../src/scaffolder/actions/builtin/github/githubWebhook.ts","../../src/scaffolder/actions/builtin/publish/azure.ts","../../src/scaffolder/actions/builtin/publish/bitbucket.ts","../../src/scaffolder/actions/builtin/publish/bitbucketCloud.ts","../../src/scaffolder/actions/builtin/publish/bitbucketServer.ts","../../src/scaffolder/actions/builtin/publish/gerrit.ts","../../src/scaffolder/actions/builtin/publish/gerritReview.ts","../../src/scaffolder/actions/builtin/publish/github.ts","../../src/lib/files/serializeDirectoryContents.ts","../../src/lib/files/deserializeDirectoryContents.ts","../../src/scaffolder/actions/builtin/publish/githubPullRequest.ts","../../src/scaffolder/actions/builtin/publish/gitlab.ts","../../src/scaffolder/actions/builtin/publish/gitlabMergeRequest.ts","../../src/scaffolder/actions/builtin/createBuiltinActions.ts","../../src/scaffolder/actions/TemplateActionRegistry.ts","../../src/scaffolder/tasks/DatabaseTaskStore.ts","../../src/scaffolder/tasks/StorageTaskBroker.ts","../../src/scaffolder/tasks/helper.ts","../../src/util/metrics.ts","../../src/service/rules.ts","../../src/scaffolder/tasks/NunjucksWorkflowRunner.ts","../../src/scaffolder/tasks/TaskWorker.ts","../../src/scaffolder/dryrun/DecoratedActionsRegistry.ts","../../src/scaffolder/dryrun/createDryRunner.ts","../../src/service/helpers.ts","../../src/service/router.ts","../../src/processor/ScaffolderEntitiesProcessor.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputError } from '@backstage/errors';\nimport { ScmIntegrations } from '@backstage/integration';\nimport { CatalogApi } from '@backstage/catalog-client';\nimport { stringifyEntityRef } from '@backstage/catalog-model';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport yaml from 'yaml';\n\nconst id = 'catalog:register';\n\nconst examples = [\n  {\n    description: 'Register with the catalog',\n    example: yaml.stringify({\n      steps: [\n        {\n          action: id,\n          id: 'register-with-catalog',\n          name: 'Register with the catalog',\n          input: {\n            catalogInfoUrl:\n              'http://github.com/backstage/backstage/blob/master/catalog-info.yaml',\n          },\n        },\n      ],\n    }),\n  },\n];\n\n/**\n * Registers entities from a catalog descriptor file in the workspace into the software catalog.\n * @public\n */\nexport function createCatalogRegisterAction(options: {\n  catalogClient: CatalogApi;\n  integrations: ScmIntegrations;\n}) {\n  const { catalogClient, integrations } = options;\n\n  return createTemplateAction<\n    | { catalogInfoUrl: string; optional?: boolean }\n    | { repoContentsUrl: string; catalogInfoPath?: string; optional?: boolean }\n  >({\n    id,\n    description:\n      'Registers entities from a catalog descriptor file in the workspace into the software catalog.',\n    examples,\n    schema: {\n      input: {\n        oneOf: [\n          {\n            type: 'object',\n            required: ['catalogInfoUrl'],\n            properties: {\n              catalogInfoUrl: {\n                title: 'Catalog Info URL',\n                description:\n                  'An absolute URL pointing to the catalog info file location',\n                type: 'string',\n              },\n              optional: {\n                title: 'Optional',\n                description:\n                  'Permit the registered location to optionally exist. Default: false',\n                type: 'boolean',\n              },\n            },\n          },\n          {\n            type: 'object',\n            required: ['repoContentsUrl'],\n            properties: {\n              repoContentsUrl: {\n                title: 'Repository Contents URL',\n                description:\n                  'An absolute URL pointing to the root of a repository directory tree',\n                type: 'string',\n              },\n              catalogInfoPath: {\n                title: 'Fetch URL',\n                description:\n                  'A relative path from the repo root pointing to the catalog info file, defaults to /catalog-info.yaml',\n                type: 'string',\n              },\n              optional: {\n                title: 'Optional',\n                description:\n                  'Permit the registered location to optionally exist. Default: false',\n                type: 'boolean',\n              },\n            },\n          },\n        ],\n      },\n      output: {\n        type: 'object',\n        required: ['catalogInfoUrl'],\n        properties: {\n          entityRef: {\n            type: 'string',\n          },\n          catalogInfoUrl: {\n            type: 'string',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const { input } = ctx;\n\n      let catalogInfoUrl;\n      if ('catalogInfoUrl' in input) {\n        catalogInfoUrl = input.catalogInfoUrl;\n      } else {\n        const { repoContentsUrl, catalogInfoPath = '/catalog-info.yaml' } =\n          input;\n        const integration = integrations.byUrl(repoContentsUrl);\n        if (!integration) {\n          throw new InputError(\n            `No integration found for host ${repoContentsUrl}`,\n          );\n        }\n\n        catalogInfoUrl = integration.resolveUrl({\n          base: repoContentsUrl,\n          url: catalogInfoPath,\n        });\n      }\n\n      ctx.logger.info(`Registering ${catalogInfoUrl} in the catalog`);\n\n      await catalogClient.addLocation(\n        {\n          type: 'url',\n          target: catalogInfoUrl,\n        },\n        ctx.secrets?.backstageToken\n          ? { token: ctx.secrets.backstageToken }\n          : {},\n      );\n\n      try {\n        const result = await catalogClient.addLocation(\n          {\n            dryRun: true,\n            type: 'url',\n            target: catalogInfoUrl,\n          },\n          ctx.secrets?.backstageToken\n            ? { token: ctx.secrets.backstageToken }\n            : {},\n        );\n\n        if (result.entities.length > 0) {\n          const { entities } = result;\n          let entity: any;\n          // prioritise 'Component' type as it is the most central kind of entity\n          entity = entities.find(\n            (e: any) =>\n              !e.metadata.name.startsWith('generated-') &&\n              e.kind === 'Component',\n          );\n          if (!entity) {\n            entity = entities.find(\n              (e: any) => !e.metadata.name.startsWith('generated-'),\n            );\n          }\n          if (!entity) {\n            entity = entities[0];\n          }\n\n          ctx.output('entityRef', stringifyEntityRef(entity));\n        }\n      } catch (e) {\n        if (!input.optional) {\n          throw e;\n        }\n      }\n\n      ctx.output('catalogInfoUrl', catalogInfoUrl);\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fs from 'fs-extra';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport * as yaml from 'yaml';\nimport { resolveSafeChildPath } from '@backstage/backend-common';\nimport { z } from 'zod';\n\nconst id = 'catalog:write';\n\nconst examples = [\n  {\n    description: 'Write a catalog yaml file',\n    example: yaml.stringify({\n      steps: [\n        {\n          action: id,\n          id: 'create-catalog-info-file',\n          name: 'Create catalog file',\n          input: {\n            entity: {\n              apiVersion: 'backstage.io/v1alpha1',\n              kind: 'Component',\n              metadata: {\n                name: 'test',\n                annotations: {},\n              },\n              spec: {\n                type: 'service',\n                lifecycle: 'production',\n                owner: 'default/owner',\n              },\n            },\n          },\n        },\n      ],\n    }),\n  },\n];\n\n/**\n * Writes a catalog descriptor file containing the provided entity to a path in the workspace.\n * @public\n */\n\nexport function createCatalogWriteAction() {\n  return createTemplateAction({\n    id,\n    description: 'Writes the catalog-info.yaml for your template',\n    schema: {\n      input: z.object({\n        filePath: z\n          .string()\n          .optional()\n          .describe('Defaults to catalog-info.yaml'),\n        // TODO: this should reference an zod entity validator if it existed.\n        entity: z\n          .record(z.any())\n          .describe(\n            'You can provide the same values used in the Entity schema.',\n          ),\n      }),\n    },\n    examples,\n    supportsDryRun: true,\n    async handler(ctx) {\n      ctx.logStream.write(`Writing catalog-info.yaml`);\n      const { filePath, entity } = ctx.input;\n      const path = filePath ?? 'catalog-info.yaml';\n\n      await fs.writeFile(\n        resolveSafeChildPath(ctx.workspacePath, path),\n        yaml.stringify(entity),\n      );\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CatalogApi } from '@backstage/catalog-client';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport yaml from 'yaml';\nimport { z } from 'zod';\nimport { parseEntityRef, stringifyEntityRef } from '@backstage/catalog-model';\n\nconst id = 'catalog:fetch';\n\nconst examples = [\n  {\n    description: 'Fetch entity by reference',\n    example: yaml.stringify({\n      steps: [\n        {\n          action: id,\n          id: 'fetch',\n          name: 'Fetch catalog entity',\n          input: {\n            entityRef: 'component:default/name',\n          },\n        },\n      ],\n    }),\n  },\n  {\n    description: 'Fetch multiple entities by referencse',\n    example: yaml.stringify({\n      steps: [\n        {\n          action: id,\n          id: 'fetchMultiple',\n          name: 'Fetch catalog entities',\n          input: {\n            entityRefs: ['component:default/name'],\n          },\n        },\n      ],\n    }),\n  },\n];\n\n/**\n * Returns entity or entities from the catalog by entity reference(s).\n *\n * @public\n */\nexport function createFetchCatalogEntityAction(options: {\n  catalogClient: CatalogApi;\n}) {\n  const { catalogClient } = options;\n\n  return createTemplateAction({\n    id,\n    description:\n      'Returns entity or entities from the catalog by entity reference(s)',\n    examples,\n    supportsDryRun: true,\n    schema: {\n      input: z.object({\n        entityRef: z\n          .string({\n            description: 'Entity reference of the entity to get',\n          })\n          .optional(),\n        entityRefs: z\n          .array(z.string(), {\n            description: 'Entity references of the entities to get',\n          })\n          .optional(),\n        optional: z\n          .boolean({\n            description:\n              'Allow the entity or entities to optionally exist. Default: false',\n          })\n          .optional(),\n        defaultKind: z.string({ description: 'The default kind' }).optional(),\n        defaultNamespace: z\n          .string({ description: 'The default namespace' })\n          .optional(),\n      }),\n      output: z.object({\n        entity: z\n          .any({\n            description:\n              'Object containing same values used in the Entity schema. Only when used with `entityRef` parameter.',\n          })\n          .optional(),\n        entities: z\n          .array(\n            z.any({\n              description:\n                'Array containing objects with same values used in the Entity schema. Only when used with `entityRefs` parameter.',\n            }),\n          )\n          .optional(),\n      }),\n    },\n    async handler(ctx) {\n      const { entityRef, entityRefs, optional, defaultKind, defaultNamespace } =\n        ctx.input;\n      if (!entityRef && !entityRefs) {\n        if (optional) {\n          return;\n        }\n        throw new Error('Missing entity reference or references');\n      }\n\n      if (entityRef) {\n        const entity = await catalogClient.getEntityByRef(\n          stringifyEntityRef(\n            parseEntityRef(entityRef, { defaultKind, defaultNamespace }),\n          ),\n          {\n            token: ctx.secrets?.backstageToken,\n          },\n        );\n\n        if (!entity && !optional) {\n          throw new Error(`Entity ${entityRef} not found`);\n        }\n        ctx.output('entity', entity ?? null);\n      }\n\n      if (entityRefs) {\n        const entities = await catalogClient.getEntitiesByRefs(\n          {\n            entityRefs: entityRefs.map(ref =>\n              stringifyEntityRef(\n                parseEntityRef(ref, { defaultKind, defaultNamespace }),\n              ),\n            ),\n          },\n          {\n            token: ctx.secrets?.backstageToken,\n          },\n        );\n\n        const finalEntities = entities.items.map((e, i) => {\n          if (!e && !optional) {\n            throw new Error(`Entity ${entityRefs[i]} not found`);\n          }\n          return e ?? null;\n        });\n\n        ctx.output('entities', finalEntities);\n      }\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { readdir, stat } from 'fs-extra';\nimport { relative, join } from 'path';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport yaml from 'yaml';\n\nconst id = 'debug:log';\n\nconst examples = [\n  {\n    description: 'Write a debug message',\n    example: yaml.stringify({\n      steps: [\n        {\n          action: id,\n          id: 'write-debug-line',\n          name: 'Write \"Hello Backstage!\" log line',\n          input: {\n            message: 'Hello Backstage!',\n          },\n        },\n      ],\n    }),\n  },\n  {\n    description: 'List the workspace directory',\n    example: yaml.stringify({\n      steps: [\n        {\n          action: id,\n          id: 'write-workspace-directory',\n          name: 'List the workspace directory',\n          input: {\n            listWorkspace: true,\n          },\n        },\n      ],\n    }),\n  },\n];\n\n/**\n * Writes a message into the log or lists all files in the workspace\n *\n * @remarks\n *\n * This task is useful for local development and testing of both the scaffolder\n * and scaffolder templates.\n *\n * @public\n */\nexport function createDebugLogAction() {\n  return createTemplateAction<{ message?: string; listWorkspace?: boolean }>({\n    id,\n    description:\n      'Writes a message into the log or lists all files in the workspace.',\n    examples,\n    schema: {\n      input: {\n        type: 'object',\n        properties: {\n          message: {\n            title: 'Message to output.',\n            type: 'string',\n          },\n          listWorkspace: {\n            title: 'List all files in the workspace, if true.',\n            type: 'boolean',\n          },\n          extra: {\n            title: 'Extra info',\n          },\n        },\n      },\n    },\n    supportsDryRun: true,\n    async handler(ctx) {\n      ctx.logger.info(JSON.stringify(ctx.input, null, 2));\n\n      if (ctx.input?.message) {\n        ctx.logStream.write(ctx.input.message);\n      }\n\n      if (ctx.input?.listWorkspace) {\n        const files = await recursiveReadDir(ctx.workspacePath);\n        ctx.logStream.write(\n          `Workspace:\\n${files\n            .map(f => `  - ${relative(ctx.workspacePath, f)}`)\n            .join('\\n')}`,\n        );\n      }\n    },\n  });\n}\n\nexport async function recursiveReadDir(dir: string): Promise<string[]> {\n  const subdirs = await readdir(dir);\n  const files = await Promise.all(\n    subdirs.map(async subdir => {\n      const res = join(dir, subdir);\n      return (await stat(res)).isDirectory() ? recursiveReadDir(res) : [res];\n    }),\n  );\n  return files.reduce((a, f) => a.concat(f), []);\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { HumanDuration } from '@backstage/types';\nimport yaml from 'yaml';\nimport { Duration } from 'luxon';\n\nconst id = 'debug:wait';\n\nconst MAX_WAIT_TIME_IN_ISO = 'T00:00:30';\n\nconst examples = [\n  {\n    description: 'Waiting for 5 seconds',\n    example: yaml.stringify({\n      steps: [\n        {\n          action: id,\n          id: 'wait-5sec',\n          name: 'Waiting for 5 seconds',\n          input: {\n            seconds: 5,\n          },\n        },\n      ],\n    }),\n  },\n  {\n    description: 'Waiting for 5 minutes',\n    example: yaml.stringify({\n      steps: [\n        {\n          action: id,\n          id: 'wait-5min',\n          name: 'Waiting for 5 minutes',\n          input: {\n            minutes: 5,\n          },\n        },\n      ],\n    }),\n  },\n];\n\n/**\n * Waits for a certain period of time.\n *\n * @remarks\n *\n * This task is useful to give some waiting time for manual intervention.\n * Has to be used in a combination with other actions.\n *\n * @public\n */\nexport function createWaitAction(options?: {\n  maxWaitTime?: Duration | HumanDuration;\n}) {\n  const toDuration = (\n    maxWaitTime: Duration | HumanDuration | undefined,\n  ): Duration => {\n    if (maxWaitTime) {\n      if (maxWaitTime instanceof Duration) {\n        return maxWaitTime;\n      }\n      return Duration.fromObject(maxWaitTime);\n    }\n    return Duration.fromISOTime(MAX_WAIT_TIME_IN_ISO);\n  };\n\n  return createTemplateAction<HumanDuration>({\n    id,\n    description: 'Waits for a certain period of time.',\n    examples,\n    schema: {\n      input: {\n        type: 'object',\n        properties: {\n          minutes: {\n            title: 'Waiting period in minutes.',\n            type: 'number',\n          },\n          seconds: {\n            title: 'Waiting period in seconds.',\n            type: 'number',\n          },\n          milliseconds: {\n            title: 'Waiting period in milliseconds.',\n            type: 'number',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const delayTime = Duration.fromObject(ctx.input);\n      const maxWait = toDuration(options?.maxWaitTime);\n\n      if (delayTime.minus(maxWait).toMillis() > 0) {\n        throw new Error(\n          `Waiting duration is longer than the maximum threshold of ${maxWait.toHuman()}`,\n        );\n      }\n\n      await new Promise(resolve => {\n        const controller = new AbortController();\n        const timeoutHandle = setTimeout(abort, delayTime.toMillis());\n        ctx.signal?.addEventListener('abort', abort);\n\n        function abort() {\n          ctx.signal?.removeEventListener('abort', abort);\n          clearTimeout(timeoutHandle!);\n          controller.abort();\n          resolve('finished');\n        }\n      });\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { resolveSafeChildPath, UrlReader } from '@backstage/backend-common';\nimport { InputError } from '@backstage/errors';\nimport { ScmIntegrations } from '@backstage/integration';\nimport fs from 'fs-extra';\nimport path from 'path';\n\n/**\n * A helper function that reads the contents of a directory from the given URL.\n * Can be used in your own actions, and also used behind fetch:template and fetch:plain\n *\n * @public\n */\nexport async function fetchContents(options: {\n  reader: UrlReader;\n  integrations: ScmIntegrations;\n  baseUrl?: string;\n  fetchUrl?: string;\n  outputPath: string;\n}) {\n  const { reader, integrations, baseUrl, fetchUrl = '.', outputPath } = options;\n\n  const fetchUrlIsAbsolute = isFetchUrlAbsolute(fetchUrl);\n\n  // We handle both file locations and url ones\n  if (!fetchUrlIsAbsolute && baseUrl?.startsWith('file://')) {\n    const basePath = baseUrl.slice('file://'.length);\n    const srcDir = resolveSafeChildPath(path.dirname(basePath), fetchUrl);\n    await fs.copy(srcDir, outputPath);\n  } else {\n    const readUrl = getReadUrl(fetchUrl, baseUrl, integrations);\n\n    const res = await reader.readTree(readUrl);\n    await fs.ensureDir(outputPath);\n    await res.dir({ targetDir: outputPath });\n  }\n}\n\n/**\n * A helper function that reads the content of a single file from the given URL.\n * Can be used in your own actions, and also used behind `fetch:plain:file`\n */\nexport async function fetchFile(options: {\n  reader: UrlReader;\n  integrations: ScmIntegrations;\n  baseUrl?: string;\n  fetchUrl?: string;\n  outputPath: string;\n}) {\n  const { reader, integrations, baseUrl, fetchUrl = '.', outputPath } = options;\n\n  const fetchUrlIsAbsolute = isFetchUrlAbsolute(fetchUrl);\n\n  // We handle both file locations and url ones\n  if (!fetchUrlIsAbsolute && baseUrl?.startsWith('file://')) {\n    const basePath = baseUrl.slice('file://'.length);\n    const src = resolveSafeChildPath(path.dirname(basePath), fetchUrl);\n    await fs.copyFile(src, outputPath);\n  } else {\n    const readUrl = getReadUrl(fetchUrl, baseUrl, integrations);\n\n    const res = await reader.readUrl(readUrl);\n    await fs.ensureDir(path.dirname(outputPath));\n    const buffer = await res.buffer();\n    await fs.outputFile(outputPath, buffer.toString());\n  }\n}\n\nfunction isFetchUrlAbsolute(fetchUrl: string) {\n  let fetchUrlIsAbsolute = false;\n  try {\n    // eslint-disable-next-line no-new\n    new URL(fetchUrl);\n    fetchUrlIsAbsolute = true;\n  } catch {\n    /* ignored */\n  }\n  return fetchUrlIsAbsolute;\n}\n\nfunction getReadUrl(\n  fetchUrl: string,\n  baseUrl: string | undefined,\n  integrations: ScmIntegrations,\n) {\n  if (isFetchUrlAbsolute(fetchUrl)) {\n    return fetchUrl;\n  } else if (baseUrl) {\n    const integration = integrations.byUrl(baseUrl);\n    if (!integration) {\n      throw new InputError(`No integration found for location ${baseUrl}`);\n    }\n\n    return integration.resolveUrl({\n      url: fetchUrl,\n      base: baseUrl,\n    });\n  }\n  throw new InputError(\n    `Failed to fetch, template location could not be determined and the fetch URL is relative, ${fetchUrl}`,\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { UrlReader, resolveSafeChildPath } from '@backstage/backend-common';\nimport { ScmIntegrations } from '@backstage/integration';\nimport { fetchContents } from './helpers';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\n\n/**\n * Downloads content and places it in the workspace, or optionally\n * in a subdirectory specified by the 'targetPath' input option.\n * @public\n */\nexport function createFetchPlainAction(options: {\n  reader: UrlReader;\n  integrations: ScmIntegrations;\n}) {\n  const { reader, integrations } = options;\n\n  return createTemplateAction<{ url: string; targetPath?: string }>({\n    id: 'fetch:plain',\n    description:\n      'Downloads content and places it in the workspace, or optionally in a subdirectory specified by the `targetPath` input option.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['url'],\n        properties: {\n          url: {\n            title: 'Fetch URL',\n            description:\n              'Relative path or absolute URL pointing to the directory tree to fetch',\n            type: 'string',\n          },\n          targetPath: {\n            title: 'Target Path',\n            description:\n              'Target path within the working directory to download the contents to.',\n            type: 'string',\n          },\n        },\n      },\n    },\n    supportsDryRun: true,\n    async handler(ctx) {\n      ctx.logger.info('Fetching plain content from remote URL');\n\n      // Finally move the template result into the task workspace\n      const targetPath = ctx.input.targetPath ?? './';\n      const outputPath = resolveSafeChildPath(ctx.workspacePath, targetPath);\n\n      await fetchContents({\n        reader,\n        integrations,\n        baseUrl: ctx.templateInfo?.baseUrl,\n        fetchUrl: ctx.input.url,\n        outputPath,\n      });\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { UrlReader, resolveSafeChildPath } from '@backstage/backend-common';\nimport { ScmIntegrations } from '@backstage/integration';\nimport { fetchFile } from './helpers';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\n\n/**\n * Downloads content and places it in the workspace, or optionally\n * in a subdirectory specified by the 'targetPath' input option.\n * @public\n */\nexport function createFetchPlainFileAction(options: {\n  reader: UrlReader;\n  integrations: ScmIntegrations;\n}) {\n  const { reader, integrations } = options;\n\n  return createTemplateAction<{ url: string; targetPath: string }>({\n    id: 'fetch:plain:file',\n    description: 'Downloads single file and places it in the workspace.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['url', 'targetPath'],\n        properties: {\n          url: {\n            title: 'Fetch URL',\n            description:\n              'Relative path or absolute URL pointing to the single file to fetch.',\n            type: 'string',\n          },\n          targetPath: {\n            title: 'Target Path',\n            description:\n              'Target path within the working directory to download the file as.',\n            type: 'string',\n          },\n        },\n      },\n    },\n    supportsDryRun: true,\n    async handler(ctx) {\n      ctx.logger.info('Fetching plain content from remote URL');\n\n      // Finally move the template result into the task workspace\n      const outputPath = resolveSafeChildPath(\n        ctx.workspacePath,\n        ctx.input.targetPath,\n      );\n\n      await fetchFile({\n        reader,\n        integrations,\n        baseUrl: ctx.templateInfo?.baseUrl,\n        fetchUrl: ctx.input.url,\n        outputPath,\n      });\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { VM } from 'vm2';\nimport { resolvePackagePath } from '@backstage/backend-common';\nimport fs from 'fs-extra';\nimport { JsonValue } from '@backstage/types';\n\n// language=JavaScript\nconst mkScript = (nunjucksSource: string) => `\nconst { render, renderCompat } = (() => {\n  const module = {};\n  const process = { env: {} };\n  const require = (pkg) => { if (pkg === 'events') { return function (){}; }};\n\n  ${nunjucksSource}\n\n  const env = module.exports.configure({\n    autoescape: false,\n    tags: {\n      variableStart: '\\${{',\n      variableEnd: '}}',\n    },\n  });\n\n  const compatEnv = module.exports.configure({\n    autoescape: false,\n    tags: {\n      variableStart: '{{',\n      variableEnd: '}}',\n    },\n  });\n  compatEnv.addFilter('jsonify', compatEnv.getFilter('dump'));\n\n  if (typeof templateFilters !== 'undefined') {\n    for (const [filterName, filterFn] of Object.entries(templateFilters)) {\n      env.addFilter(filterName, (...args) => JSON.parse(filterFn(...args)));\n    }\n  }\n\n  if (typeof templateGlobals !== 'undefined') {\n    for (const [globalName, global] of Object.entries(templateGlobals)) {\n      if (typeof global === 'function') {\n        env.addGlobal(globalName, (...args) => JSON.parse(global(...args)));\n      } else {\n        env.addGlobal(globalName, JSON.parse(global));\n      }\n    }\n  }\n\n  let uninstallCompat = undefined;\n\n  function render(str, values) {\n    try {\n      if (uninstallCompat) {\n        uninstallCompat();\n        uninstallCompat = undefined;\n      }\n      return env.renderString(str, JSON.parse(values));\n    } catch (error) {\n      // Make sure errors don't leak anything\n      throw new Error(String(error.message));\n    }\n  }\n\n  function renderCompat(str, values) {\n    try {\n      if (!uninstallCompat) {\n        uninstallCompat = module.exports.installJinjaCompat();\n      }\n      return compatEnv.renderString(str, JSON.parse(values));\n    } catch (error) {\n      // Make sure errors don't leak anything\n      throw new Error(String(error.message));\n    }\n  }\n\n  return { render, renderCompat };\n})();\n`;\n\n/** @public */\nexport type TemplateFilter = (...args: JsonValue[]) => JsonValue | undefined;\n\n/** @public */\nexport type TemplateGlobal =\n  | ((...args: JsonValue[]) => JsonValue | undefined)\n  | JsonValue;\n\nexport interface SecureTemplaterOptions {\n  /* Enables jinja compatibility and the \"jsonify\" filter */\n  cookiecutterCompat?: boolean;\n  /* Extra user-provided nunjucks filters */\n  templateFilters?: Record<string, TemplateFilter>;\n  /* Extra user-provided nunjucks globals */\n  templateGlobals?: Record<string, TemplateGlobal>;\n}\n\nexport type SecureTemplateRenderer = (\n  template: string,\n  values: unknown,\n) => string;\n\nexport class SecureTemplater {\n  static async loadRenderer(options: SecureTemplaterOptions = {}) {\n    const { cookiecutterCompat, templateFilters, templateGlobals } = options;\n    const sandbox: Record<string, any> = {};\n\n    if (templateFilters) {\n      sandbox.templateFilters = Object.fromEntries(\n        Object.entries(templateFilters)\n          .filter(([_, filterFunction]) => !!filterFunction)\n          .map(([filterName, filterFunction]) => [\n            filterName,\n            (...args: JsonValue[]) => JSON.stringify(filterFunction(...args)),\n          ]),\n      );\n    }\n    if (templateGlobals) {\n      sandbox.templateGlobals = Object.fromEntries(\n        Object.entries(templateGlobals)\n          .filter(([_, global]) => !!global)\n          .map(([globalName, global]) => {\n            if (typeof global === 'function') {\n              return [\n                globalName,\n                (...args: JsonValue[]) => JSON.stringify(global(...args)),\n              ];\n            }\n            return [globalName, JSON.stringify(global)];\n          }),\n      );\n    }\n    const vm = new VM({ sandbox });\n\n    const nunjucksSource = await fs.readFile(\n      resolvePackagePath(\n        '@backstage/plugin-scaffolder-backend',\n        'assets/nunjucks.js.txt',\n      ),\n      'utf-8',\n    );\n\n    vm.run(mkScript(nunjucksSource));\n\n    const render: SecureTemplateRenderer = (template, values) => {\n      if (!vm) {\n        throw new Error('SecureTemplater has not been initialized');\n      }\n      vm.setGlobal('templateStr', template);\n      vm.setGlobal('templateValues', JSON.stringify(values));\n\n      if (cookiecutterCompat) {\n        return vm.run(`renderCompat(templateStr, templateValues)`);\n      }\n\n      return vm.run(`render(templateStr, templateValues)`);\n    };\n    return render;\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputError } from '@backstage/errors';\nimport { isChildPath } from '@backstage/backend-common';\nimport { join as joinPath, normalize as normalizePath } from 'path';\nimport { ScmIntegrationRegistry } from '@backstage/integration';\n\nexport const getRepoSourceDirectory = (\n  workspacePath: string,\n  sourcePath: string | undefined,\n) => {\n  if (sourcePath) {\n    const safeSuffix = normalizePath(sourcePath).replace(\n      /^(\\.\\.(\\/|\\\\|$))+/,\n      '',\n    );\n    const path = joinPath(workspacePath, safeSuffix);\n    if (!isChildPath(workspacePath, path)) {\n      throw new Error('Invalid source path');\n    }\n    return path;\n  }\n  return workspacePath;\n};\nexport type RepoSpec = {\n  repo: string;\n  host: string;\n  owner?: string;\n  organization?: string;\n  workspace?: string;\n  project?: string;\n};\n\nexport const parseRepoUrl = (\n  repoUrl: string,\n  integrations: ScmIntegrationRegistry,\n): RepoSpec => {\n  let parsed;\n  try {\n    parsed = new URL(`https://${repoUrl}`);\n  } catch (error) {\n    throw new InputError(\n      `Invalid repo URL passed to publisher, got ${repoUrl}, ${error}`,\n    );\n  }\n  const host = parsed.host;\n  const owner = parsed.searchParams.get('owner') ?? undefined;\n  const organization = parsed.searchParams.get('organization') ?? undefined;\n  const workspace = parsed.searchParams.get('workspace') ?? undefined;\n  const project = parsed.searchParams.get('project') ?? undefined;\n\n  const type = integrations.byHost(host)?.type;\n\n  if (!type) {\n    throw new InputError(\n      `No matching integration configuration for host ${host}, please check your integrations config`,\n    );\n  }\n\n  const repo: string = parsed.searchParams.get('repo')!;\n  switch (type) {\n    case 'bitbucket': {\n      if (host === 'www.bitbucket.org') {\n        checkRequiredParams(parsed, 'workspace');\n      }\n      checkRequiredParams(parsed, 'project', 'repo');\n      break;\n    }\n    case 'gitlab': {\n      // project is the projectID, and if defined, owner and repo won't be needed.\n      if (!project) {\n        checkRequiredParams(parsed, 'owner', 'repo');\n      }\n      break;\n    }\n    case 'gerrit': {\n      checkRequiredParams(parsed, 'repo');\n      break;\n    }\n    default: {\n      checkRequiredParams(parsed, 'repo', 'owner');\n      break;\n    }\n  }\n\n  return { host, owner, repo, organization, workspace, project };\n};\nexport const isExecutable = (fileMode: number) => {\n  const executeBitMask = 0o000111;\n  const res = fileMode & executeBitMask;\n  return res > 0;\n};\n\n/**\n * This function checks if the required parameters (given as the `params` argument) are present in the URL\n *\n * @param repoUrl - the URL for the repository\n * @param params - a variadic list of URL query parameter names\n *\n * @throws\n * An InputError exception is thrown if any of the required parameters is not in the URL.\n *\n * @public\n */\nfunction checkRequiredParams(repoUrl: URL, ...params: string[]) {\n  for (let i = 0; i < params.length; i++) {\n    if (!repoUrl.searchParams.get(params[i])) {\n      throw new InputError(\n        `Invalid repo URL passed to publisher: ${repoUrl.toString()}, missing ${\n          params[i]\n        }`,\n      );\n    }\n  }\n}\n","/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { parseEntityRef } from '@backstage/catalog-model';\nimport { ScmIntegrations } from '@backstage/integration';\nimport { JsonValue } from '@backstage/types';\nimport { TemplateFilter } from '..';\nimport { parseRepoUrl } from '../../scaffolder/actions/builtin/publish/util';\nimport get from 'lodash/get';\n\nexport const createDefaultFilters = ({\n  integrations,\n}: {\n  integrations: ScmIntegrations;\n}): Record<string, TemplateFilter> => {\n  return {\n    parseRepoUrl: url => parseRepoUrl(url as string, integrations),\n    parseEntityRef: ref => parseEntityRef(ref as string),\n    pick: (obj: JsonValue, key: JsonValue) => get(obj, key as string),\n    projectSlug: repoUrl => {\n      const { owner, repo } = parseRepoUrl(repoUrl as string, integrations);\n      return `${owner}/${repo}`;\n    },\n  };\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { extname } from 'path';\nimport { resolveSafeChildPath, UrlReader } from '@backstage/backend-common';\nimport { InputError } from '@backstage/errors';\nimport { ScmIntegrations } from '@backstage/integration';\nimport { fetchContents } from './helpers';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport globby from 'globby';\nimport fs from 'fs-extra';\nimport { isBinaryFile } from 'isbinaryfile';\nimport {\n  TemplateFilter,\n  SecureTemplater,\n  TemplateGlobal,\n} from '../../../../lib/templating/SecureTemplater';\nimport { createDefaultFilters } from '../../../../lib/templating/filters';\n\n/**\n * Downloads a skeleton, templates variables into file and directory names and content.\n * Then places the result in the workspace, or optionally in a subdirectory\n * specified by the 'targetPath' input option.\n *\n * @public\n */\nexport function createFetchTemplateAction(options: {\n  reader: UrlReader;\n  integrations: ScmIntegrations;\n  additionalTemplateFilters?: Record<string, TemplateFilter>;\n  additionalTemplateGlobals?: Record<string, TemplateGlobal>;\n}) {\n  const {\n    reader,\n    integrations,\n    additionalTemplateFilters,\n    additionalTemplateGlobals,\n  } = options;\n\n  const defaultTemplateFilters = createDefaultFilters({ integrations });\n\n  return createTemplateAction<{\n    url: string;\n    targetPath?: string;\n    values: any;\n    templateFileExtension?: string | boolean;\n\n    // Cookiecutter compat options\n    /**\n     * @deprecated This field is deprecated in favor of copyWithoutTemplating.\n     */\n    copyWithoutRender?: string[];\n    copyWithoutTemplating?: string[];\n    cookiecutterCompat?: boolean;\n    replace?: boolean;\n  }>({\n    id: 'fetch:template',\n    description:\n      'Downloads a skeleton, templates variables into file and directory names and content, and places the result in the workspace, or optionally in a subdirectory specified by the `targetPath` input option.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['url'],\n        properties: {\n          url: {\n            title: 'Fetch URL',\n            description:\n              'Relative path or absolute URL pointing to the directory tree to fetch',\n            type: 'string',\n          },\n          targetPath: {\n            title: 'Target Path',\n            description:\n              'Target path within the working directory to download the contents to. Defaults to the working directory root.',\n            type: 'string',\n          },\n          values: {\n            title: 'Template Values',\n            description: 'Values to pass on to the templating engine',\n            type: 'object',\n          },\n          copyWithoutRender: {\n            title: '[Deprecated] Copy Without Render',\n            description:\n              'An array of glob patterns. Any files or directories which match are copied without being processed as templates.',\n            type: 'array',\n            items: {\n              type: 'string',\n            },\n          },\n          copyWithoutTemplating: {\n            title: 'Copy Without Templating',\n            description:\n              'An array of glob patterns. Contents of matched files or directories are copied without being processed, but paths are subject to rendering.',\n            type: 'array',\n            items: {\n              type: 'string',\n            },\n          },\n          cookiecutterCompat: {\n            title: 'Cookiecutter compatibility mode',\n            description:\n              'Enable features to maximise compatibility with templates built for fetch:cookiecutter',\n            type: 'boolean',\n          },\n          templateFileExtension: {\n            title: 'Template File Extension',\n            description:\n              'If set, only files with the given extension will be templated. If set to `true`, the default extension `.njk` is used.',\n            type: ['string', 'boolean'],\n          },\n          replace: {\n            title: 'Replace files',\n            description:\n              'If set, replace files in targetPath instead of skipping existing ones.',\n            type: 'boolean',\n          },\n        },\n      },\n    },\n    supportsDryRun: true,\n    async handler(ctx) {\n      ctx.logger.info('Fetching template content from remote URL');\n\n      const workDir = await ctx.createTemporaryDirectory();\n      const templateDir = resolveSafeChildPath(workDir, 'template');\n\n      const targetPath = ctx.input.targetPath ?? './';\n      const outputDir = resolveSafeChildPath(ctx.workspacePath, targetPath);\n      if (ctx.input.copyWithoutRender && ctx.input.copyWithoutTemplating) {\n        throw new InputError(\n          'Fetch action input copyWithoutRender and copyWithoutTemplating can not be used at the same time',\n        );\n      }\n\n      let copyOnlyPatterns: string[] | undefined;\n      let renderFilename: boolean;\n      if (ctx.input.copyWithoutRender) {\n        ctx.logger.warn(\n          '[Deprecated] Please use copyWithoutTemplating instead.',\n        );\n        copyOnlyPatterns = ctx.input.copyWithoutRender;\n        renderFilename = false;\n      } else {\n        copyOnlyPatterns = ctx.input.copyWithoutTemplating;\n        renderFilename = true;\n      }\n\n      if (copyOnlyPatterns && !Array.isArray(copyOnlyPatterns)) {\n        throw new InputError(\n          'Fetch action input copyWithoutRender/copyWithoutTemplating must be an Array',\n        );\n      }\n\n      if (\n        ctx.input.templateFileExtension &&\n        (copyOnlyPatterns || ctx.input.cookiecutterCompat)\n      ) {\n        throw new InputError(\n          'Fetch action input extension incompatible with copyWithoutRender/copyWithoutTemplating and cookiecutterCompat',\n        );\n      }\n\n      let extension: string | false = false;\n      if (ctx.input.templateFileExtension) {\n        extension =\n          ctx.input.templateFileExtension === true\n            ? '.njk'\n            : ctx.input.templateFileExtension;\n        if (!extension.startsWith('.')) {\n          extension = `.${extension}`;\n        }\n      }\n\n      await fetchContents({\n        reader,\n        integrations,\n        baseUrl: ctx.templateInfo?.baseUrl,\n        fetchUrl: ctx.input.url,\n        outputPath: templateDir,\n      });\n\n      ctx.logger.info('Listing files and directories in template');\n      const allEntriesInTemplate = await globby(`**/*`, {\n        cwd: templateDir,\n        dot: true,\n        onlyFiles: false,\n        markDirectories: true,\n        followSymbolicLinks: false,\n      });\n\n      const nonTemplatedEntries = new Set(\n        (\n          await Promise.all(\n            (copyOnlyPatterns || []).map(pattern =>\n              globby(pattern, {\n                cwd: templateDir,\n                dot: true,\n                onlyFiles: false,\n                markDirectories: true,\n                followSymbolicLinks: false,\n              }),\n            ),\n          )\n        ).flat(),\n      );\n\n      // Cookiecutter prefixes all parameters in templates with\n      // `cookiecutter.`. To replicate this, we wrap our parameters\n      // in an object with a `cookiecutter` property when compat\n      // mode is enabled.\n      const { cookiecutterCompat, values } = ctx.input;\n      const context = {\n        [cookiecutterCompat ? 'cookiecutter' : 'values']: values,\n      };\n\n      ctx.logger.info(\n        `Processing ${allEntriesInTemplate.length} template files/directories with input values`,\n        ctx.input.values,\n      );\n\n      const renderTemplate = await SecureTemplater.loadRenderer({\n        cookiecutterCompat: ctx.input.cookiecutterCompat,\n        templateFilters: {\n          ...defaultTemplateFilters,\n          ...additionalTemplateFilters,\n        },\n        templateGlobals: additionalTemplateGlobals,\n      });\n\n      for (const location of allEntriesInTemplate) {\n        let renderContents: boolean;\n\n        let localOutputPath = location;\n        if (extension) {\n          renderContents = extname(localOutputPath) === extension;\n          if (renderContents) {\n            localOutputPath = localOutputPath.slice(0, -extension.length);\n          }\n          // extension is mutual exclusive with copyWithoutRender/copyWithoutTemplating,\n          // therefore the output path is always rendered.\n          localOutputPath = renderTemplate(localOutputPath, context);\n        } else {\n          renderContents = !nonTemplatedEntries.has(location);\n          // The logic here is a bit tangled because it depends on two variables.\n          // If renderFilename is true, which means copyWithoutTemplating is used,\n          // then the path is always rendered.\n          // If renderFilename is false, which means copyWithoutRender is used,\n          // then matched file/directory won't be processed, same as before.\n          if (renderFilename) {\n            localOutputPath = renderTemplate(localOutputPath, context);\n          } else {\n            localOutputPath = renderContents\n              ? renderTemplate(localOutputPath, context)\n              : localOutputPath;\n          }\n        }\n\n        if (containsSkippedContent(localOutputPath)) {\n          continue;\n        }\n\n        const outputPath = resolveSafeChildPath(outputDir, localOutputPath);\n        if (fs.existsSync(outputPath) && !ctx.input.replace) {\n          continue;\n        }\n\n        if (!renderContents && !extension) {\n          ctx.logger.info(\n            `Copying file/directory ${location} without processing.`,\n          );\n        }\n\n        if (location.endsWith('/')) {\n          ctx.logger.info(\n            `Writing directory ${location} to template output path.`,\n          );\n          await fs.ensureDir(outputPath);\n        } else {\n          const inputFilePath = resolveSafeChildPath(templateDir, location);\n          const stats = await fs.promises.lstat(inputFilePath);\n\n          if (stats.isSymbolicLink() || (await isBinaryFile(inputFilePath))) {\n            ctx.logger.info(\n              `Copying file binary or symbolic link at ${location}, to template output path.`,\n            );\n            await fs.copy(inputFilePath, outputPath);\n          } else {\n            const statsObj = await fs.stat(inputFilePath);\n            ctx.logger.info(\n              `Writing file ${location} to template output path with mode ${statsObj.mode}.`,\n            );\n            const inputFileContents = await fs.readFile(inputFilePath, 'utf-8');\n            await fs.outputFile(\n              outputPath,\n              renderContents\n                ? renderTemplate(inputFileContents, context)\n                : inputFileContents,\n              { mode: statsObj.mode },\n            );\n          }\n        }\n      }\n\n      ctx.logger.info(`Template result written to ${outputDir}`);\n    },\n  });\n}\n\nfunction containsSkippedContent(localOutputPath: string): boolean {\n  // if the path is empty means that there is a file skipped in the root\n  // if the path starts with a separator it means that the root directory has been skipped\n  // if the path includes // means that there is a subdirectory skipped\n  // All paths returned are considered with / separator because of globby returning the linux separator for all os'.\n  return (\n    localOutputPath === '' ||\n    localOutputPath.startsWith('/') ||\n    localOutputPath.includes('//')\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { InputError } from '@backstage/errors';\nimport { resolveSafeChildPath } from '@backstage/backend-common';\nimport fs from 'fs-extra';\n\n/**\n * Creates new action that enables deletion of files and directories in the workspace.\n * @public\n */\nexport const createFilesystemDeleteAction = () => {\n  return createTemplateAction<{ files: string[] }>({\n    id: 'fs:delete',\n    description: 'Deletes files and directories from the workspace',\n    schema: {\n      input: {\n        required: ['files'],\n        type: 'object',\n        properties: {\n          files: {\n            title: 'Files',\n            description: 'A list of files and directories that will be deleted',\n            type: 'array',\n            items: {\n              type: 'string',\n            },\n          },\n        },\n      },\n    },\n    supportsDryRun: true,\n    async handler(ctx) {\n      if (!Array.isArray(ctx.input?.files)) {\n        throw new InputError('files must be an Array');\n      }\n\n      for (const file of ctx.input.files) {\n        const filepath = resolveSafeChildPath(ctx.workspacePath, file);\n\n        try {\n          await fs.remove(filepath);\n          ctx.logger.info(`File ${filepath} deleted successfully`);\n        } catch (err) {\n          ctx.logger.error(`Failed to delete file ${filepath}:`, err);\n          throw err;\n        }\n      }\n    },\n  });\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { resolveSafeChildPath } from '@backstage/backend-common';\nimport { InputError } from '@backstage/errors';\nimport fs from 'fs-extra';\n\n/**\n * Creates a new action that allows renames of files and directories in the workspace.\n * @public\n */\nexport const createFilesystemRenameAction = () => {\n  return createTemplateAction<{\n    files: Array<{\n      from: string;\n      to: string;\n      overwrite?: boolean;\n    }>;\n  }>({\n    id: 'fs:rename',\n    description: 'Renames files and directories within the workspace',\n    schema: {\n      input: {\n        required: ['files'],\n        type: 'object',\n        properties: {\n          files: {\n            title: 'Files',\n            description:\n              'A list of file and directory names that will be renamed',\n            type: 'array',\n            items: {\n              type: 'object',\n              required: ['from', 'to'],\n              properties: {\n                from: {\n                  type: 'string',\n                  title: 'The source location of the file to be renamed',\n                },\n                to: {\n                  type: 'string',\n                  title: 'The destination of the new file',\n                },\n                overwrite: {\n                  type: 'boolean',\n                  title:\n                    'Overwrite existing file or directory, default is false',\n                },\n              },\n            },\n          },\n        },\n      },\n    },\n    supportsDryRun: true,\n    async handler(ctx) {\n      if (!Array.isArray(ctx.input?.files)) {\n        throw new InputError('files must be an Array');\n      }\n\n      for (const file of ctx.input.files) {\n        if (!file.from || !file.to) {\n          throw new InputError('each file must have a from and to property');\n        }\n\n        const sourceFilepath = resolveSafeChildPath(\n          ctx.workspacePath,\n          file.from,\n        );\n        const destFilepath = resolveSafeChildPath(ctx.workspacePath, file.to);\n\n        try {\n          await fs.move(sourceFilepath, destFilepath, {\n            overwrite: file.overwrite ?? false,\n          });\n          ctx.logger.info(\n            `File ${sourceFilepath} renamed to ${destFilepath} successfully`,\n          );\n        } catch (err) {\n          ctx.logger.error(\n            `Failed to rename file ${sourceFilepath} to ${destFilepath}:`,\n            err,\n          );\n          throw err;\n        }\n      }\n    },\n  });\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Git } from '@backstage/backend-common';\nimport { Config } from '@backstage/config';\nimport { assertError } from '@backstage/errors';\nimport { spawn, SpawnOptionsWithoutStdio } from 'child_process';\nimport { Octokit } from 'octokit';\nimport { PassThrough, Writable } from 'stream';\nimport { Logger } from 'winston';\n\n/** @public */\nexport type RunCommandOptions = {\n  /** command to run */\n  command: string;\n  /** arguments to pass the command */\n  args: string[];\n  /** options to pass to spawn */\n  options?: SpawnOptionsWithoutStdio;\n  /** stream to capture stdout and stderr output */\n  logStream?: Writable;\n};\n\n/**\n * Run a command in a sub-process, normally a shell command.\n *\n * @public\n */\nexport const executeShellCommand = async (options: RunCommandOptions) => {\n  const {\n    command,\n    args,\n    options: spawnOptions,\n    logStream = new PassThrough(),\n  } = options;\n  await new Promise<void>((resolve, reject) => {\n    const process = spawn(command, args, spawnOptions);\n\n    process.stdout.on('data', stream => {\n      logStream.write(stream);\n    });\n\n    process.stderr.on('data', stream => {\n      logStream.write(stream);\n    });\n\n    process.on('error', error => {\n      return reject(error);\n    });\n\n    process.on('close', code => {\n      if (code !== 0) {\n        return reject(\n          new Error(`Command ${command} failed, exit code: ${code}`),\n        );\n      }\n      return resolve();\n    });\n  });\n};\n\nexport async function initRepoAndPush({\n  dir,\n  remoteUrl,\n  auth,\n  logger,\n  defaultBranch = 'master',\n  commitMessage = 'Initial commit',\n  gitAuthorInfo,\n}: {\n  dir: string;\n  remoteUrl: string;\n  // For use cases where token has to be used with Basic Auth\n  // it has to be provided as password together with a username\n  // which may be a fixed value defined by the provider.\n  auth: { username: string; password: string } | { token: string };\n  logger: Logger;\n  defaultBranch?: string;\n  commitMessage?: string;\n  gitAuthorInfo?: { name?: string; email?: string };\n}): Promise<{ commitHash: string }> {\n  const git = Git.fromAuth({\n    ...auth,\n    logger,\n  });\n\n  await git.init({\n    dir,\n    defaultBranch,\n  });\n\n  await git.add({ dir, filepath: '.' });\n\n  // use provided info if possible, otherwise use fallbacks\n  const authorInfo = {\n    name: gitAuthorInfo?.name ?? 'Scaffolder',\n    email: gitAuthorInfo?.email ?? 'scaffolder@backstage.io',\n  };\n\n  const commitHash = await git.commit({\n    dir,\n    message: commitMessage,\n    author: authorInfo,\n    committer: authorInfo,\n  });\n  await git.addRemote({\n    dir,\n    url: remoteUrl,\n    remote: 'origin',\n  });\n\n  await git.push({\n    dir,\n    remote: 'origin',\n  });\n\n  return { commitHash };\n}\n\nexport async function commitAndPushRepo({\n  dir,\n  auth,\n  logger,\n  commitMessage,\n  gitAuthorInfo,\n  branch = 'master',\n  remoteRef,\n}: {\n  dir: string;\n  // For use cases where token has to be used with Basic Auth\n  // it has to be provided as password together with a username\n  // which may be a fixed value defined by the provider.\n  auth: { username: string; password: string } | { token: string };\n  logger: Logger;\n  commitMessage: string;\n  gitAuthorInfo?: { name?: string; email?: string };\n  branch?: string;\n  remoteRef?: string;\n}): Promise<{ commitHash: string }> {\n  const git = Git.fromAuth({\n    ...auth,\n    logger,\n  });\n\n  await git.fetch({ dir });\n  await git.checkout({ dir, ref: branch });\n  await git.add({ dir, filepath: '.' });\n\n  // use provided info if possible, otherwise use fallbacks\n  const authorInfo = {\n    name: gitAuthorInfo?.name ?? 'Scaffolder',\n    email: gitAuthorInfo?.email ?? 'scaffolder@backstage.io',\n  };\n\n  const commitHash = await git.commit({\n    dir,\n    message: commitMessage,\n    author: authorInfo,\n    committer: authorInfo,\n  });\n\n  await git.push({\n    dir,\n    remote: 'origin',\n    remoteRef: remoteRef ?? `refs/heads/${branch}`,\n  });\n\n  return { commitHash };\n}\n\ntype BranchProtectionOptions = {\n  client: Octokit;\n  owner: string;\n  repoName: string;\n  logger: Logger;\n  requireCodeOwnerReviews: boolean;\n  requiredStatusCheckContexts?: string[];\n  bypassPullRequestAllowances?: {\n    users?: string[];\n    teams?: string[];\n    apps?: string[];\n  };\n  requiredApprovingReviewCount?: number;\n  restrictions?: {\n    users: string[];\n    teams: string[];\n    apps?: string[];\n  };\n  requireBranchesToBeUpToDate?: boolean;\n  requiredConversationResolution?: boolean;\n  defaultBranch?: string;\n  enforceAdmins?: boolean;\n  dismissStaleReviews?: boolean;\n  requiredCommitSigning?: boolean;\n};\n\nexport const enableBranchProtectionOnDefaultRepoBranch = async ({\n  repoName,\n  client,\n  owner,\n  logger,\n  requireCodeOwnerReviews,\n  bypassPullRequestAllowances,\n  requiredApprovingReviewCount,\n  restrictions,\n  requiredStatusCheckContexts = [],\n  requireBranchesToBeUpToDate = true,\n  requiredConversationResolution = false,\n  defaultBranch = 'master',\n  enforceAdmins = true,\n  dismissStaleReviews = false,\n  requiredCommitSigning = false,\n}: BranchProtectionOptions): Promise<void> => {\n  const tryOnce = async () => {\n    try {\n      await client.rest.repos.updateBranchProtection({\n        mediaType: {\n          /**\n           * 👇 we need this preview because allowing a custom\n           * reviewer count on branch protection is a preview\n           * feature\n           *\n           * More here: https://docs.github.com/en/rest/overview/api-previews#require-multiple-approving-reviews\n           */\n          previews: ['luke-cage-preview'],\n        },\n        owner,\n        repo: repoName,\n        branch: defaultBranch,\n        required_status_checks: {\n          strict: requireBranchesToBeUpToDate,\n          contexts: requiredStatusCheckContexts,\n        },\n        restrictions: restrictions ?? null,\n        enforce_admins: enforceAdmins,\n        required_pull_request_reviews: {\n          required_approving_review_count: requiredApprovingReviewCount,\n          require_code_owner_reviews: requireCodeOwnerReviews,\n          bypass_pull_request_allowances: bypassPullRequestAllowances,\n          dismiss_stale_reviews: dismissStaleReviews,\n        },\n        required_conversation_resolution: requiredConversationResolution,\n      });\n\n      if (requiredCommitSigning) {\n        await client.rest.repos.createCommitSignatureProtection({\n          owner,\n          repo: repoName,\n          branch: defaultBranch,\n        });\n      }\n    } catch (e) {\n      assertError(e);\n      if (\n        e.message.includes(\n          'Upgrade to GitHub Pro or make this repository public to enable this feature',\n        )\n      ) {\n        logger.warn(\n          'Branch protection was not enabled as it requires GitHub Pro for private repositories',\n        );\n      } else {\n        throw e;\n      }\n    }\n  };\n\n  try {\n    await tryOnce();\n  } catch (e) {\n    if (!e.message.includes('Branch not found')) {\n      throw e;\n    }\n\n    // GitHub has eventual consistency. Fail silently, wait, and try again.\n    await new Promise(resolve => setTimeout(resolve, 600));\n    await tryOnce();\n  }\n};\n\nexport function getGitCommitMessage(\n  gitCommitMessage: string | undefined,\n  config: Config,\n): string | undefined {\n  return gitCommitMessage\n    ? gitCommitMessage\n    : config.getOptionalString('scaffolder.defaultCommitMessage');\n}\n\nexport function entityRefToName(name: string): string {\n  return name.replace(/^.*[:/]/g, '');\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { assertError, InputError, NotFoundError } from '@backstage/errors';\nimport {\n  DefaultGithubCredentialsProvider,\n  GithubCredentialsProvider,\n  ScmIntegrationRegistry,\n} from '@backstage/integration';\nimport { OctokitOptions } from '@octokit/core/dist-types/types';\nimport { Octokit } from 'octokit';\nimport { Logger } from 'winston';\nimport {\n  enableBranchProtectionOnDefaultRepoBranch,\n  initRepoAndPush,\n} from '../helpers';\nimport { getRepoSourceDirectory, parseRepoUrl } from '../publish/util';\nimport { entityRefToName } from '../../builtin/helpers';\n\nconst DEFAULT_TIMEOUT_MS = 60_000;\n\nexport async function getOctokitOptions(options: {\n  integrations: ScmIntegrationRegistry;\n  credentialsProvider?: GithubCredentialsProvider;\n  token?: string;\n  repoUrl: string;\n}): Promise<OctokitOptions> {\n  const { integrations, credentialsProvider, repoUrl, token } = options;\n  const { owner, repo, host } = parseRepoUrl(repoUrl, integrations);\n\n  const requestOptions = {\n    // set timeout to 60 seconds\n    timeout: DEFAULT_TIMEOUT_MS,\n  };\n\n  if (!owner) {\n    throw new InputError(`No owner provided for repo ${repoUrl}`);\n  }\n\n  const integrationConfig = integrations.github.byHost(host)?.config;\n\n  if (!integrationConfig) {\n    throw new InputError(`No integration for host ${host}`);\n  }\n\n  // short circuit the `githubCredentialsProvider` if there is a token provided by the caller already\n  if (token) {\n    return {\n      auth: token,\n      baseUrl: integrationConfig.apiBaseUrl,\n      previews: ['nebula-preview'],\n      request: requestOptions,\n    };\n  }\n\n  const githubCredentialsProvider =\n    credentialsProvider ??\n    DefaultGithubCredentialsProvider.fromIntegrations(integrations);\n\n  // TODO(blam): Consider changing this API to take host and repo instead of repoUrl, as we end up parsing in this function\n  // and then parsing in the `getCredentials` function too the other side\n  const { token: credentialProviderToken } =\n    await githubCredentialsProvider.getCredentials({\n      url: `https://${host}/${encodeURIComponent(owner)}/${encodeURIComponent(\n        repo,\n      )}`,\n    });\n\n  if (!credentialProviderToken) {\n    throw new InputError(\n      `No token available for host: ${host}, with owner ${owner}, and repo ${repo}`,\n    );\n  }\n\n  return {\n    auth: credentialProviderToken,\n    baseUrl: integrationConfig.apiBaseUrl,\n    previews: ['nebula-preview'],\n  };\n}\n\nexport async function createGithubRepoWithCollaboratorsAndTopics(\n  client: Octokit,\n  repo: string,\n  owner: string,\n  repoVisibility: 'private' | 'internal' | 'public',\n  description: string | undefined,\n  homepage: string | undefined,\n  deleteBranchOnMerge: boolean,\n  allowMergeCommit: boolean,\n  allowSquashMerge: boolean,\n  squashMergeCommitTitle: 'PR_TITLE' | 'COMMIT_OR_PR_TITLE' | undefined,\n  squashMergeCommitMessage: 'PR_BODY' | 'COMMIT_MESSAGES' | 'BLANK' | undefined,\n  allowRebaseMerge: boolean,\n  allowAutoMerge: boolean,\n  access: string | undefined,\n  collaborators:\n    | (\n        | {\n            user: string;\n            access: string;\n          }\n        | {\n            team: string;\n            access: string;\n          }\n        | {\n            /** @deprecated This field is deprecated in favor of team */\n            username: string;\n            access: 'pull' | 'push' | 'admin' | 'maintain' | 'triage';\n          }\n      )[]\n    | undefined,\n  hasProjects: boolean | undefined,\n  hasWiki: boolean | undefined,\n  hasIssues: boolean | undefined,\n  topics: string[] | undefined,\n  logger: Logger,\n) {\n  // eslint-disable-next-line testing-library/no-await-sync-query\n  const user = await client.rest.users.getByUsername({\n    username: owner,\n  });\n\n  if (access?.startsWith(`${owner}/`)) {\n    await validateAccessTeam(client, access);\n  }\n\n  const repoCreationPromise =\n    user.data.type === 'Organization'\n      ? client.rest.repos.createInOrg({\n          name: repo,\n          org: owner,\n          private: repoVisibility === 'private',\n          visibility: repoVisibility,\n          description: description,\n          delete_branch_on_merge: deleteBranchOnMerge,\n          allow_merge_commit: allowMergeCommit,\n          allow_squash_merge: allowSquashMerge,\n          squash_merge_commit_title: squashMergeCommitTitle,\n          squash_merge_commit_message: squashMergeCommitMessage,\n          allow_rebase_merge: allowRebaseMerge,\n          allow_auto_merge: allowAutoMerge,\n          homepage: homepage,\n          has_projects: hasProjects,\n          has_wiki: hasWiki,\n          has_issues: hasIssues,\n        })\n      : client.rest.repos.createForAuthenticatedUser({\n          name: repo,\n          private: repoVisibility === 'private',\n          description: description,\n          delete_branch_on_merge: deleteBranchOnMerge,\n          allow_merge_commit: allowMergeCommit,\n          allow_squash_merge: allowSquashMerge,\n          squash_merge_commit_title: squashMergeCommitTitle,\n          squash_merge_commit_message: squashMergeCommitMessage,\n          allow_rebase_merge: allowRebaseMerge,\n          allow_auto_merge: allowAutoMerge,\n          homepage: homepage,\n          has_projects: hasProjects,\n          has_wiki: hasWiki,\n          has_issues: hasIssues,\n        });\n\n  let newRepo;\n\n  try {\n    newRepo = (await repoCreationPromise).data;\n  } catch (e) {\n    assertError(e);\n    if (e.message === 'Resource not accessible by integration') {\n      logger.warn(\n        `The GitHub app or token provided may not have the required permissions to create the ${user.data.type} repository ${owner}/${repo}.`,\n      );\n    }\n    throw new Error(\n      `Failed to create the ${user.data.type} repository ${owner}/${repo}, ${e.message}`,\n    );\n  }\n\n  if (access?.startsWith(`${owner}/`)) {\n    const [, team] = access.split('/');\n    await client.rest.teams.addOrUpdateRepoPermissionsInOrg({\n      org: owner,\n      team_slug: team,\n      owner,\n      repo,\n      permission: 'admin',\n    });\n    // No need to add access if it's the person who owns the personal account\n  } else if (access && access !== owner) {\n    await client.rest.repos.addCollaborator({\n      owner,\n      repo,\n      username: access,\n      permission: 'admin',\n    });\n  }\n\n  if (collaborators) {\n    for (const collaborator of collaborators) {\n      try {\n        if ('user' in collaborator) {\n          await client.rest.repos.addCollaborator({\n            owner,\n            repo,\n            username: entityRefToName(collaborator.user),\n            permission: collaborator.access,\n          });\n        } else if ('team' in collaborator) {\n          await client.rest.teams.addOrUpdateRepoPermissionsInOrg({\n            org: owner,\n            team_slug: entityRefToName(collaborator.team),\n            owner,\n            repo,\n            permission: collaborator.access,\n          });\n        }\n      } catch (e) {\n        assertError(e);\n        const name = extractCollaboratorName(collaborator);\n        logger.warn(\n          `Skipping ${collaborator.access} access for ${name}, ${e.message}`,\n        );\n      }\n    }\n  }\n\n  if (topics) {\n    try {\n      await client.rest.repos.replaceAllTopics({\n        owner,\n        repo,\n        names: topics.map(t => t.toLowerCase()),\n      });\n    } catch (e) {\n      assertError(e);\n      logger.warn(`Skipping topics ${topics.join(' ')}, ${e.message}`);\n    }\n  }\n\n  return newRepo;\n}\n\nexport async function initRepoPushAndProtect(\n  remoteUrl: string,\n  password: string,\n  workspacePath: string,\n  sourcePath: string | undefined,\n  defaultBranch: string,\n  protectDefaultBranch: boolean,\n  protectEnforceAdmins: boolean,\n  owner: string,\n  client: Octokit,\n  repo: string,\n  requireCodeOwnerReviews: boolean,\n  bypassPullRequestAllowances:\n    | {\n        users?: string[];\n        teams?: string[];\n        apps?: string[];\n      }\n    | undefined,\n  requiredApprovingReviewCount: number,\n  restrictions:\n    | {\n        users: string[];\n        teams: string[];\n        apps?: string[];\n      }\n    | undefined,\n  requiredStatusCheckContexts: string[],\n  requireBranchesToBeUpToDate: boolean,\n  requiredConversationResolution: boolean,\n  config: Config,\n  logger: any,\n  gitCommitMessage?: string,\n  gitAuthorName?: string,\n  gitAuthorEmail?: string,\n  dismissStaleReviews?: boolean,\n  requiredCommitSigning?: boolean,\n): Promise<{ commitHash: string }> {\n  const gitAuthorInfo = {\n    name: gitAuthorName\n      ? gitAuthorName\n      : config.getOptionalString('scaffolder.defaultAuthor.name'),\n    email: gitAuthorEmail\n      ? gitAuthorEmail\n      : config.getOptionalString('scaffolder.defaultAuthor.email'),\n  };\n\n  const commitMessage = gitCommitMessage\n    ? gitCommitMessage\n    : config.getOptionalString('scaffolder.defaultCommitMessage');\n\n  const commitResult = await initRepoAndPush({\n    dir: getRepoSourceDirectory(workspacePath, sourcePath),\n    remoteUrl,\n    defaultBranch,\n    auth: {\n      username: 'x-access-token',\n      password,\n    },\n    logger,\n    commitMessage,\n    gitAuthorInfo,\n  });\n\n  if (protectDefaultBranch) {\n    try {\n      await enableBranchProtectionOnDefaultRepoBranch({\n        owner,\n        client,\n        repoName: repo,\n        logger,\n        defaultBranch,\n        bypassPullRequestAllowances,\n        requiredApprovingReviewCount,\n        restrictions,\n        requireCodeOwnerReviews,\n        requiredStatusCheckContexts,\n        requireBranchesToBeUpToDate,\n        requiredConversationResolution,\n        enforceAdmins: protectEnforceAdmins,\n        dismissStaleReviews: dismissStaleReviews,\n        requiredCommitSigning: requiredCommitSigning,\n      });\n    } catch (e) {\n      assertError(e);\n      logger.warn(\n        `Skipping: default branch protection on '${repo}', ${e.message}`,\n      );\n    }\n  }\n\n  return { commitHash: commitResult.commitHash };\n}\n\nfunction extractCollaboratorName(\n  collaborator: { user: string } | { team: string } | { username: string },\n) {\n  if ('username' in collaborator) return collaborator.username;\n  if ('user' in collaborator) return collaborator.user;\n  return collaborator.team;\n}\n\nasync function validateAccessTeam(client: Octokit, access: string) {\n  const [org, team_slug] = access.split('/');\n  try {\n    // Below rule disabled because of a 'getByName' check for a different library\n    // incorrectly triggers here.\n    // eslint-disable-next-line testing-library/no-await-sync-query\n    await client.rest.teams.getByName({\n      org,\n      team_slug,\n    });\n  } catch (e) {\n    if (e.response.data.message === 'Not Found') {\n      const message = `Received 'Not Found' from the API; one of org:\n        ${org} or team: ${team_slug} was not found within GitHub.`;\n      throw new NotFoundError(message);\n    }\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputError } from '@backstage/errors';\nimport {\n  GithubCredentialsProvider,\n  ScmIntegrations,\n} from '@backstage/integration';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { Octokit } from 'octokit';\nimport { parseRepoUrl } from '../publish/util';\nimport { getOctokitOptions } from './helpers';\n\n/**\n * Creates a new action that dispatches a GitHub Action workflow for a given branch or tag.\n * @public\n */\nexport function createGithubActionsDispatchAction(options: {\n  integrations: ScmIntegrations;\n  githubCredentialsProvider?: GithubCredentialsProvider;\n}) {\n  const { integrations, githubCredentialsProvider } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    workflowId: string;\n    branchOrTagName: string;\n    workflowInputs?: { [key: string]: string };\n    token?: string;\n  }>({\n    id: 'github:actions:dispatch',\n    description:\n      'Dispatches a GitHub Action workflow for a given branch or tag',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl', 'workflowId', 'branchOrTagName'],\n        properties: {\n          repoUrl: {\n            title: 'Repository Location',\n            description: `Accepts the format 'github.com?repo=reponame&owner=owner' where 'reponame' is the new repository name and 'owner' is an organization or username`,\n            type: 'string',\n          },\n          workflowId: {\n            title: 'Workflow ID',\n            description: 'The GitHub Action Workflow filename',\n            type: 'string',\n          },\n          branchOrTagName: {\n            title: 'Branch or Tag name',\n            description:\n              'The git branch or tag name used to dispatch the workflow',\n            type: 'string',\n          },\n          workflowInputs: {\n            title: 'Workflow Inputs',\n            description:\n              'Inputs keys and values to send to GitHub Action configured on the workflow file. The maximum number of properties is 10. ',\n            type: 'object',\n          },\n          token: {\n            title: 'Authentication Token',\n            type: 'string',\n            description: 'The GITHUB_TOKEN to use for authorization to GitHub',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        workflowId,\n        branchOrTagName,\n        workflowInputs,\n        token: providedToken,\n      } = ctx.input;\n\n      ctx.logger.info(\n        `Dispatching workflow ${workflowId} for repo ${repoUrl} on ${branchOrTagName}`,\n      );\n\n      const { owner, repo } = parseRepoUrl(repoUrl, integrations);\n\n      if (!owner) {\n        throw new InputError('Invalid repository owner provided in repoUrl');\n      }\n\n      const client = new Octokit(\n        await getOctokitOptions({\n          integrations,\n          repoUrl,\n          credentialsProvider: githubCredentialsProvider,\n          token: providedToken,\n        }),\n      );\n\n      await client.rest.actions.createWorkflowDispatch({\n        owner,\n        repo,\n        workflow_id: workflowId,\n        ref: branchOrTagName,\n        inputs: workflowInputs,\n      });\n\n      ctx.logger.info(`Workflow ${workflowId} dispatched successfully`);\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  GithubCredentialsProvider,\n  ScmIntegrationRegistry,\n} from '@backstage/integration';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { assertError, InputError } from '@backstage/errors';\nimport { Octokit } from 'octokit';\nimport { getOctokitOptions } from './helpers';\nimport { parseRepoUrl } from '../publish/util';\n\n/**\n * Adds labels to a pull request or issue on GitHub\n * @public\n */\nexport function createGithubIssuesLabelAction(options: {\n  integrations: ScmIntegrationRegistry;\n  githubCredentialsProvider?: GithubCredentialsProvider;\n}) {\n  const { integrations, githubCredentialsProvider } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    number: number;\n    labels: string[];\n    token?: string;\n  }>({\n    id: 'github:issues:label',\n    description: 'Adds labels to a pull request or issue on GitHub.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl', 'number', 'labels'],\n        properties: {\n          repoUrl: {\n            title: 'Repository Location',\n            description: `Accepts the format 'github.com?repo=reponame&owner=owner' where 'reponame' is the repository name and 'owner' is an organization or username`,\n            type: 'string',\n          },\n          number: {\n            title: 'Pull Request or issue number',\n            description: 'The pull request or issue number to add labels to',\n            type: 'number',\n          },\n          labels: {\n            title: 'Labels',\n            description: 'The labels to add to the pull request or issue',\n            type: 'array',\n            items: {\n              type: 'string',\n            },\n          },\n          token: {\n            title: 'Authentication Token',\n            type: 'string',\n            description: 'The GITHUB_TOKEN to use for authorization to GitHub',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const { repoUrl, number, labels, token: providedToken } = ctx.input;\n\n      const { owner, repo } = parseRepoUrl(repoUrl, integrations);\n      ctx.logger.info(`Adding labels to ${number} issue on repo ${repo}`);\n\n      if (!owner) {\n        throw new InputError('Invalid repository owner provided in repoUrl');\n      }\n\n      const client = new Octokit(\n        await getOctokitOptions({\n          integrations,\n          credentialsProvider: githubCredentialsProvider,\n          repoUrl: repoUrl,\n          token: providedToken,\n        }),\n      );\n\n      try {\n        await client.rest.issues.addLabels({\n          owner,\n          repo,\n          issue_number: number,\n          labels,\n        });\n      } catch (e) {\n        assertError(e);\n        ctx.logger.warn(\n          `Failed: adding labels to issue: '${number}' on repo: '${repo}', ${e.message}`,\n        );\n      }\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst repoUrl = {\n  title: 'Repository Location',\n  description: `Accepts the format 'github.com?repo=reponame&owner=owner' where 'reponame' is the new repository name and 'owner' is an organization or username`,\n  type: 'string',\n};\nconst description = {\n  title: 'Repository Description',\n  type: 'string',\n};\nconst homepage = {\n  title: 'Repository Homepage',\n  type: 'string',\n};\nconst access = {\n  title: 'Repository Access',\n  description: `Sets an admin collaborator on the repository. Can either be a user reference different from 'owner' in 'repoUrl' or team reference, eg. 'org/team-name'`,\n  type: 'string',\n};\nconst requireCodeOwnerReviews = {\n  title: 'Require CODEOWNER Reviews?',\n  description:\n    'Require an approved review in PR including files with a designated Code Owner',\n  type: 'boolean',\n};\nconst dismissStaleReviews = {\n  title: 'Dismiss Stale Reviews',\n  description:\n    'New reviewable commits pushed to a matching branch will dismiss pull request review approvals.',\n  type: 'boolean',\n};\nconst requiredStatusCheckContexts = {\n  title: 'Required Status Check Contexts',\n  description:\n    'The list of status checks to require in order to merge into this branch',\n  type: 'array',\n  items: {\n    type: 'string',\n  },\n};\nconst requireBranchesToBeUpToDate = {\n  title: 'Require Branches To Be Up To Date?',\n  description: `Require branches to be up to date before merging. The default value is 'true'`,\n  type: 'boolean',\n};\nconst requiredConversationResolution = {\n  title: 'Required Conversation Resolution',\n  description:\n    'Requires all conversations on code to be resolved before a pull request can be merged into this branch',\n  type: 'boolean',\n};\nconst repoVisibility = {\n  title: 'Repository Visibility',\n  type: 'string',\n  enum: ['private', 'public', 'internal'],\n};\nconst deleteBranchOnMerge = {\n  title: 'Delete Branch On Merge',\n  type: 'boolean',\n  description: `Delete the branch after merging the PR. The default value is 'false'`,\n};\nconst gitAuthorName = {\n  title: 'Default Author Name',\n  type: 'string',\n  description: `Sets the default author name for the commit. The default value is 'Scaffolder'`,\n};\nconst gitAuthorEmail = {\n  title: 'Default Author Email',\n  type: 'string',\n  description: `Sets the default author email for the commit.`,\n};\nconst allowMergeCommit = {\n  title: 'Allow Merge Commits',\n  type: 'boolean',\n  description: `Allow merge commits. The default value is 'true'`,\n};\nconst allowSquashMerge = {\n  title: 'Allow Squash Merges',\n  type: 'boolean',\n  description: `Allow squash merges. The default value is 'true'`,\n};\nconst squashMergeCommitTitle = {\n  title: 'Default squash merge commit title',\n  enum: ['PR_TITLE', 'COMMIT_OR_PR_TITLE'],\n  description: `Sets the default value for a squash merge commit title. The default value is 'COMMIT_OR_PR_TITLE'`,\n};\nconst squashMergeCommitMessage = {\n  title: 'Default squash merge commit message',\n  enum: ['PR_BODY', 'COMMIT_MESSAGES', 'BLANK'],\n  description: `Sets the default value for a squash merge commit message. The default value is 'COMMIT_MESSAGES'`,\n};\n\nconst allowRebaseMerge = {\n  title: 'Allow Rebase Merges',\n  type: 'boolean',\n  description: `Allow rebase merges. The default value is 'true'`,\n};\nconst allowAutoMerge = {\n  title: 'Allow Auto Merges',\n  type: 'boolean',\n  description: `Allow individual PRs to merge automatically when all merge requirements are met. The default value is 'false'`,\n};\nconst collaborators = {\n  title: 'Collaborators',\n  description: 'Provide additional users or teams with permissions',\n  type: 'array',\n  items: {\n    type: 'object',\n    additionalProperties: false,\n    required: ['access'],\n    properties: {\n      access: {\n        type: 'string',\n        description: 'The type of access for the user',\n      },\n      user: {\n        type: 'string',\n        description:\n          'The name of the user that will be added as a collaborator',\n      },\n      team: {\n        type: 'string',\n        description:\n          'The name of the team that will be added as a collaborator',\n      },\n    },\n    oneOf: [{ required: ['user'] }, { required: ['team'] }],\n  },\n};\nconst hasProjects = {\n  title: 'Enable projects',\n  type: 'boolean',\n  description: `Enable projects for the repository. The default value is 'true' unless the organization has disabled repository projects`,\n};\nconst hasWiki = {\n  title: 'Enable the wiki',\n  type: 'boolean',\n  description: `Enable the wiki for the repository. The default value is 'true'`,\n};\nconst hasIssues = {\n  title: 'Enable issues',\n  type: 'boolean',\n  description: `Enable issues for the repository. The default value is 'true'`,\n};\nconst token = {\n  title: 'Authentication Token',\n  type: 'string',\n  description: 'The token to use for authorization to GitHub',\n};\nconst topics = {\n  title: 'Topics',\n  type: 'array',\n  items: {\n    type: 'string',\n  },\n};\nconst defaultBranch = {\n  title: 'Default Branch',\n  type: 'string',\n  description: `Sets the default branch on the repository. The default value is 'master'`,\n};\nconst protectDefaultBranch = {\n  title: 'Protect Default Branch',\n  type: 'boolean',\n  description: `Protect the default branch after creating the repository. The default value is 'true'`,\n};\nconst protectEnforceAdmins = {\n  title: 'Enforce Admins On Protected Branches',\n  type: 'boolean',\n  description: `Enforce admins to adhere to default branch protection. The default value is 'true'`,\n};\n\nconst bypassPullRequestAllowances = {\n  title: 'Bypass pull request requirements',\n  description:\n    'Allow specific users, teams, or apps to bypass pull request requirements.',\n  type: 'object',\n  additionalProperties: false,\n  properties: {\n    apps: {\n      type: 'array',\n      items: {\n        type: 'string',\n      },\n    },\n    users: {\n      type: 'array',\n      items: {\n        type: 'string',\n      },\n    },\n    teams: {\n      type: 'array',\n      items: {\n        type: 'string',\n      },\n    },\n  },\n};\n\nconst gitCommitMessage = {\n  title: 'Git Commit Message',\n  type: 'string',\n  description: `Sets the commit message on the repository. The default value is 'initial commit'`,\n};\nconst sourcePath = {\n  title: 'Source Path',\n  description:\n    'Path within the workspace that will be used as the repository root. If omitted, the entire workspace will be published as the repository.',\n  type: 'string',\n};\n\nconst requiredApprovingReviewCount = {\n  title: 'Required approving review count',\n  type: 'number',\n  description: `Specify the number of reviewers required to approve pull requests. Use a number between 1 and 6 or 0 to not require reviewers. Defaults to 1.`,\n};\n\nconst restrictions = {\n  title: 'Restrict who can push to the protected branch',\n  description:\n    'Restrict who can push to the protected branch. User, app, and team restrictions are only available for organization-owned repositories.',\n  type: 'object',\n  additionalProperties: false,\n  properties: {\n    apps: {\n      type: 'array',\n      items: {\n        type: 'string',\n      },\n    },\n    users: {\n      type: 'array',\n      items: {\n        type: 'string',\n      },\n    },\n    teams: {\n      type: 'array',\n      items: {\n        type: 'string',\n      },\n    },\n  },\n};\n\nconst requiredCommitSigning = {\n  title: 'Require commit signing',\n  type: 'boolean',\n  description: `Require commit signing so that you must sign commits on this branch.`,\n};\n\nexport { access };\nexport { allowMergeCommit };\nexport { allowRebaseMerge };\nexport { allowSquashMerge };\nexport { squashMergeCommitTitle };\nexport { squashMergeCommitMessage };\nexport { allowAutoMerge };\nexport { collaborators };\nexport { defaultBranch };\nexport { deleteBranchOnMerge };\nexport { description };\nexport { gitAuthorEmail };\nexport { gitAuthorName };\nexport { gitCommitMessage };\nexport { homepage };\nexport { protectDefaultBranch };\nexport { protectEnforceAdmins };\nexport { bypassPullRequestAllowances };\nexport { requiredApprovingReviewCount };\nexport { restrictions };\nexport { repoUrl };\nexport { repoVisibility };\nexport { requireCodeOwnerReviews };\nexport { dismissStaleReviews };\nexport { requiredStatusCheckContexts };\nexport { requireBranchesToBeUpToDate };\nexport { requiredConversationResolution };\nexport { hasProjects };\nexport { hasIssues };\nexport { hasWiki };\nexport { sourcePath };\nexport { token };\nexport { topics };\nexport { requiredCommitSigning };\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst remoteUrl = {\n  title: 'A URL to the repository with the provider',\n  type: 'string',\n};\nconst repoContentsUrl = {\n  title: 'A URL to the root of the repository',\n  type: 'string',\n};\n\nconst commitHash = {\n  title: 'The git commit hash of the initial commit',\n  type: 'string',\n};\n\nexport { remoteUrl };\nexport { repoContentsUrl };\nexport { commitHash };\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputError } from '@backstage/errors';\nimport {\n  GithubCredentialsProvider,\n  ScmIntegrationRegistry,\n} from '@backstage/integration';\nimport { Octokit } from 'octokit';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { parseRepoUrl } from '../publish/util';\nimport {\n  createGithubRepoWithCollaboratorsAndTopics,\n  getOctokitOptions,\n} from './helpers';\nimport * as inputProps from './inputProperties';\nimport * as outputProps from './outputProperties';\n\n/**\n * Creates a new action that initializes a git repository\n *\n * @public\n */\nexport function createGithubRepoCreateAction(options: {\n  integrations: ScmIntegrationRegistry;\n  githubCredentialsProvider?: GithubCredentialsProvider;\n}) {\n  const { integrations, githubCredentialsProvider } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    description?: string;\n    homepage?: string;\n    access?: string;\n    deleteBranchOnMerge?: boolean;\n    gitAuthorName?: string;\n    gitAuthorEmail?: string;\n    allowRebaseMerge?: boolean;\n    allowSquashMerge?: boolean;\n    squashMergeCommitTitle?: 'PR_TITLE' | 'COMMIT_OR_PR_TITLE';\n    squashMergeCommitMessage?: 'PR_BODY' | 'COMMIT_MESSAGES' | 'BLANK';\n    allowMergeCommit?: boolean;\n    allowAutoMerge?: boolean;\n    requireCodeOwnerReviews?: boolean;\n    bypassPullRequestAllowances?: {\n      users?: string[];\n      teams?: string[];\n      apps?: string[];\n    };\n    requiredApprovingReviewCount?: number;\n    restrictions?: {\n      users: string[];\n      teams: string[];\n      apps?: string[];\n    };\n    requiredStatusCheckContexts?: string[];\n    requireBranchesToBeUpToDate?: boolean;\n    requiredConversationResolution?: boolean;\n    repoVisibility?: 'private' | 'internal' | 'public';\n    collaborators?: Array<\n      | {\n          user: string;\n          access: string;\n        }\n      | {\n          team: string;\n          access: string;\n        }\n      | {\n          /** @deprecated This field is deprecated in favor of team */\n          username: string;\n          access: 'pull' | 'push' | 'admin' | 'maintain' | 'triage';\n        }\n    >;\n    hasProjects?: boolean;\n    hasWiki?: boolean;\n    hasIssues?: boolean;\n    token?: string;\n    topics?: string[];\n    requireCommitSigning?: boolean;\n  }>({\n    id: 'github:repo:create',\n    description: 'Creates a GitHub repository.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl'],\n        properties: {\n          repoUrl: inputProps.repoUrl,\n          description: inputProps.description,\n          homepage: inputProps.homepage,\n          access: inputProps.access,\n          requireCodeOwnerReviews: inputProps.requireCodeOwnerReviews,\n          bypassPullRequestAllowances: inputProps.bypassPullRequestAllowances,\n          requiredApprovingReviewCount: inputProps.requiredApprovingReviewCount,\n          restrictions: inputProps.restrictions,\n          requiredStatusCheckContexts: inputProps.requiredStatusCheckContexts,\n          requireBranchesToBeUpToDate: inputProps.requireBranchesToBeUpToDate,\n          requiredConversationResolution:\n            inputProps.requiredConversationResolution,\n          repoVisibility: inputProps.repoVisibility,\n          deleteBranchOnMerge: inputProps.deleteBranchOnMerge,\n          allowMergeCommit: inputProps.allowMergeCommit,\n          allowSquashMerge: inputProps.allowSquashMerge,\n          squashMergeCommitTitle: inputProps.squashMergeCommitTitle,\n          squashMergeCommitMessage: inputProps.squashMergeCommitMessage,\n          allowRebaseMerge: inputProps.allowRebaseMerge,\n          allowAutoMerge: inputProps.allowAutoMerge,\n          collaborators: inputProps.collaborators,\n          hasProjects: inputProps.hasProjects,\n          hasWiki: inputProps.hasWiki,\n          hasIssues: inputProps.hasIssues,\n          token: inputProps.token,\n          topics: inputProps.topics,\n          requiredCommitSigning: inputProps.requiredCommitSigning,\n        },\n      },\n      output: {\n        type: 'object',\n        properties: {\n          remoteUrl: outputProps.remoteUrl,\n          repoContentsUrl: outputProps.repoContentsUrl,\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        description,\n        homepage,\n        access,\n        repoVisibility = 'private',\n        deleteBranchOnMerge = false,\n        allowMergeCommit = true,\n        allowSquashMerge = true,\n        squashMergeCommitTitle = 'COMMIT_OR_PR_TITLE',\n        squashMergeCommitMessage = 'COMMIT_MESSAGES',\n        allowRebaseMerge = true,\n        allowAutoMerge = false,\n        collaborators,\n        hasProjects = undefined,\n        hasWiki = undefined,\n        hasIssues = undefined,\n        topics,\n        token: providedToken,\n      } = ctx.input;\n\n      const octokitOptions = await getOctokitOptions({\n        integrations,\n        credentialsProvider: githubCredentialsProvider,\n        token: providedToken,\n        repoUrl: repoUrl,\n      });\n      const client = new Octokit(octokitOptions);\n\n      const { owner, repo } = parseRepoUrl(repoUrl, integrations);\n\n      if (!owner) {\n        throw new InputError('Invalid repository owner provided in repoUrl');\n      }\n\n      const newRepo = await createGithubRepoWithCollaboratorsAndTopics(\n        client,\n        repo,\n        owner,\n        repoVisibility,\n        description,\n        homepage,\n        deleteBranchOnMerge,\n        allowMergeCommit,\n        allowSquashMerge,\n        squashMergeCommitTitle,\n        squashMergeCommitMessage,\n        allowRebaseMerge,\n        allowAutoMerge,\n        access,\n        collaborators,\n        hasProjects,\n        hasWiki,\n        hasIssues,\n        topics,\n        ctx.logger,\n      );\n\n      ctx.output('remoteUrl', newRepo.clone_url);\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { InputError } from '@backstage/errors';\nimport {\n  GithubCredentialsProvider,\n  ScmIntegrationRegistry,\n} from '@backstage/integration';\nimport { Octokit } from 'octokit';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { parseRepoUrl } from '../publish/util';\nimport { getOctokitOptions, initRepoPushAndProtect } from './helpers';\nimport * as inputProps from './inputProperties';\nimport * as outputProps from './outputProperties';\n\n/**\n * Creates a new action that initializes a git repository of the content in the workspace\n * and publishes it to GitHub.\n *\n * @public\n */\nexport function createGithubRepoPushAction(options: {\n  integrations: ScmIntegrationRegistry;\n  config: Config;\n  githubCredentialsProvider?: GithubCredentialsProvider;\n}) {\n  const { integrations, config, githubCredentialsProvider } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    description?: string;\n    defaultBranch?: string;\n    protectDefaultBranch?: boolean;\n    protectEnforceAdmins?: boolean;\n    gitCommitMessage?: string;\n    gitAuthorName?: string;\n    gitAuthorEmail?: string;\n    requireCodeOwnerReviews?: boolean;\n    dismissStaleReviews?: boolean;\n    bypassPullRequestAllowances?:\n      | {\n          users?: string[];\n          teams?: string[];\n          apps?: string[];\n        }\n      | undefined;\n    requiredApprovingReviewCount?: number;\n    restrictions?:\n      | {\n          users: string[];\n          teams: string[];\n          apps?: string[];\n        }\n      | undefined;\n    requiredStatusCheckContexts?: string[];\n    requireBranchesToBeUpToDate?: boolean;\n    requiredConversationResolution?: boolean;\n    sourcePath?: string;\n    token?: string;\n    requiredCommitSigning?: boolean;\n  }>({\n    id: 'github:repo:push',\n    description:\n      'Initializes a git repository of contents in workspace and publishes it to GitHub.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl'],\n        properties: {\n          repoUrl: inputProps.repoUrl,\n          requireCodeOwnerReviews: inputProps.requireCodeOwnerReviews,\n          dismissStaleReviews: inputProps.dismissStaleReviews,\n          requiredStatusCheckContexts: inputProps.requiredStatusCheckContexts,\n          bypassPullRequestAllowances: inputProps.bypassPullRequestAllowances,\n          requiredApprovingReviewCount: inputProps.requiredApprovingReviewCount,\n          restrictions: inputProps.restrictions,\n          requireBranchesToBeUpToDate: inputProps.requireBranchesToBeUpToDate,\n          requiredConversationResolution:\n            inputProps.requiredConversationResolution,\n          defaultBranch: inputProps.defaultBranch,\n          protectDefaultBranch: inputProps.protectDefaultBranch,\n          protectEnforceAdmins: inputProps.protectEnforceAdmins,\n          gitCommitMessage: inputProps.gitCommitMessage,\n          gitAuthorName: inputProps.gitAuthorName,\n          gitAuthorEmail: inputProps.gitAuthorEmail,\n          sourcePath: inputProps.sourcePath,\n          token: inputProps.token,\n          requiredCommitSigning: inputProps.requiredCommitSigning,\n        },\n      },\n      output: {\n        type: 'object',\n        properties: {\n          remoteUrl: outputProps.remoteUrl,\n          repoContentsUrl: outputProps.repoContentsUrl,\n          commitHash: outputProps.commitHash,\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        defaultBranch = 'master',\n        protectDefaultBranch = true,\n        protectEnforceAdmins = true,\n        gitCommitMessage = 'initial commit',\n        gitAuthorName,\n        gitAuthorEmail,\n        requireCodeOwnerReviews = false,\n        dismissStaleReviews = false,\n        bypassPullRequestAllowances,\n        requiredApprovingReviewCount = 1,\n        restrictions,\n        requiredStatusCheckContexts = [],\n        requireBranchesToBeUpToDate = true,\n        requiredConversationResolution = false,\n        token: providedToken,\n        requiredCommitSigning = false,\n      } = ctx.input;\n\n      const { owner, repo } = parseRepoUrl(repoUrl, integrations);\n\n      if (!owner) {\n        throw new InputError('Invalid repository owner provided in repoUrl');\n      }\n\n      const octokitOptions = await getOctokitOptions({\n        integrations,\n        credentialsProvider: githubCredentialsProvider,\n        token: providedToken,\n        repoUrl,\n      });\n\n      const client = new Octokit(octokitOptions);\n\n      const targetRepo = await client.rest.repos.get({ owner, repo });\n\n      const remoteUrl = targetRepo.data.clone_url;\n      const repoContentsUrl = `${targetRepo.data.html_url}/blob/${defaultBranch}`;\n\n      const { commitHash } = await initRepoPushAndProtect(\n        remoteUrl,\n        octokitOptions.auth,\n        ctx.workspacePath,\n        ctx.input.sourcePath,\n        defaultBranch,\n        protectDefaultBranch,\n        protectEnforceAdmins,\n        owner,\n        client,\n        repo,\n        requireCodeOwnerReviews,\n        bypassPullRequestAllowances,\n        requiredApprovingReviewCount,\n        restrictions,\n        requiredStatusCheckContexts,\n        requireBranchesToBeUpToDate,\n        requiredConversationResolution,\n        config,\n        ctx.logger,\n        gitCommitMessage,\n        gitAuthorName,\n        gitAuthorEmail,\n        dismissStaleReviews,\n        requiredCommitSigning,\n      );\n\n      ctx.output('remoteUrl', remoteUrl);\n      ctx.output('repoContentsUrl', repoContentsUrl);\n      ctx.output('commitHash', commitHash);\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  GithubCredentialsProvider,\n  ScmIntegrationRegistry,\n} from '@backstage/integration';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { emitterEventNames } from '@octokit/webhooks';\nimport { assertError, InputError } from '@backstage/errors';\nimport { Octokit } from 'octokit';\nimport { getOctokitOptions } from './helpers';\nimport { parseRepoUrl } from '../publish/util';\n\n/**\n * Creates new action that creates a webhook for a repository on GitHub.\n * @public\n */\nexport function createGithubWebhookAction(options: {\n  integrations: ScmIntegrationRegistry;\n  defaultWebhookSecret?: string;\n  githubCredentialsProvider?: GithubCredentialsProvider;\n}) {\n  const { integrations, defaultWebhookSecret, githubCredentialsProvider } =\n    options;\n\n  const eventNames = emitterEventNames.filter(event => !event.includes('.'));\n\n  return createTemplateAction<{\n    repoUrl: string;\n    webhookUrl: string;\n    webhookSecret?: string;\n    events?: string[];\n    active?: boolean;\n    contentType?: 'form' | 'json';\n    insecureSsl?: boolean;\n    token?: string;\n  }>({\n    id: 'github:webhook',\n    description: 'Creates webhook for a repository on GitHub.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl', 'webhookUrl'],\n        properties: {\n          repoUrl: {\n            title: 'Repository Location',\n            description: `Accepts the format 'github.com?repo=reponame&owner=owner' where 'reponame' is the new repository name and 'owner' is an organization or username`,\n            type: 'string',\n          },\n          webhookUrl: {\n            title: 'Webhook URL',\n            description: 'The URL to which the payloads will be delivered',\n            type: 'string',\n          },\n          webhookSecret: {\n            title: 'Webhook Secret',\n            description:\n              'Webhook secret value. The default can be provided internally in action creation',\n            type: 'string',\n          },\n          events: {\n            title: 'Triggering Events',\n            description:\n              'Determines what events the hook is triggered for. Default: push',\n            type: 'array',\n            oneOf: [\n              {\n                items: {\n                  type: 'string',\n                  enum: eventNames,\n                },\n              },\n              {\n                items: {\n                  type: 'string',\n                  const: '*',\n                },\n              },\n            ],\n          },\n          active: {\n            title: 'Active',\n            type: 'boolean',\n            description: `Determines if notifications are sent when the webhook is triggered. Default: true`,\n          },\n          contentType: {\n            title: 'Content Type',\n            type: 'string',\n            enum: ['form', 'json'],\n            description: `The media type used to serialize the payloads. The default is 'form'`,\n          },\n          insecureSsl: {\n            title: 'Insecure SSL',\n            type: 'boolean',\n            description: `Determines whether the SSL certificate of the host for url will be verified when delivering payloads. Default 'false'`,\n          },\n          token: {\n            title: 'Authentication Token',\n            type: 'string',\n            description: 'The GITHUB_TOKEN to use for authorization to GitHub',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        webhookUrl,\n        webhookSecret = defaultWebhookSecret,\n        events = ['push'],\n        active = true,\n        contentType = 'form',\n        insecureSsl = false,\n        token: providedToken,\n      } = ctx.input;\n\n      ctx.logger.info(`Creating webhook ${webhookUrl} for repo ${repoUrl}`);\n      const { owner, repo } = parseRepoUrl(repoUrl, integrations);\n\n      if (!owner) {\n        throw new InputError('Invalid repository owner provided in repoUrl');\n      }\n\n      const client = new Octokit(\n        await getOctokitOptions({\n          integrations,\n          credentialsProvider: githubCredentialsProvider,\n          repoUrl: repoUrl,\n          token: providedToken,\n        }),\n      );\n\n      try {\n        const insecure_ssl = insecureSsl ? '1' : '0';\n        await client.rest.repos.createWebhook({\n          owner,\n          repo,\n          config: {\n            url: webhookUrl,\n            content_type: contentType,\n            secret: webhookSecret,\n            insecure_ssl,\n          },\n          events,\n          active,\n        });\n        ctx.logger.info(`Webhook '${webhookUrl}' created successfully`);\n      } catch (e) {\n        assertError(e);\n        ctx.logger.warn(\n          `Failed: create webhook '${webhookUrl}' on repo: '${repo}', ${e.message}`,\n        );\n      }\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputError } from '@backstage/errors';\nimport { ScmIntegrationRegistry } from '@backstage/integration';\nimport { initRepoAndPush } from '../helpers';\nimport { GitRepositoryCreateOptions } from 'azure-devops-node-api/interfaces/GitInterfaces';\nimport { getPersonalAccessTokenHandler, WebApi } from 'azure-devops-node-api';\nimport { getRepoSourceDirectory, parseRepoUrl } from './util';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { Config } from '@backstage/config';\n\n/**\n * Creates a new action that initializes a git repository of the content in the workspace\n * and publishes it to Azure.\n * @public\n */\nexport function createPublishAzureAction(options: {\n  integrations: ScmIntegrationRegistry;\n  config: Config;\n}) {\n  const { integrations, config } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    description?: string;\n    defaultBranch?: string;\n    sourcePath?: string;\n    token?: string;\n    gitCommitMessage?: string;\n    gitAuthorName?: string;\n    gitAuthorEmail?: string;\n  }>({\n    id: 'publish:azure',\n    description:\n      'Initializes a git repository of the content in the workspace, and publishes it to Azure.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl'],\n        properties: {\n          repoUrl: {\n            title: 'Repository Location',\n            type: 'string',\n          },\n          description: {\n            title: 'Repository Description',\n            type: 'string',\n          },\n          defaultBranch: {\n            title: 'Default Branch',\n            type: 'string',\n            description: `Sets the default branch on the repository. The default value is 'master'`,\n          },\n          gitCommitMessage: {\n            title: 'Git Commit Message',\n            type: 'string',\n            description: `Sets the commit message on the repository. The default value is 'initial commit'`,\n          },\n          gitAuthorName: {\n            title: 'Default Author Name',\n            type: 'string',\n            description: `Sets the default author name for the commit. The default value is 'Scaffolder'`,\n          },\n          gitAuthorEmail: {\n            title: 'Default Author Email',\n            type: 'string',\n            description: `Sets the default author email for the commit.`,\n          },\n          sourcePath: {\n            title: 'Source Path',\n            description:\n              'Path within the workspace that will be used as the repository root. If omitted, the entire workspace will be published as the repository.',\n            type: 'string',\n          },\n          token: {\n            title: 'Authentication Token',\n            type: 'string',\n            description: 'The token to use for authorization to Azure',\n          },\n        },\n      },\n      output: {\n        type: 'object',\n        properties: {\n          remoteUrl: {\n            title: 'A URL to the repository with the provider',\n            type: 'string',\n          },\n          repoContentsUrl: {\n            title: 'A URL to the root of the repository',\n            type: 'string',\n          },\n          repositoryId: {\n            title: 'The Id of the created repository',\n            type: 'string',\n          },\n          commitHash: {\n            title: 'The git commit hash of the initial commit',\n            type: 'string',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        defaultBranch = 'master',\n        gitCommitMessage = 'initial commit',\n        gitAuthorName,\n        gitAuthorEmail,\n      } = ctx.input;\n\n      const { owner, repo, host, organization } = parseRepoUrl(\n        repoUrl,\n        integrations,\n      );\n\n      if (!organization) {\n        throw new InputError(\n          `Invalid URL provider was included in the repo URL to create ${ctx.input.repoUrl}, missing organization`,\n        );\n      }\n\n      const integrationConfig = integrations.azure.byHost(host);\n\n      if (!integrationConfig) {\n        throw new InputError(\n          `No matching integration configuration for host ${host}, please check your integrations config`,\n        );\n      }\n\n      if (!integrationConfig.config.token && !ctx.input.token) {\n        throw new InputError(`No token provided for Azure Integration ${host}`);\n      }\n\n      const token = ctx.input.token ?? integrationConfig.config.token!;\n      const authHandler = getPersonalAccessTokenHandler(token);\n\n      const webApi = new WebApi(`https://${host}/${organization}`, authHandler);\n      const client = await webApi.getGitApi();\n      const createOptions: GitRepositoryCreateOptions = { name: repo };\n      const returnedRepo = await client.createRepository(createOptions, owner);\n\n      if (!returnedRepo) {\n        throw new InputError(\n          `Unable to create the repository with Organization ${organization}, Project ${owner} and Repo ${repo}.\n          Please make sure that both the Org and Project are typed corrected and exist.`,\n        );\n      }\n      const remoteUrl = returnedRepo.remoteUrl;\n\n      if (!remoteUrl) {\n        throw new InputError(\n          'No remote URL returned from create repository for Azure',\n        );\n      }\n      const repositoryId = returnedRepo.id;\n\n      if (!repositoryId) {\n        throw new InputError('No Id returned from create repository for Azure');\n      }\n\n      // blam: Repo contents is serialized into the path,\n      // so it's just the base path I think\n      const repoContentsUrl = remoteUrl;\n\n      const gitAuthorInfo = {\n        name: gitAuthorName\n          ? gitAuthorName\n          : config.getOptionalString('scaffolder.defaultAuthor.name'),\n        email: gitAuthorEmail\n          ? gitAuthorEmail\n          : config.getOptionalString('scaffolder.defaultAuthor.email'),\n      };\n\n      const commitResult = await initRepoAndPush({\n        dir: getRepoSourceDirectory(ctx.workspacePath, ctx.input.sourcePath),\n        remoteUrl,\n        defaultBranch,\n        auth: {\n          username: 'notempty',\n          password: token,\n        },\n        logger: ctx.logger,\n        commitMessage: gitCommitMessage\n          ? gitCommitMessage\n          : config.getOptionalString('scaffolder.defaultCommitMessage'),\n        gitAuthorInfo,\n      });\n\n      ctx.output('commitHash', commitResult?.commitHash);\n      ctx.output('remoteUrl', remoteUrl);\n      ctx.output('repoContentsUrl', repoContentsUrl);\n      ctx.output('repositoryId', repositoryId);\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputError } from '@backstage/errors';\nimport {\n  BitbucketIntegrationConfig,\n  ScmIntegrationRegistry,\n} from '@backstage/integration';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport fetch, { Response, RequestInit } from 'node-fetch';\nimport { initRepoAndPush } from '../helpers';\nimport { getRepoSourceDirectory, parseRepoUrl } from './util';\nimport { Config } from '@backstage/config';\n\nconst createBitbucketCloudRepository = async (opts: {\n  workspace: string;\n  project: string;\n  repo: string;\n  description?: string;\n  repoVisibility: 'private' | 'public';\n  mainBranch: string;\n  authorization: string;\n  apiBaseUrl: string;\n}) => {\n  const {\n    workspace,\n    project,\n    repo,\n    description,\n    repoVisibility,\n    mainBranch,\n    authorization,\n    apiBaseUrl,\n  } = opts;\n\n  const options: RequestInit = {\n    method: 'POST',\n    body: JSON.stringify({\n      scm: 'git',\n      description: description,\n      is_private: repoVisibility === 'private',\n      project: { key: project },\n    }),\n    headers: {\n      Authorization: authorization,\n      'Content-Type': 'application/json',\n    },\n  };\n\n  let response: Response;\n  try {\n    response = await fetch(\n      `${apiBaseUrl}/repositories/${workspace}/${repo}`,\n      options,\n    );\n  } catch (e) {\n    throw new Error(`Unable to create repository, ${e}`);\n  }\n\n  if (response.status !== 200) {\n    throw new Error(\n      `Unable to create repository, ${response.status} ${\n        response.statusText\n      }, ${await response.text()}`,\n    );\n  }\n\n  const r = await response.json();\n  let remoteUrl = '';\n  for (const link of r.links.clone) {\n    if (link.name === 'https') {\n      remoteUrl = link.href;\n    }\n  }\n\n  // \"mainbranch.name\" cannot be set neither at create nor update of the repo\n  // the first pushed branch will be set as \"main branch\" then\n  const repoContentsUrl = `${r.links.html.href}/src/${mainBranch}`;\n  return { remoteUrl, repoContentsUrl };\n};\n\nconst createBitbucketServerRepository = async (opts: {\n  project: string;\n  repo: string;\n  description?: string;\n  repoVisibility: 'private' | 'public';\n  authorization: string;\n  apiBaseUrl: string;\n}) => {\n  const {\n    project,\n    repo,\n    description,\n    authorization,\n    repoVisibility,\n    apiBaseUrl,\n  } = opts;\n\n  let response: Response;\n  const options: RequestInit = {\n    method: 'POST',\n    body: JSON.stringify({\n      name: repo,\n      description: description,\n      public: repoVisibility === 'public',\n    }),\n    headers: {\n      Authorization: authorization,\n      'Content-Type': 'application/json',\n    },\n  };\n\n  try {\n    response = await fetch(`${apiBaseUrl}/projects/${project}/repos`, options);\n  } catch (e) {\n    throw new Error(`Unable to create repository, ${e}`);\n  }\n\n  if (response.status !== 201) {\n    throw new Error(\n      `Unable to create repository, ${response.status} ${\n        response.statusText\n      }, ${await response.text()}`,\n    );\n  }\n\n  const r = await response.json();\n  let remoteUrl = '';\n  for (const link of r.links.clone) {\n    if (link.name === 'http') {\n      remoteUrl = link.href;\n    }\n  }\n\n  const repoContentsUrl = `${r.links.self[0].href}`;\n  return { remoteUrl, repoContentsUrl };\n};\n\nconst getAuthorizationHeader = (config: BitbucketIntegrationConfig) => {\n  if (config.username && config.appPassword) {\n    const buffer = Buffer.from(\n      `${config.username}:${config.appPassword}`,\n      'utf8',\n    );\n\n    return `Basic ${buffer.toString('base64')}`;\n  }\n\n  if (config.token) {\n    return `Bearer ${config.token}`;\n  }\n\n  throw new Error(\n    `Authorization has not been provided for Bitbucket. Please add either username + appPassword or token to the Integrations config`,\n  );\n};\n\nconst performEnableLFS = async (opts: {\n  authorization: string;\n  host: string;\n  project: string;\n  repo: string;\n}) => {\n  const { authorization, host, project, repo } = opts;\n\n  const options: RequestInit = {\n    method: 'PUT',\n    headers: {\n      Authorization: authorization,\n    },\n  };\n\n  const { ok, status, statusText } = await fetch(\n    `https://${host}/rest/git-lfs/admin/projects/${project}/repos/${repo}/enabled`,\n    options,\n  );\n\n  if (!ok)\n    throw new Error(\n      `Failed to enable LFS in the repository, ${status}: ${statusText}`,\n    );\n};\n\n/**\n * Creates a new action that initializes a git repository of the content in the workspace\n * and publishes it to Bitbucket.\n * @public\n * @deprecated in favor of createPublishBitbucketCloudAction and createPublishBitbucketServerAction\n */\nexport function createPublishBitbucketAction(options: {\n  integrations: ScmIntegrationRegistry;\n  config: Config;\n}) {\n  const { integrations, config } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    description?: string;\n    defaultBranch?: string;\n    repoVisibility?: 'private' | 'public';\n    sourcePath?: string;\n    enableLFS?: boolean;\n    token?: string;\n    gitCommitMessage?: string;\n    gitAuthorName?: string;\n    gitAuthorEmail?: string;\n  }>({\n    id: 'publish:bitbucket',\n    description:\n      'Initializes a git repository of the content in the workspace, and publishes it to Bitbucket.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl'],\n        properties: {\n          repoUrl: {\n            title: 'Repository Location',\n            type: 'string',\n          },\n          description: {\n            title: 'Repository Description',\n            type: 'string',\n          },\n          repoVisibility: {\n            title: 'Repository Visibility',\n            type: 'string',\n            enum: ['private', 'public'],\n          },\n          defaultBranch: {\n            title: 'Default Branch',\n            type: 'string',\n            description: `Sets the default branch on the repository. The default value is 'master'`,\n          },\n          sourcePath: {\n            title: 'Source Path',\n            description:\n              'Path within the workspace that will be used as the repository root. If omitted, the entire workspace will be published as the repository.',\n            type: 'string',\n          },\n          enableLFS: {\n            title: 'Enable LFS?',\n            description:\n              'Enable LFS for the repository. Only available for hosted Bitbucket.',\n            type: 'boolean',\n          },\n          token: {\n            title: 'Authentication Token',\n            type: 'string',\n            description: 'The token to use for authorization to BitBucket',\n          },\n          gitCommitMessage: {\n            title: 'Git Commit Message',\n            type: 'string',\n            description: `Sets the commit message on the repository. The default value is 'initial commit'`,\n          },\n          gitAuthorName: {\n            title: 'Default Author Name',\n            type: 'string',\n            description: `Sets the default author name for the commit. The default value is 'Scaffolder'`,\n          },\n          gitAuthorEmail: {\n            title: 'Default Author Email',\n            type: 'string',\n            description: `Sets the default author email for the commit.`,\n          },\n        },\n      },\n      output: {\n        type: 'object',\n        properties: {\n          remoteUrl: {\n            title: 'A URL to the repository with the provider',\n            type: 'string',\n          },\n          repoContentsUrl: {\n            title: 'A URL to the root of the repository',\n            type: 'string',\n          },\n          commitHash: {\n            title: 'The git commit hash of the initial commit',\n            type: 'string',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      ctx.logger.warn(\n        `[Deprecated] Please migrate the use of action \"publish:bitbucket\" to \"publish:bitbucketCloud\" or \"publish:bitbucketServer\".`,\n      );\n      const {\n        repoUrl,\n        description,\n        defaultBranch = 'master',\n        repoVisibility = 'private',\n        enableLFS = false,\n        gitCommitMessage = 'initial commit',\n        gitAuthorName,\n        gitAuthorEmail,\n      } = ctx.input;\n\n      const { workspace, project, repo, host } = parseRepoUrl(\n        repoUrl,\n        integrations,\n      );\n\n      // Workspace is only required for bitbucket cloud\n      if (host === 'bitbucket.org') {\n        if (!workspace) {\n          throw new InputError(\n            `Invalid URL provider was included in the repo URL to create ${ctx.input.repoUrl}, missing workspace`,\n          );\n        }\n      }\n\n      // Project is required for both bitbucket cloud and bitbucket server\n      if (!project) {\n        throw new InputError(\n          `Invalid URL provider was included in the repo URL to create ${ctx.input.repoUrl}, missing project`,\n        );\n      }\n\n      const integrationConfig = integrations.bitbucket.byHost(host);\n\n      if (!integrationConfig) {\n        throw new InputError(\n          `No matching integration configuration for host ${host}, please check your integrations config`,\n        );\n      }\n\n      const authorization = getAuthorizationHeader(\n        ctx.input.token\n          ? {\n              host: integrationConfig.config.host,\n              apiBaseUrl: integrationConfig.config.apiBaseUrl,\n              token: ctx.input.token,\n            }\n          : integrationConfig.config,\n      );\n\n      const apiBaseUrl = integrationConfig.config.apiBaseUrl;\n\n      const createMethod =\n        host === 'bitbucket.org'\n          ? createBitbucketCloudRepository\n          : createBitbucketServerRepository;\n\n      const { remoteUrl, repoContentsUrl } = await createMethod({\n        authorization,\n        workspace: workspace || '',\n        project,\n        repo,\n        repoVisibility,\n        mainBranch: defaultBranch,\n        description,\n        apiBaseUrl,\n      });\n\n      const gitAuthorInfo = {\n        name: gitAuthorName\n          ? gitAuthorName\n          : config.getOptionalString('scaffolder.defaultAuthor.name'),\n        email: gitAuthorEmail\n          ? gitAuthorEmail\n          : config.getOptionalString('scaffolder.defaultAuthor.email'),\n      };\n\n      let auth;\n\n      if (ctx.input.token) {\n        auth = {\n          username: 'x-token-auth',\n          password: ctx.input.token,\n        };\n      } else {\n        auth = {\n          username: integrationConfig.config.username\n            ? integrationConfig.config.username\n            : 'x-token-auth',\n          password: integrationConfig.config.appPassword\n            ? integrationConfig.config.appPassword\n            : integrationConfig.config.token ?? '',\n        };\n      }\n\n      const commitResult = await initRepoAndPush({\n        dir: getRepoSourceDirectory(ctx.workspacePath, ctx.input.sourcePath),\n        remoteUrl,\n        auth,\n        defaultBranch,\n        logger: ctx.logger,\n        commitMessage: gitCommitMessage\n          ? gitCommitMessage\n          : config.getOptionalString('scaffolder.defaultCommitMessage'),\n        gitAuthorInfo,\n      });\n\n      if (enableLFS && host !== 'bitbucket.org') {\n        await performEnableLFS({ authorization, host, project, repo });\n      }\n\n      ctx.output('commitHash', commitResult?.commitHash);\n      ctx.output('remoteUrl', remoteUrl);\n      ctx.output('repoContentsUrl', repoContentsUrl);\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputError } from '@backstage/errors';\nimport { ScmIntegrationRegistry } from '@backstage/integration';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport fetch, { Response, RequestInit } from 'node-fetch';\nimport { initRepoAndPush } from '../helpers';\nimport { getRepoSourceDirectory, parseRepoUrl } from './util';\nimport { Config } from '@backstage/config';\n\nconst createRepository = async (opts: {\n  workspace: string;\n  project: string;\n  repo: string;\n  description?: string;\n  repoVisibility: 'private' | 'public';\n  mainBranch: string;\n  authorization: string;\n  apiBaseUrl: string;\n}) => {\n  const {\n    workspace,\n    project,\n    repo,\n    description,\n    repoVisibility,\n    mainBranch,\n    authorization,\n    apiBaseUrl,\n  } = opts;\n\n  const options: RequestInit = {\n    method: 'POST',\n    body: JSON.stringify({\n      scm: 'git',\n      description: description,\n      is_private: repoVisibility === 'private',\n      project: { key: project },\n    }),\n    headers: {\n      Authorization: authorization,\n      'Content-Type': 'application/json',\n    },\n  };\n\n  let response: Response;\n  try {\n    response = await fetch(\n      `${apiBaseUrl}/repositories/${workspace}/${repo}`,\n      options,\n    );\n  } catch (e) {\n    throw new Error(`Unable to create repository, ${e}`);\n  }\n\n  if (response.status !== 200) {\n    throw new Error(\n      `Unable to create repository, ${response.status} ${\n        response.statusText\n      }, ${await response.text()}`,\n    );\n  }\n\n  const r = await response.json();\n  let remoteUrl = '';\n  for (const link of r.links.clone) {\n    if (link.name === 'https') {\n      remoteUrl = link.href;\n    }\n  }\n\n  // \"mainbranch.name\" cannot be set neither at create nor update of the repo\n  // the first pushed branch will be set as \"main branch\" then\n  const repoContentsUrl = `${r.links.html.href}/src/${mainBranch}`;\n  return { remoteUrl, repoContentsUrl };\n};\n\nconst getAuthorizationHeader = (config: {\n  username?: string;\n  appPassword?: string;\n  token?: string;\n}) => {\n  if (config.username && config.appPassword) {\n    const buffer = Buffer.from(\n      `${config.username}:${config.appPassword}`,\n      'utf8',\n    );\n\n    return `Basic ${buffer.toString('base64')}`;\n  }\n\n  if (config.token) {\n    return `Bearer ${config.token}`;\n  }\n\n  throw new Error(\n    `Authorization has not been provided for Bitbucket Cloud. Please add either username + appPassword to the Integrations config or a user login auth token`,\n  );\n};\n\n/**\n * Creates a new action that initializes a git repository of the content in the workspace\n * and publishes it to Bitbucket Cloud.\n * @public\n */\nexport function createPublishBitbucketCloudAction(options: {\n  integrations: ScmIntegrationRegistry;\n  config: Config;\n}) {\n  const { integrations, config } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    description?: string;\n    defaultBranch?: string;\n    repoVisibility?: 'private' | 'public';\n    sourcePath?: string;\n    token?: string;\n  }>({\n    id: 'publish:bitbucketCloud',\n    description:\n      'Initializes a git repository of the content in the workspace, and publishes it to Bitbucket Cloud.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl'],\n        properties: {\n          repoUrl: {\n            title: 'Repository Location',\n            type: 'string',\n          },\n          description: {\n            title: 'Repository Description',\n            type: 'string',\n          },\n          repoVisibility: {\n            title: 'Repository Visibility',\n            type: 'string',\n            enum: ['private', 'public'],\n          },\n          defaultBranch: {\n            title: 'Default Branch',\n            type: 'string',\n            description: `Sets the default branch on the repository. The default value is 'master'`,\n          },\n          sourcePath: {\n            title: 'Source Path',\n            description:\n              'Path within the workspace that will be used as the repository root. If omitted, the entire workspace will be published as the repository.',\n            type: 'string',\n          },\n          token: {\n            title: 'Authentication Token',\n            type: 'string',\n            description:\n              'The token to use for authorization to BitBucket Cloud',\n          },\n        },\n      },\n      output: {\n        type: 'object',\n        properties: {\n          remoteUrl: {\n            title: 'A URL to the repository with the provider',\n            type: 'string',\n          },\n          repoContentsUrl: {\n            title: 'A URL to the root of the repository',\n            type: 'string',\n          },\n          commitHash: {\n            title: 'The git commit hash of the initial commit',\n            type: 'string',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        description,\n        defaultBranch = 'master',\n        repoVisibility = 'private',\n      } = ctx.input;\n\n      const { workspace, project, repo, host } = parseRepoUrl(\n        repoUrl,\n        integrations,\n      );\n\n      if (!workspace) {\n        throw new InputError(\n          `Invalid URL provider was included in the repo URL to create ${ctx.input.repoUrl}, missing workspace`,\n        );\n      }\n\n      if (!project) {\n        throw new InputError(\n          `Invalid URL provider was included in the repo URL to create ${ctx.input.repoUrl}, missing project`,\n        );\n      }\n\n      const integrationConfig = integrations.bitbucketCloud.byHost(host);\n      if (!integrationConfig) {\n        throw new InputError(\n          `No matching integration configuration for host ${host}, please check your integrations config`,\n        );\n      }\n\n      const authorization = getAuthorizationHeader(\n        ctx.input.token ? { token: ctx.input.token } : integrationConfig.config,\n      );\n\n      const apiBaseUrl = integrationConfig.config.apiBaseUrl;\n\n      const { remoteUrl, repoContentsUrl } = await createRepository({\n        authorization,\n        workspace: workspace || '',\n        project,\n        repo,\n        repoVisibility,\n        mainBranch: defaultBranch,\n        description,\n        apiBaseUrl,\n      });\n\n      const gitAuthorInfo = {\n        name: config.getOptionalString('scaffolder.defaultAuthor.name'),\n        email: config.getOptionalString('scaffolder.defaultAuthor.email'),\n      };\n\n      let auth;\n\n      if (ctx.input.token) {\n        auth = {\n          username: 'x-token-auth',\n          password: ctx.input.token,\n        };\n      } else {\n        if (\n          !integrationConfig.config.username ||\n          !integrationConfig.config.appPassword\n        ) {\n          throw new Error(\n            'Credentials for Bitbucket Cloud integration required for this action.',\n          );\n        }\n\n        auth = {\n          username: integrationConfig.config.username,\n          password: integrationConfig.config.appPassword,\n        };\n      }\n\n      const commitResult = await initRepoAndPush({\n        dir: getRepoSourceDirectory(ctx.workspacePath, ctx.input.sourcePath),\n        remoteUrl,\n        auth,\n        defaultBranch,\n        logger: ctx.logger,\n        commitMessage: config.getOptionalString(\n          'scaffolder.defaultCommitMessage',\n        ),\n        gitAuthorInfo,\n      });\n\n      ctx.output('commitHash', commitResult?.commitHash);\n      ctx.output('remoteUrl', remoteUrl);\n      ctx.output('repoContentsUrl', repoContentsUrl);\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputError } from '@backstage/errors';\nimport {\n  getBitbucketServerRequestOptions,\n  ScmIntegrationRegistry,\n} from '@backstage/integration';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport fetch, { Response, RequestInit } from 'node-fetch';\nimport { initRepoAndPush } from '../helpers';\nimport { getRepoSourceDirectory, parseRepoUrl } from './util';\nimport { Config } from '@backstage/config';\n\nconst createRepository = async (opts: {\n  project: string;\n  repo: string;\n  description?: string;\n  repoVisibility: 'private' | 'public';\n  defaultBranch: string;\n  authorization: string;\n  apiBaseUrl: string;\n}) => {\n  const {\n    project,\n    repo,\n    description,\n    authorization,\n    repoVisibility,\n    defaultBranch,\n    apiBaseUrl,\n  } = opts;\n\n  let response: Response;\n  const options: RequestInit = {\n    method: 'POST',\n    body: JSON.stringify({\n      name: repo,\n      description: description,\n      defaultBranch: defaultBranch,\n      public: repoVisibility === 'public',\n    }),\n    headers: {\n      Authorization: authorization,\n      'Content-Type': 'application/json',\n    },\n  };\n\n  try {\n    response = await fetch(`${apiBaseUrl}/projects/${project}/repos`, options);\n  } catch (e) {\n    throw new Error(`Unable to create repository, ${e}`);\n  }\n\n  if (response.status !== 201) {\n    throw new Error(\n      `Unable to create repository, ${response.status} ${\n        response.statusText\n      }, ${await response.text()}`,\n    );\n  }\n\n  const r = await response.json();\n  let remoteUrl = '';\n  for (const link of r.links.clone) {\n    if (link.name === 'http') {\n      remoteUrl = link.href;\n    }\n  }\n\n  const repoContentsUrl = `${r.links.self[0].href}`;\n  return { remoteUrl, repoContentsUrl };\n};\n\nconst performEnableLFS = async (opts: {\n  authorization: string;\n  host: string;\n  project: string;\n  repo: string;\n}) => {\n  const { authorization, host, project, repo } = opts;\n\n  const options: RequestInit = {\n    method: 'PUT',\n    headers: {\n      Authorization: authorization,\n    },\n  };\n\n  const { ok, status, statusText } = await fetch(\n    `https://${host}/rest/git-lfs/admin/projects/${project}/repos/${repo}/enabled`,\n    options,\n  );\n\n  if (!ok)\n    throw new Error(\n      `Failed to enable LFS in the repository, ${status}: ${statusText}`,\n    );\n};\n\n/**\n * Creates a new action that initializes a git repository of the content in the workspace\n * and publishes it to Bitbucket Server.\n * @public\n */\nexport function createPublishBitbucketServerAction(options: {\n  integrations: ScmIntegrationRegistry;\n  config: Config;\n}) {\n  const { integrations, config } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    description?: string;\n    defaultBranch?: string;\n    repoVisibility?: 'private' | 'public';\n    sourcePath?: string;\n    enableLFS?: boolean;\n    token?: string;\n    gitCommitMessage?: string;\n    gitAuthorName?: string;\n    gitAuthorEmail?: string;\n  }>({\n    id: 'publish:bitbucketServer',\n    description:\n      'Initializes a git repository of the content in the workspace, and publishes it to Bitbucket Server.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl'],\n        properties: {\n          repoUrl: {\n            title: 'Repository Location',\n            type: 'string',\n          },\n          description: {\n            title: 'Repository Description',\n            type: 'string',\n          },\n          repoVisibility: {\n            title: 'Repository Visibility',\n            type: 'string',\n            enum: ['private', 'public'],\n          },\n          defaultBranch: {\n            title: 'Default Branch',\n            type: 'string',\n            description: `Sets the default branch on the repository. The default value is 'master'`,\n          },\n          sourcePath: {\n            title: 'Source Path',\n            description:\n              'Path within the workspace that will be used as the repository root. If omitted, the entire workspace will be published as the repository.',\n            type: 'string',\n          },\n          enableLFS: {\n            title: 'Enable LFS?',\n            description: 'Enable LFS for the repository.',\n            type: 'boolean',\n          },\n          token: {\n            title: 'Authentication Token',\n            type: 'string',\n            description:\n              'The token to use for authorization to BitBucket Server',\n          },\n          gitCommitMessage: {\n            title: 'Git Commit Message',\n            type: 'string',\n            description: `Sets the commit message on the repository. The default value is 'initial commit'`,\n          },\n          gitAuthorName: {\n            title: 'Author Name',\n            type: 'string',\n            description: `Sets the author name for the commit. The default value is 'Scaffolder'`,\n          },\n          gitAuthorEmail: {\n            title: 'Author Email',\n            type: 'string',\n            description: `Sets the author email for the commit.`,\n          },\n        },\n      },\n      output: {\n        type: 'object',\n        properties: {\n          remoteUrl: {\n            title: 'A URL to the repository with the provider',\n            type: 'string',\n          },\n          repoContentsUrl: {\n            title: 'A URL to the root of the repository',\n            type: 'string',\n          },\n          commitHash: {\n            title: 'The git commit hash of the initial commit',\n            type: 'string',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        description,\n        defaultBranch = 'master',\n        repoVisibility = 'private',\n        enableLFS = false,\n        gitCommitMessage = 'initial commit',\n        gitAuthorName,\n        gitAuthorEmail,\n      } = ctx.input;\n\n      const { project, repo, host } = parseRepoUrl(repoUrl, integrations);\n\n      if (!project) {\n        throw new InputError(\n          `Invalid URL provider was included in the repo URL to create ${ctx.input.repoUrl}, missing project`,\n        );\n      }\n\n      const integrationConfig = integrations.bitbucketServer.byHost(host);\n      if (!integrationConfig) {\n        throw new InputError(\n          `No matching integration configuration for host ${host}, please check your integrations config`,\n        );\n      }\n\n      const token = ctx.input.token ?? integrationConfig.config.token;\n\n      const authConfig = {\n        ...integrationConfig.config,\n        ...{ token },\n      };\n      const reqOpts = getBitbucketServerRequestOptions(authConfig);\n      const authorization = reqOpts.headers.Authorization;\n      if (!authorization) {\n        throw new Error(\n          `Authorization has not been provided for ${integrationConfig.config.host}. Please add either (a) a user login auth token, or (b) a token or (c) username + password to the integration config.`,\n        );\n      }\n\n      const apiBaseUrl = integrationConfig.config.apiBaseUrl;\n\n      const { remoteUrl, repoContentsUrl } = await createRepository({\n        authorization,\n        project,\n        repo,\n        repoVisibility,\n        defaultBranch,\n        description,\n        apiBaseUrl,\n      });\n\n      const gitAuthorInfo = {\n        name: gitAuthorName\n          ? gitAuthorName\n          : config.getOptionalString('scaffolder.defaultAuthor.name'),\n        email: gitAuthorEmail\n          ? gitAuthorEmail\n          : config.getOptionalString('scaffolder.defaultAuthor.email'),\n      };\n\n      const auth = authConfig.token\n        ? {\n            token: token!,\n          }\n        : {\n            username: authConfig.username!,\n            password: authConfig.password!,\n          };\n\n      const commitResult = await initRepoAndPush({\n        dir: getRepoSourceDirectory(ctx.workspacePath, ctx.input.sourcePath),\n        remoteUrl,\n        auth,\n        defaultBranch,\n        logger: ctx.logger,\n        commitMessage: gitCommitMessage\n          ? gitCommitMessage\n          : config.getOptionalString('scaffolder.defaultCommitMessage'),\n        gitAuthorInfo,\n      });\n\n      if (enableLFS) {\n        await performEnableLFS({ authorization, host, project, repo });\n      }\n\n      ctx.output('commitHash', commitResult?.commitHash);\n      ctx.output('remoteUrl', remoteUrl);\n      ctx.output('repoContentsUrl', repoContentsUrl);\n    },\n  });\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport crypto from 'crypto';\nimport { InputError } from '@backstage/errors';\nimport { Config } from '@backstage/config';\nimport {\n  GerritIntegrationConfig,\n  getGerritRequestOptions,\n  ScmIntegrationRegistry,\n} from '@backstage/integration';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { getRepoSourceDirectory, parseRepoUrl } from './util';\nimport fetch, { Response, RequestInit } from 'node-fetch';\nimport { initRepoAndPush } from '../helpers';\n\nconst createGerritProject = async (\n  config: GerritIntegrationConfig,\n  options: {\n    projectName: string;\n    parent: string;\n    owner?: string;\n    description: string;\n  },\n): Promise<void> => {\n  const { projectName, parent, owner, description } = options;\n\n  const fetchOptions: RequestInit = {\n    method: 'PUT',\n    body: JSON.stringify({\n      parent,\n      description,\n      owners: owner ? [owner] : [],\n      create_empty_commit: false,\n    }),\n    headers: {\n      ...getGerritRequestOptions(config).headers,\n      'Content-Type': 'application/json',\n    },\n  };\n  const response: Response = await fetch(\n    `${config.baseUrl}/a/projects/${encodeURIComponent(projectName)}`,\n    fetchOptions,\n  );\n  if (response.status !== 201) {\n    throw new Error(\n      `Unable to create repository, ${response.status} ${\n        response.statusText\n      }, ${await response.text()}`,\n    );\n  }\n};\n\nconst generateCommitMessage = (\n  config: Config,\n  commitSubject?: string,\n): string => {\n  const changeId = crypto.randomBytes(20).toString('hex');\n  const msg = `${\n    config.getOptionalString('scaffolder.defaultCommitMessage') || commitSubject\n  }\\n\\nChange-Id: I${changeId}`;\n  return msg;\n};\n\n/**\n * Creates a new action that initializes a git repository of the content in the workspace\n * and publishes it to a Gerrit instance.\n * @public\n */\nexport function createPublishGerritAction(options: {\n  integrations: ScmIntegrationRegistry;\n  config: Config;\n}) {\n  const { integrations, config } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    description: string;\n    defaultBranch?: string;\n    gitCommitMessage?: string;\n    gitAuthorName?: string;\n    gitAuthorEmail?: string;\n    sourcePath?: string;\n  }>({\n    id: 'publish:gerrit',\n    description:\n      'Initializes a git repository of the content in the workspace, and publishes it to Gerrit.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl'],\n        properties: {\n          repoUrl: {\n            title: 'Repository Location',\n            type: 'string',\n          },\n          description: {\n            title: 'Repository Description',\n            type: 'string',\n          },\n          defaultBranch: {\n            title: 'Default Branch',\n            type: 'string',\n            description: `Sets the default branch on the repository. The default value is 'master'`,\n          },\n          gitCommitMessage: {\n            title: 'Git Commit Message',\n            type: 'string',\n            description: `Sets the commit message on the repository. The default value is 'initial commit'`,\n          },\n          gitAuthorName: {\n            title: 'Default Author Name',\n            type: 'string',\n            description: `Sets the default author name for the commit. The default value is 'Scaffolder'`,\n          },\n          gitAuthorEmail: {\n            title: 'Default Author Email',\n            type: 'string',\n            description: `Sets the default author email for the commit.`,\n          },\n          sourcePath: {\n            title: 'Source Path',\n            type: 'string',\n            description: `Path within the workspace that will be used as the repository root. If omitted, the entire workspace will be published as the repository.`,\n          },\n        },\n      },\n      output: {\n        type: 'object',\n        properties: {\n          remoteUrl: {\n            title: 'A URL to the repository with the provider',\n            type: 'string',\n          },\n          repoContentsUrl: {\n            title: 'A URL to the root of the repository',\n            type: 'string',\n          },\n          commitHash: {\n            title: 'The git commit hash of the initial commit',\n            type: 'string',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        description,\n        defaultBranch = 'master',\n        gitAuthorName,\n        gitAuthorEmail,\n        gitCommitMessage = 'initial commit',\n        sourcePath,\n      } = ctx.input;\n      const { repo, host, owner, workspace } = parseRepoUrl(\n        repoUrl,\n        integrations,\n      );\n\n      const integrationConfig = integrations.gerrit.byHost(host);\n\n      if (!integrationConfig) {\n        throw new InputError(\n          `No matching integration configuration for host ${host}, please check your integrations config`,\n        );\n      }\n\n      if (!workspace) {\n        throw new InputError(\n          `Invalid URL provider was included in the repo URL to create ${ctx.input.repoUrl}, missing workspace`,\n        );\n      }\n\n      await createGerritProject(integrationConfig.config, {\n        description,\n        owner: owner,\n        projectName: repo,\n        parent: workspace,\n      });\n      const auth = {\n        username: integrationConfig.config.username!,\n        password: integrationConfig.config.password!,\n      };\n      const gitAuthorInfo = {\n        name: gitAuthorName\n          ? gitAuthorName\n          : config.getOptionalString('scaffolder.defaultAuthor.name'),\n        email: gitAuthorEmail\n          ? gitAuthorEmail\n          : config.getOptionalString('scaffolder.defaultAuthor.email'),\n      };\n\n      const remoteUrl = `${integrationConfig.config.cloneUrl}/a/${repo}`;\n      const commitResult = await initRepoAndPush({\n        dir: getRepoSourceDirectory(ctx.workspacePath, sourcePath),\n        remoteUrl,\n        auth,\n        defaultBranch,\n        logger: ctx.logger,\n        commitMessage: generateCommitMessage(config, gitCommitMessage),\n        gitAuthorInfo,\n      });\n\n      const repoContentsUrl = `${integrationConfig.config.gitilesBaseUrl}/${repo}/+/refs/heads/${defaultBranch}`;\n      ctx.output('remoteUrl', remoteUrl);\n      ctx.output('commitHash', commitResult?.commitHash);\n      ctx.output('repoContentsUrl', repoContentsUrl);\n    },\n  });\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport crypto from 'crypto';\nimport { InputError } from '@backstage/errors';\nimport { Config } from '@backstage/config';\nimport { ScmIntegrationRegistry } from '@backstage/integration';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { getRepoSourceDirectory, parseRepoUrl } from './util';\nimport { commitAndPushRepo } from '../helpers';\n\nconst generateGerritChangeId = (): string => {\n  const changeId = crypto.randomBytes(20).toString('hex');\n  return `I${changeId}`;\n};\n\n/**\n * Creates a new action that creates a Gerrit review\n * @public\n */\nexport function createPublishGerritReviewAction(options: {\n  integrations: ScmIntegrationRegistry;\n  config: Config;\n}) {\n  const { integrations, config } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    branch?: string;\n    sourcePath?: string;\n    gitCommitMessage?: string;\n    gitAuthorName?: string;\n    gitAuthorEmail?: string;\n  }>({\n    id: 'publish:gerrit:review',\n    description: 'Creates a new Gerrit review.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl', 'gitCommitMessage'],\n        properties: {\n          repoUrl: {\n            title: 'Repository Location',\n            type: 'string',\n          },\n          branch: {\n            title: 'Repository branch',\n            type: 'string',\n            description:\n              'Branch of the repository the review will be created on',\n          },\n          sourcePath: {\n            type: 'string',\n            title: 'Working Subdirectory',\n            description:\n              'Subdirectory of working directory containing the repository',\n          },\n          gitCommitMessage: {\n            title: 'Git Commit Message',\n            type: 'string',\n            description: `Sets the commit message on the repository.`,\n          },\n          gitAuthorName: {\n            title: 'Default Author Name',\n            type: 'string',\n            description: `Sets the default author name for the commit. The default value is 'Scaffolder'`,\n          },\n          gitAuthorEmail: {\n            title: 'Default Author Email',\n            type: 'string',\n            description: `Sets the default author email for the commit.`,\n          },\n        },\n      },\n      output: {\n        type: 'object',\n        properties: {\n          reviewUrl: {\n            title: 'A URL to the review',\n            type: 'string',\n          },\n          repoContentsUrl: {\n            title: 'A URL to the root of the repository',\n            type: 'string',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        branch = 'master',\n        sourcePath,\n        gitAuthorName,\n        gitAuthorEmail,\n        gitCommitMessage,\n      } = ctx.input;\n      const { host, repo } = parseRepoUrl(repoUrl, integrations);\n\n      if (!gitCommitMessage) {\n        throw new InputError(`Missing gitCommitMessage input`);\n      }\n\n      const integrationConfig = integrations.gerrit.byHost(host);\n\n      if (!integrationConfig) {\n        throw new InputError(\n          `No matching integration configuration for host ${host}, please check your integrations config`,\n        );\n      }\n\n      const auth = {\n        username: integrationConfig.config.username!,\n        password: integrationConfig.config.password!,\n      };\n      const gitAuthorInfo = {\n        name: gitAuthorName\n          ? gitAuthorName\n          : config.getOptionalString('scaffolder.defaultAuthor.name'),\n        email: gitAuthorEmail\n          ? gitAuthorEmail\n          : config.getOptionalString('scaffolder.defaultAuthor.email'),\n      };\n      const changeId = generateGerritChangeId();\n      const commitMessage = `${gitCommitMessage}\\n\\nChange-Id: ${changeId}`;\n\n      await commitAndPushRepo({\n        dir: getRepoSourceDirectory(ctx.workspacePath, sourcePath),\n        auth,\n        logger: ctx.logger,\n        commitMessage,\n        gitAuthorInfo,\n        branch,\n        remoteRef: `refs/for/${branch}`,\n      });\n\n      const repoContentsUrl = `${integrationConfig.config.gitilesBaseUrl}/${repo}/+/refs/heads/${branch}`;\n      const reviewUrl = `${integrationConfig.config.baseUrl}/#/q/${changeId}`;\n      ctx.logger?.info(`Review available on ${reviewUrl}`);\n      ctx.output('repoContentsUrl', repoContentsUrl);\n      ctx.output('reviewUrl', reviewUrl);\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config } from '@backstage/config';\nimport { InputError } from '@backstage/errors';\nimport {\n  GithubCredentialsProvider,\n  ScmIntegrationRegistry,\n} from '@backstage/integration';\nimport { Octokit } from 'octokit';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport {\n  createGithubRepoWithCollaboratorsAndTopics,\n  getOctokitOptions,\n  initRepoPushAndProtect,\n} from '../github/helpers';\nimport * as inputProps from '../github/inputProperties';\nimport * as outputProps from '../github/outputProperties';\nimport { parseRepoUrl } from './util';\n\n/**\n * Creates a new action that initializes a git repository of the content in the workspace\n * and publishes it to GitHub.\n *\n * @public\n */\nexport function createPublishGithubAction(options: {\n  integrations: ScmIntegrationRegistry;\n  config: Config;\n  githubCredentialsProvider?: GithubCredentialsProvider;\n}) {\n  const { integrations, config, githubCredentialsProvider } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    description?: string;\n    homepage?: string;\n    access?: string;\n    defaultBranch?: string;\n    protectDefaultBranch?: boolean;\n    protectEnforceAdmins?: boolean;\n    deleteBranchOnMerge?: boolean;\n    gitCommitMessage?: string;\n    gitAuthorName?: string;\n    gitAuthorEmail?: string;\n    allowRebaseMerge?: boolean;\n    allowSquashMerge?: boolean;\n    squashMergeCommitTitle?: 'PR_TITLE' | 'COMMIT_OR_PR_TITLE';\n    squashMergeCommitMessage?: 'PR_BODY' | 'COMMIT_MESSAGES' | 'BLANK';\n    allowMergeCommit?: boolean;\n    allowAutoMerge?: boolean;\n    sourcePath?: string;\n    bypassPullRequestAllowances?:\n      | {\n          users?: string[];\n          teams?: string[];\n          apps?: string[];\n        }\n      | undefined;\n    requiredApprovingReviewCount?: number;\n    restrictions?:\n      | {\n          users: string[];\n          teams: string[];\n          apps?: string[];\n        }\n      | undefined;\n    requireCodeOwnerReviews?: boolean;\n    dismissStaleReviews?: boolean;\n    requiredStatusCheckContexts?: string[];\n    requireBranchesToBeUpToDate?: boolean;\n    requiredConversationResolution?: boolean;\n    repoVisibility?: 'private' | 'internal' | 'public';\n    collaborators?: Array<\n      | {\n          user: string;\n          access: string;\n        }\n      | {\n          team: string;\n          access: string;\n        }\n      | {\n          /** @deprecated This field is deprecated in favor of team */\n          username: string;\n          access: 'pull' | 'push' | 'admin' | 'maintain' | 'triage';\n        }\n    >;\n    hasProjects?: boolean | undefined;\n    hasWiki?: boolean | undefined;\n    hasIssues?: boolean | undefined;\n    token?: string;\n    topics?: string[];\n    requiredCommitSigning?: boolean;\n  }>({\n    id: 'publish:github',\n    description:\n      'Initializes a git repository of contents in workspace and publishes it to GitHub.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl'],\n        properties: {\n          repoUrl: inputProps.repoUrl,\n          description: inputProps.description,\n          homepage: inputProps.homepage,\n          access: inputProps.access,\n          bypassPullRequestAllowances: inputProps.bypassPullRequestAllowances,\n          requiredApprovingReviewCount: inputProps.requiredApprovingReviewCount,\n          restrictions: inputProps.restrictions,\n          requireCodeOwnerReviews: inputProps.requireCodeOwnerReviews,\n          dismissStaleReviews: inputProps.dismissStaleReviews,\n          requiredStatusCheckContexts: inputProps.requiredStatusCheckContexts,\n          requireBranchesToBeUpToDate: inputProps.requireBranchesToBeUpToDate,\n          requiredConversationResolution:\n            inputProps.requiredConversationResolution,\n          repoVisibility: inputProps.repoVisibility,\n          defaultBranch: inputProps.defaultBranch,\n          protectDefaultBranch: inputProps.protectDefaultBranch,\n          protectEnforceAdmins: inputProps.protectEnforceAdmins,\n          deleteBranchOnMerge: inputProps.deleteBranchOnMerge,\n          gitCommitMessage: inputProps.gitCommitMessage,\n          gitAuthorName: inputProps.gitAuthorName,\n          gitAuthorEmail: inputProps.gitAuthorEmail,\n          allowMergeCommit: inputProps.allowMergeCommit,\n          allowSquashMerge: inputProps.allowSquashMerge,\n          squashMergeCommitTitle: inputProps.squashMergeCommitTitle,\n          squashMergeCommitMessage: inputProps.squashMergeCommitMessage,\n          allowRebaseMerge: inputProps.allowRebaseMerge,\n          allowAutoMerge: inputProps.allowAutoMerge,\n          sourcePath: inputProps.sourcePath,\n          collaborators: inputProps.collaborators,\n          hasProjects: inputProps.hasProjects,\n          hasWiki: inputProps.hasWiki,\n          hasIssues: inputProps.hasIssues,\n          token: inputProps.token,\n          topics: inputProps.topics,\n          requiredCommitSigning: inputProps.requiredCommitSigning,\n        },\n      },\n      output: {\n        type: 'object',\n        properties: {\n          remoteUrl: outputProps.remoteUrl,\n          repoContentsUrl: outputProps.repoContentsUrl,\n          commitHash: outputProps.commitHash,\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        description,\n        homepage,\n        access,\n        requireCodeOwnerReviews = false,\n        dismissStaleReviews = false,\n        bypassPullRequestAllowances,\n        requiredApprovingReviewCount = 1,\n        restrictions,\n        requiredStatusCheckContexts = [],\n        requireBranchesToBeUpToDate = true,\n        requiredConversationResolution = false,\n        repoVisibility = 'private',\n        defaultBranch = 'master',\n        protectDefaultBranch = true,\n        protectEnforceAdmins = true,\n        deleteBranchOnMerge = false,\n        gitCommitMessage = 'initial commit',\n        gitAuthorName,\n        gitAuthorEmail,\n        allowMergeCommit = true,\n        allowSquashMerge = true,\n        squashMergeCommitTitle = 'COMMIT_OR_PR_TITLE',\n        squashMergeCommitMessage = 'COMMIT_MESSAGES',\n        allowRebaseMerge = true,\n        allowAutoMerge = false,\n        collaborators,\n        hasProjects = undefined,\n        hasWiki = undefined,\n        hasIssues = undefined,\n        topics,\n        token: providedToken,\n        requiredCommitSigning = false,\n      } = ctx.input;\n\n      const octokitOptions = await getOctokitOptions({\n        integrations,\n        credentialsProvider: githubCredentialsProvider,\n        token: providedToken,\n        repoUrl: repoUrl,\n      });\n      const client = new Octokit(octokitOptions);\n\n      const { owner, repo } = parseRepoUrl(repoUrl, integrations);\n\n      if (!owner) {\n        throw new InputError('Invalid repository owner provided in repoUrl');\n      }\n\n      const newRepo = await createGithubRepoWithCollaboratorsAndTopics(\n        client,\n        repo,\n        owner,\n        repoVisibility,\n        description,\n        homepage,\n        deleteBranchOnMerge,\n        allowMergeCommit,\n        allowSquashMerge,\n        squashMergeCommitTitle,\n        squashMergeCommitMessage,\n        allowRebaseMerge,\n        allowAutoMerge,\n        access,\n        collaborators,\n        hasProjects,\n        hasWiki,\n        hasIssues,\n        topics,\n        ctx.logger,\n      );\n\n      const remoteUrl = newRepo.clone_url;\n      const repoContentsUrl = `${newRepo.html_url}/blob/${defaultBranch}`;\n\n      const commitResult = await initRepoPushAndProtect(\n        remoteUrl,\n        octokitOptions.auth,\n        ctx.workspacePath,\n        ctx.input.sourcePath,\n        defaultBranch,\n        protectDefaultBranch,\n        protectEnforceAdmins,\n        owner,\n        client,\n        repo,\n        requireCodeOwnerReviews,\n        bypassPullRequestAllowances,\n        requiredApprovingReviewCount,\n        restrictions,\n        requiredStatusCheckContexts,\n        requireBranchesToBeUpToDate,\n        requiredConversationResolution,\n        config,\n        ctx.logger,\n        gitCommitMessage,\n        gitAuthorName,\n        gitAuthorEmail,\n        dismissStaleReviews,\n        requiredCommitSigning,\n      );\n\n      ctx.output('commitHash', commitResult?.commitHash);\n      ctx.output('remoteUrl', remoteUrl);\n      ctx.output('repoContentsUrl', repoContentsUrl);\n    },\n  });\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { promises as fs } from 'fs';\nimport globby from 'globby';\nimport limiterFactory from 'p-limit';\nimport { resolveSafeChildPath } from '@backstage/backend-common';\nimport { SerializedFile } from './types';\nimport { isError } from '@backstage/errors';\n\nconst DEFAULT_GLOB_PATTERNS = ['./**', '!.git'];\n\nexport const isExecutable = (fileMode: number | undefined) => {\n  if (!fileMode) {\n    return false;\n  }\n\n  const executeBitMask = 0o000111;\n  const res = fileMode & executeBitMask;\n  return res > 0;\n};\n\nasync function asyncFilter<T>(\n  array: T[],\n  callback: (value: T, index: number, array: T[]) => Promise<boolean>,\n): Promise<T[]> {\n  const filterMap = await Promise.all(array.map(callback));\n  return array.filter((_value, index) => filterMap[index]);\n}\n\nexport async function serializeDirectoryContents(\n  sourcePath: string,\n  options?: {\n    gitignore?: boolean;\n    globPatterns?: string[];\n  },\n): Promise<SerializedFile[]> {\n  const paths = await globby(options?.globPatterns ?? DEFAULT_GLOB_PATTERNS, {\n    cwd: sourcePath,\n    dot: true,\n    gitignore: options?.gitignore,\n    followSymbolicLinks: false,\n    // In order to pick up 'broken' symlinks, we oxymoronically request files AND folders yet we filter out folders\n    // This is because broken symlinks aren't classed as files so we need to glob everything\n    onlyFiles: false,\n    objectMode: true,\n    stats: true,\n  });\n\n  const limiter = limiterFactory(10);\n\n  const valid = await asyncFilter(paths, async ({ dirent, path }) => {\n    if (dirent.isDirectory()) return false;\n    if (!dirent.isSymbolicLink()) return true;\n\n    const safePath = resolveSafeChildPath(sourcePath, path);\n\n    // we only want files that don't exist\n    try {\n      await fs.stat(safePath);\n      return false;\n    } catch (e) {\n      return isError(e) && e.code === 'ENOENT';\n    }\n  });\n\n  return Promise.all(\n    valid.map(async ({ dirent, path, stats }) => ({\n      path,\n      content: await limiter(async () => {\n        const absFilePath = resolveSafeChildPath(sourcePath, path);\n        if (dirent.isSymbolicLink()) {\n          return fs.readlink(absFilePath, 'buffer');\n        }\n        return fs.readFile(absFilePath);\n      }),\n      executable: isExecutable(stats?.mode),\n      symlink: dirent.isSymbolicLink(),\n    })),\n  );\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fs from 'fs-extra';\nimport { dirname } from 'path';\nimport { resolveSafeChildPath } from '@backstage/backend-common';\nimport { SerializedFile } from './types';\n\n/**\n * Deserializes a list of serialized files into the target directory.\n *\n * This method uses `resolveSafeChildPath` to make sure that files are\n * not written outside of the target directory.\n *\n * @internal\n */\nexport async function deserializeDirectoryContents(\n  targetPath: string,\n  files: SerializedFile[],\n): Promise<void> {\n  for (const file of files) {\n    const filePath = resolveSafeChildPath(targetPath, file.path);\n    await fs.ensureDir(dirname(filePath));\n    await fs.writeFile(filePath, file.content); // Ignore file mode\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport path from 'path';\nimport { parseRepoUrl } from './util';\nimport {\n  GithubCredentialsProvider,\n  ScmIntegrationRegistry,\n} from '@backstage/integration';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { Octokit } from 'octokit';\nimport { InputError, CustomErrorBase } from '@backstage/errors';\nimport { resolveSafeChildPath } from '@backstage/backend-common';\nimport { createPullRequest } from 'octokit-plugin-create-pull-request';\nimport { getOctokitOptions } from '../github/helpers';\nimport {\n  SerializedFile,\n  serializeDirectoryContents,\n} from '../../../../lib/files';\nimport { Logger } from 'winston';\n\nexport type Encoding = 'utf-8' | 'base64';\n\nclass GithubResponseError extends CustomErrorBase {}\n\n/** @public */\nexport type OctokitWithPullRequestPluginClient = Octokit & {\n  createPullRequest(options: createPullRequest.Options): Promise<{\n    data: {\n      html_url: string;\n      number: number;\n    };\n  } | null>;\n};\n\n/**\n * The options passed to the client factory function.\n * @public\n */\nexport type CreateGithubPullRequestClientFactoryInput = {\n  integrations: ScmIntegrationRegistry;\n  githubCredentialsProvider?: GithubCredentialsProvider;\n  host: string;\n  owner: string;\n  repo: string;\n  token?: string;\n};\n\nexport const defaultClientFactory = async ({\n  integrations,\n  githubCredentialsProvider,\n  owner,\n  repo,\n  host = 'github.com',\n  token: providedToken,\n}: CreateGithubPullRequestClientFactoryInput): Promise<OctokitWithPullRequestPluginClient> => {\n  const [encodedHost, encodedOwner, encodedRepo] = [host, owner, repo].map(\n    encodeURIComponent,\n  );\n\n  const octokitOptions = await getOctokitOptions({\n    integrations,\n    credentialsProvider: githubCredentialsProvider,\n    repoUrl: `${encodedHost}?owner=${encodedOwner}&repo=${encodedRepo}`,\n    token: providedToken,\n  });\n\n  const OctokitPR = Octokit.plugin(createPullRequest);\n  return new OctokitPR({\n    ...octokitOptions,\n    ...{ throttle: { enabled: false } },\n  });\n};\n\n/**\n * The options passed to {@link createPublishGithubPullRequestAction} method\n * @public\n */\nexport interface CreateGithubPullRequestActionOptions {\n  /**\n   * An instance of {@link @backstage/integration#ScmIntegrationRegistry} that will be used in the action.\n   */\n  integrations: ScmIntegrationRegistry;\n  /**\n   * An instance of {@link @backstage/integration#GithubCredentialsProvider} that will be used to get credentials for the action.\n   */\n  githubCredentialsProvider?: GithubCredentialsProvider;\n  /**\n   * A method to return the Octokit client with the Pull Request Plugin.\n   */\n  clientFactory?: (\n    input: CreateGithubPullRequestClientFactoryInput,\n  ) => Promise<OctokitWithPullRequestPluginClient>;\n}\n\ntype GithubPullRequest = {\n  owner: string;\n  repo: string;\n  number: number;\n};\n\n/**\n * Creates a Github Pull Request action.\n * @public\n */\nexport const createPublishGithubPullRequestAction = (\n  options: CreateGithubPullRequestActionOptions,\n) => {\n  const {\n    integrations,\n    githubCredentialsProvider,\n    clientFactory = defaultClientFactory,\n  } = options;\n\n  return createTemplateAction<{\n    title: string;\n    branchName: string;\n    description: string;\n    repoUrl: string;\n    draft?: boolean;\n    targetPath?: string;\n    sourcePath?: string;\n    token?: string;\n    reviewers?: string[];\n    teamReviewers?: string[];\n    commitMessage?: string;\n  }>({\n    id: 'publish:github:pull-request',\n    schema: {\n      input: {\n        required: ['repoUrl', 'title', 'description', 'branchName'],\n        type: 'object',\n        properties: {\n          repoUrl: {\n            title: 'Repository Location',\n            description: `Accepts the format 'github.com?repo=reponame&owner=owner' where 'reponame' is the repository name and 'owner' is an organization or username`,\n            type: 'string',\n          },\n          branchName: {\n            type: 'string',\n            title: 'Branch Name',\n            description: 'The name for the branch',\n          },\n          title: {\n            type: 'string',\n            title: 'Pull Request Name',\n            description: 'The name for the pull request',\n          },\n          description: {\n            type: 'string',\n            title: 'Pull Request Description',\n            description: 'The description of the pull request',\n          },\n          draft: {\n            type: 'boolean',\n            title: 'Create as Draft',\n            description: 'Create a draft pull request',\n          },\n          sourcePath: {\n            type: 'string',\n            title: 'Working Subdirectory',\n            description:\n              'Subdirectory of working directory to copy changes from',\n          },\n          targetPath: {\n            type: 'string',\n            title: 'Repository Subdirectory',\n            description: 'Subdirectory of repository to apply changes to',\n          },\n          token: {\n            title: 'Authentication Token',\n            type: 'string',\n            description: 'The token to use for authorization to GitHub',\n          },\n          reviewers: {\n            title: 'Pull Request Reviewers',\n            type: 'array',\n            items: {\n              type: 'string',\n            },\n            description:\n              'The users that will be added as reviewers to the pull request',\n          },\n          teamReviewers: {\n            title: 'Pull Request Team Reviewers',\n            type: 'array',\n            items: {\n              type: 'string',\n            },\n            description:\n              'The teams that will be added as reviewers to the pull request',\n          },\n          commitMessage: {\n            type: 'string',\n            title: 'Commit Message',\n            description: 'The commit message for the pull request commit',\n          },\n        },\n      },\n      output: {\n        required: ['remoteUrl'],\n        type: 'object',\n        properties: {\n          remoteUrl: {\n            type: 'string',\n            title: 'Pull Request URL',\n            description: 'Link to the pull request in Github',\n          },\n          pullRequestNumber: {\n            type: 'number',\n            title: 'Pull Request Number',\n            description: 'The pull request number',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        branchName,\n        title,\n        description,\n        draft,\n        targetPath,\n        sourcePath,\n        token: providedToken,\n        reviewers,\n        teamReviewers,\n        commitMessage,\n      } = ctx.input;\n\n      const { owner, repo, host } = parseRepoUrl(repoUrl, integrations);\n\n      if (!owner) {\n        throw new InputError(\n          `No owner provided for host: ${host}, and repo ${repo}`,\n        );\n      }\n\n      const client = await clientFactory({\n        integrations,\n        githubCredentialsProvider,\n        host,\n        owner,\n        repo,\n        token: providedToken,\n      });\n\n      const fileRoot = sourcePath\n        ? resolveSafeChildPath(ctx.workspacePath, sourcePath)\n        : ctx.workspacePath;\n\n      const directoryContents = await serializeDirectoryContents(fileRoot, {\n        gitignore: true,\n      });\n\n      const determineFileMode = (file: SerializedFile): string => {\n        if (file.symlink) return '120000';\n        if (file.executable) return '100755';\n        return '100644';\n      };\n\n      const determineFileEncoding = (\n        file: SerializedFile,\n      ): 'utf-8' | 'base64' => (file.symlink ? 'utf-8' : 'base64');\n\n      const files = Object.fromEntries(\n        directoryContents.map(file => [\n          targetPath ? path.posix.join(targetPath, file.path) : file.path,\n          {\n            // See the properties of tree items\n            // in https://docs.github.com/en/rest/reference/git#trees\n            mode: determineFileMode(file),\n            // Always use base64 encoding where possible to avoid doubling a binary file in size\n            // due to interpreting a binary file as utf-8 and sending github\n            // the utf-8 encoded content. Symlinks are kept as utf-8 to avoid them\n            // being formatted as a series of scrambled characters\n            //\n            // For example, the original gradle-wrapper.jar is 57.8k in https://github.com/kennethzfeng/pull-request-test/pull/5/files.\n            // Its size could be doubled to 98.3K (See https://github.com/kennethzfeng/pull-request-test/pull/4/files)\n            encoding: determineFileEncoding(file),\n            content: file.content.toString(determineFileEncoding(file)),\n          },\n        ]),\n      );\n\n      try {\n        const response = await client.createPullRequest({\n          owner,\n          repo,\n          title,\n          changes: [\n            {\n              files,\n              commit: commitMessage ?? title,\n            },\n          ],\n          body: description,\n          head: branchName,\n          draft,\n        });\n\n        if (!response) {\n          throw new GithubResponseError('null response from Github');\n        }\n\n        const pullRequestNumber = response.data.number;\n        if (reviewers || teamReviewers) {\n          const pullRequest = { owner, repo, number: pullRequestNumber };\n          await requestReviewersOnPullRequest(\n            pullRequest,\n            reviewers,\n            teamReviewers,\n            client,\n            ctx.logger,\n          );\n        }\n\n        ctx.output('remoteUrl', response.data.html_url);\n        ctx.output('pullRequestNumber', pullRequestNumber);\n      } catch (e) {\n        throw new GithubResponseError('Pull request creation failed', e);\n      }\n    },\n  });\n\n  async function requestReviewersOnPullRequest(\n    pr: GithubPullRequest,\n    reviewers: string[] | undefined,\n    teamReviewers: string[] | undefined,\n    client: Octokit,\n    logger: Logger,\n  ) {\n    try {\n      const result = await client.rest.pulls.requestReviewers({\n        owner: pr.owner,\n        repo: pr.repo,\n        pull_number: pr.number,\n        reviewers,\n        team_reviewers: teamReviewers,\n      });\n      const addedUsers = result.data.requested_reviewers?.join(', ') ?? '';\n      const addedTeams = result.data.requested_teams?.join(', ') ?? '';\n      logger.info(\n        `Added users [${addedUsers}] and teams [${addedTeams}] as reviewers to Pull request ${pr.number}`,\n      );\n    } catch (e) {\n      logger.error(\n        `Failure when adding reviewers to Pull request ${pr.number}`,\n        e,\n      );\n    }\n  }\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InputError } from '@backstage/errors';\nimport { ScmIntegrationRegistry } from '@backstage/integration';\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { Gitlab } from '@gitbeaker/node';\nimport { initRepoAndPush } from '../helpers';\nimport { getRepoSourceDirectory, parseRepoUrl } from './util';\nimport { Config } from '@backstage/config';\n\n/**\n * Creates a new action that initializes a git repository of the content in the workspace\n * and publishes it to GitLab.\n *\n * @public\n */\nexport function createPublishGitlabAction(options: {\n  integrations: ScmIntegrationRegistry;\n  config: Config;\n}) {\n  const { integrations, config } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    defaultBranch?: string;\n    repoVisibility?: 'private' | 'internal' | 'public';\n    sourcePath?: string;\n    token?: string;\n    gitCommitMessage?: string;\n    gitAuthorName?: string;\n    gitAuthorEmail?: string;\n    setUserAsOwner?: boolean;\n    topics?: string[];\n  }>({\n    id: 'publish:gitlab',\n    description:\n      'Initializes a git repository of the content in the workspace, and publishes it to GitLab.',\n    schema: {\n      input: {\n        type: 'object',\n        required: ['repoUrl'],\n        properties: {\n          repoUrl: {\n            title: 'Repository Location',\n            type: 'string',\n          },\n          repoVisibility: {\n            title: 'Repository Visibility',\n            type: 'string',\n            enum: ['private', 'public', 'internal'],\n          },\n          defaultBranch: {\n            title: 'Default Branch',\n            type: 'string',\n            description: `Sets the default branch on the repository. The default value is 'master'`,\n          },\n          gitCommitMessage: {\n            title: 'Git Commit Message',\n            type: 'string',\n            description: `Sets the commit message on the repository. The default value is 'initial commit'`,\n          },\n          gitAuthorName: {\n            title: 'Default Author Name',\n            type: 'string',\n            description: `Sets the default author name for the commit. The default value is 'Scaffolder'`,\n          },\n          gitAuthorEmail: {\n            title: 'Default Author Email',\n            type: 'string',\n            description: `Sets the default author email for the commit.`,\n          },\n          sourcePath: {\n            title: 'Source Path',\n            description:\n              'Path within the workspace that will be used as the repository root. If omitted, the entire workspace will be published as the repository.',\n            type: 'string',\n          },\n          token: {\n            title: 'Authentication Token',\n            type: 'string',\n            description: 'The token to use for authorization to GitLab',\n          },\n          setUserAsOwner: {\n            title: 'Set User As Owner',\n            type: 'boolean',\n            description:\n              'Set the token user as owner of the newly created repository. Requires a token authorized to do the edit in the integration configuration for the matching host',\n          },\n          topics: {\n            title: 'Topic labels',\n            description: 'Topic labels to apply on the repository.',\n            type: 'array',\n            items: {\n              type: 'string',\n            },\n          },\n        },\n      },\n      output: {\n        type: 'object',\n        properties: {\n          remoteUrl: {\n            title: 'A URL to the repository with the provider',\n            type: 'string',\n          },\n          repoContentsUrl: {\n            title: 'A URL to the root of the repository',\n            type: 'string',\n          },\n          projectId: {\n            title: 'The ID of the project',\n            type: 'string',\n          },\n          commitHash: {\n            title: 'The git commit hash of the initial commit',\n            type: 'string',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        repoUrl,\n        repoVisibility = 'private',\n        defaultBranch = 'master',\n        gitCommitMessage = 'initial commit',\n        gitAuthorName,\n        gitAuthorEmail,\n        setUserAsOwner = false,\n        topics = [],\n      } = ctx.input;\n      const { owner, repo, host } = parseRepoUrl(repoUrl, integrations);\n\n      if (!owner) {\n        throw new InputError(\n          `No owner provided for host: ${host}, and repo ${repo}`,\n        );\n      }\n\n      const integrationConfig = integrations.gitlab.byHost(host);\n\n      if (!integrationConfig) {\n        throw new InputError(\n          `No matching integration configuration for host ${host}, please check your integrations config`,\n        );\n      }\n\n      if (!integrationConfig.config.token && !ctx.input.token) {\n        throw new InputError(`No token available for host ${host}`);\n      }\n\n      const token = ctx.input.token || integrationConfig.config.token!;\n      const tokenType = ctx.input.token ? 'oauthToken' : 'token';\n\n      const client = new Gitlab({\n        host: integrationConfig.config.baseUrl,\n        [tokenType]: token,\n      });\n\n      let { id: targetNamespace } = (await client.Namespaces.show(owner)) as {\n        id: number;\n      };\n\n      const { id: userId } = (await client.Users.current()) as {\n        id: number;\n      };\n\n      if (!targetNamespace) {\n        targetNamespace = userId;\n      }\n\n      const { id: projectId, http_url_to_repo } = await client.Projects.create({\n        namespace_id: targetNamespace,\n        name: repo,\n        visibility: repoVisibility,\n        ...(topics.length ? { topics } : {}),\n      });\n\n      // When setUserAsOwner is true the input token is expected to come from an unprivileged user GitLab\n      // OAuth flow. In this case GitLab works in a way that allows the unprivileged user to\n      // create the repository, but not to push the default protected branch (e.g. master).\n      // In order to set the user as owner of the newly created repository we need to check that the\n      // GitLab integration configuration for the matching host contains a token and use\n      // such token to bootstrap a new privileged client.\n      if (setUserAsOwner && integrationConfig.config.token) {\n        const adminClient = new Gitlab({\n          host: integrationConfig.config.baseUrl,\n          token: integrationConfig.config.token,\n        });\n\n        await adminClient.ProjectMembers.add(projectId, userId, 50);\n      }\n\n      const remoteUrl = (http_url_to_repo as string).replace(/\\.git$/, '');\n      const repoContentsUrl = `${remoteUrl}/-/blob/${defaultBranch}`;\n\n      const gitAuthorInfo = {\n        name: gitAuthorName\n          ? gitAuthorName\n          : config.getOptionalString('scaffolder.defaultAuthor.name'),\n        email: gitAuthorEmail\n          ? gitAuthorEmail\n          : config.getOptionalString('scaffolder.defaultAuthor.email'),\n      };\n      const commitResult = await initRepoAndPush({\n        dir: getRepoSourceDirectory(ctx.workspacePath, ctx.input.sourcePath),\n        remoteUrl: http_url_to_repo as string,\n        defaultBranch,\n        auth: {\n          username: 'oauth2',\n          password: token,\n        },\n        logger: ctx.logger,\n        commitMessage: gitCommitMessage\n          ? gitCommitMessage\n          : config.getOptionalString('scaffolder.defaultCommitMessage'),\n        gitAuthorInfo,\n      });\n\n      ctx.output('commitHash', commitResult?.commitHash);\n      ctx.output('remoteUrl', remoteUrl);\n      ctx.output('repoContentsUrl', repoContentsUrl);\n      ctx.output('projectId', projectId);\n    },\n  });\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createTemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { Gitlab } from '@gitbeaker/node';\nimport { Types } from '@gitbeaker/core';\nimport path from 'path';\nimport { ScmIntegrationRegistry } from '@backstage/integration';\nimport { InputError } from '@backstage/errors';\nimport { parseRepoUrl } from './util';\nimport { resolveSafeChildPath } from '@backstage/backend-common';\nimport { serializeDirectoryContents } from '../../../../lib/files';\n\n/**\n * Create a new action that creates a gitlab merge request.\n *\n * @public\n */\nexport const createPublishGitlabMergeRequestAction = (options: {\n  integrations: ScmIntegrationRegistry;\n}) => {\n  const { integrations } = options;\n\n  return createTemplateAction<{\n    repoUrl: string;\n    title: string;\n    description: string;\n    branchName: string;\n    sourcePath?: string;\n    targetPath?: string;\n    token?: string;\n    commitAction?: 'create' | 'delete' | 'update';\n    /** @deprecated projectID passed as query parameters in the repoUrl */\n    projectid?: string;\n    removeSourceBranch?: boolean;\n    assignee?: string;\n  }>({\n    id: 'publish:gitlab:merge-request',\n    schema: {\n      input: {\n        required: ['repoUrl', 'branchName'],\n        type: 'object',\n        properties: {\n          repoUrl: {\n            type: 'string',\n            title: 'Repository Location',\n            description: `Accepts the format 'gitlab.com/group_name/project_name' where 'project_name' is the repository name and 'group_name' is a group or username`,\n          },\n          /** @deprecated projectID is passed as query parameters in the repoUrl */\n          projectid: {\n            type: 'string',\n            title: 'projectid',\n            description: 'Project ID/Name(slug) of the Gitlab Project',\n          },\n          title: {\n            type: 'string',\n            title: 'Merge Request Name',\n            description: 'The name for the merge request',\n          },\n          description: {\n            type: 'string',\n            title: 'Merge Request Description',\n            description: 'The description of the merge request',\n          },\n          branchName: {\n            type: 'string',\n            title: 'Destination Branch name',\n            description: 'The description of the merge request',\n          },\n          sourcePath: {\n            type: 'string',\n            title: 'Working Subdirectory',\n            description:\n              'Subdirectory of working directory to copy changes from',\n          },\n          targetPath: {\n            type: 'string',\n            title: 'Repository Subdirectory',\n            description: 'Subdirectory of repository to apply changes to',\n          },\n          token: {\n            title: 'Authentication Token',\n            type: 'string',\n            description: 'The token to use for authorization to GitLab',\n          },\n          commitAction: {\n            title: 'Commit action',\n            type: 'string',\n            enum: ['create', 'update', 'delete'],\n            description:\n              'The action to be used for git commit. Defaults to create.',\n          },\n          removeSourceBranch: {\n            title: 'Delete source branch',\n            type: 'boolean',\n            description:\n              'Option to delete source branch once the MR has been merged. Default: false',\n          },\n          assignee: {\n            title: 'Merge Request Assignee',\n            type: 'string',\n            description: 'User this merge request will be assigned to',\n          },\n        },\n      },\n      output: {\n        type: 'object',\n        properties: {\n          projectid: {\n            title: 'Gitlab Project id/Name(slug)',\n            type: 'string',\n          },\n          projectPath: {\n            title: 'Gitlab Project path',\n            type: 'string',\n          },\n          mergeRequestUrl: {\n            title: 'MergeRequest(MR) URL',\n            type: 'string',\n            description: 'Link to the merge request in GitLab',\n          },\n        },\n      },\n    },\n    async handler(ctx) {\n      const {\n        assignee,\n        branchName,\n        description,\n        repoUrl,\n        removeSourceBranch,\n        targetPath,\n        sourcePath,\n        title,\n        token: providedToken,\n      } = ctx.input;\n\n      const { host, owner, repo, project } = parseRepoUrl(\n        repoUrl,\n        integrations,\n      );\n      const repoID = project ? project : `${owner}/${repo}`;\n\n      const integrationConfig = integrations.gitlab.byHost(host);\n\n      if (!integrationConfig) {\n        throw new InputError(\n          `No matching integration configuration for host ${host}, please check your integrations config`,\n        );\n      }\n\n      if (!integrationConfig.config.token && !providedToken) {\n        throw new InputError(`No token available for host ${host}`);\n      }\n\n      const token = providedToken ?? integrationConfig.config.token!;\n      const tokenType = providedToken ? 'oauthToken' : 'token';\n\n      const api = new Gitlab({\n        host: integrationConfig.config.baseUrl,\n        [tokenType]: token,\n      });\n\n      let assigneeId = undefined;\n\n      if (assignee !== undefined) {\n        try {\n          const assigneeUser = await api.Users.username(assignee);\n          assigneeId = assigneeUser[0].id;\n        } catch (e) {\n          ctx.logger.warn(\n            `Failed to find gitlab user id for ${assignee}: ${e}. Proceeding with MR creation without an assignee.`,\n          );\n        }\n      }\n\n      let fileRoot: string;\n      if (sourcePath) {\n        fileRoot = resolveSafeChildPath(ctx.workspacePath, sourcePath);\n      } else if (targetPath) {\n        // for backward compatibility\n        fileRoot = resolveSafeChildPath(ctx.workspacePath, targetPath);\n      } else {\n        fileRoot = ctx.workspacePath;\n      }\n\n      const fileContents = await serializeDirectoryContents(fileRoot, {\n        gitignore: true,\n      });\n\n      const actions: Types.CommitAction[] = fileContents.map(file => ({\n        action: ctx.input.commitAction ?? 'create',\n        filePath: targetPath\n          ? path.posix.join(targetPath, file.path)\n          : file.path,\n        encoding: 'base64',\n        content: file.content.toString('base64'),\n        execute_filemode: file.executable,\n      }));\n\n      const projects = await api.Projects.show(repoID);\n\n      const { default_branch: defaultBranch } = projects;\n\n      try {\n        await api.Branches.create(repoID, branchName, String(defaultBranch));\n      } catch (e) {\n        throw new InputError(`The branch creation failed ${e}`);\n      }\n\n      try {\n        await api.Commits.create(repoID, branchName, ctx.input.title, actions);\n      } catch (e) {\n        throw new InputError(\n          `Committing the changes to ${branchName} failed ${e}`,\n        );\n      }\n\n      try {\n        const mergeRequestUrl = await api.MergeRequests.create(\n          repoID,\n          branchName,\n          String(defaultBranch),\n          title,\n          {\n            description,\n            removeSourceBranch: removeSourceBranch ? removeSourceBranch : false,\n            assigneeId,\n          },\n        ).then((mergeRequest: { web_url: string }) => {\n          return mergeRequest.web_url;\n        });\n        ctx.output('projectid', repoID);\n        ctx.output('projectPath', repoID);\n        ctx.output('mergeRequestUrl', mergeRequestUrl);\n      } catch (e) {\n        throw new InputError(`Merge request creation failed${e}`);\n      }\n    },\n  });\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { UrlReader } from '@backstage/backend-common';\nimport { CatalogApi } from '@backstage/catalog-client';\nimport { Config } from '@backstage/config';\nimport {\n  DefaultGithubCredentialsProvider,\n  GithubCredentialsProvider,\n  ScmIntegrations,\n} from '@backstage/integration';\nimport { TemplateAction } from '@backstage/plugin-scaffolder-node';\nimport {\n  createCatalogRegisterAction,\n  createCatalogWriteAction,\n  createFetchCatalogEntityAction,\n} from './catalog';\n\nimport { TemplateFilter, TemplateGlobal } from '../../../lib';\nimport { createDebugLogAction, createWaitAction } from './debug';\nimport {\n  createFetchPlainAction,\n  createFetchPlainFileAction,\n  createFetchTemplateAction,\n} from './fetch';\nimport {\n  createFilesystemDeleteAction,\n  createFilesystemRenameAction,\n} from './filesystem';\nimport {\n  createGithubActionsDispatchAction,\n  createGithubIssuesLabelAction,\n  createGithubRepoCreateAction,\n  createGithubRepoPushAction,\n  createGithubWebhookAction,\n} from './github';\nimport {\n  createPublishAzureAction,\n  createPublishBitbucketAction,\n  createPublishBitbucketCloudAction,\n  createPublishBitbucketServerAction,\n  createPublishGerritAction,\n  createPublishGerritReviewAction,\n  createPublishGithubAction,\n  createPublishGithubPullRequestAction,\n  createPublishGitlabAction,\n  createPublishGitlabMergeRequestAction,\n} from './publish';\n\n/**\n * The options passed to {@link createBuiltinActions}\n * @public\n */\nexport interface CreateBuiltInActionsOptions {\n  /**\n   * The {@link @backstage/backend-common#UrlReader} interface that will be used in the default actions.\n   */\n  reader: UrlReader;\n  /**\n   * The {@link @backstage/integrations#ScmIntegrations} that will be used in the default actions.\n   */\n  integrations: ScmIntegrations;\n  /**\n   * The {@link @backstage/catalog-client#CatalogApi} that will be used in the default actions.\n   */\n  catalogClient: CatalogApi;\n  /**\n   * The {@link @backstage/config#Config} that will be used in the default actions.\n   */\n  config: Config;\n  /**\n   * Additional custom filters that will be passed to the nunjucks template engine for use in\n   * Template Manifests and also template skeleton files when using `fetch:template`.\n   */\n  additionalTemplateFilters?: Record<string, TemplateFilter>;\n  additionalTemplateGlobals?: Record<string, TemplateGlobal>;\n}\n\n/**\n * A function to generate create a list of default actions that the scaffolder provides.\n * Is called internally in the default setup, but can be used when adding your own actions or overriding the default ones\n *\n * @public\n * @returns A list of actions that can be used in the scaffolder\n */\nexport const createBuiltinActions = (\n  options: CreateBuiltInActionsOptions,\n): TemplateAction[] => {\n  const {\n    reader,\n    integrations,\n    catalogClient,\n    config,\n    additionalTemplateFilters,\n    additionalTemplateGlobals,\n  } = options;\n\n  const githubCredentialsProvider: GithubCredentialsProvider =\n    DefaultGithubCredentialsProvider.fromIntegrations(integrations);\n\n  const actions = [\n    createFetchPlainAction({\n      reader,\n      integrations,\n    }),\n    createFetchPlainFileAction({\n      reader,\n      integrations,\n    }),\n    createFetchTemplateAction({\n      integrations,\n      reader,\n      additionalTemplateFilters,\n      additionalTemplateGlobals,\n    }),\n    createPublishGerritAction({\n      integrations,\n      config,\n    }),\n    createPublishGerritReviewAction({\n      integrations,\n      config,\n    }),\n    createPublishGithubAction({\n      integrations,\n      config,\n      githubCredentialsProvider,\n    }),\n    createPublishGithubPullRequestAction({\n      integrations,\n      githubCredentialsProvider,\n    }),\n    createPublishGitlabAction({\n      integrations,\n      config,\n    }),\n    createPublishGitlabMergeRequestAction({\n      integrations,\n    }),\n    createPublishBitbucketAction({\n      integrations,\n      config,\n    }),\n    createPublishBitbucketCloudAction({\n      integrations,\n      config,\n    }),\n    createPublishBitbucketServerAction({\n      integrations,\n      config,\n    }),\n    createPublishAzureAction({\n      integrations,\n      config,\n    }),\n    createDebugLogAction(),\n    createWaitAction(),\n    createCatalogRegisterAction({ catalogClient, integrations }),\n    createFetchCatalogEntityAction({ catalogClient }),\n    createCatalogWriteAction(),\n    createFilesystemDeleteAction(),\n    createFilesystemRenameAction(),\n    createGithubActionsDispatchAction({\n      integrations,\n      githubCredentialsProvider,\n    }),\n    createGithubWebhookAction({\n      integrations,\n      githubCredentialsProvider,\n    }),\n    createGithubIssuesLabelAction({\n      integrations,\n      githubCredentialsProvider,\n    }),\n    createGithubRepoCreateAction({\n      integrations,\n      githubCredentialsProvider,\n    }),\n    createGithubRepoPushAction({\n      integrations,\n      config,\n      githubCredentialsProvider,\n    }),\n  ];\n\n  return actions as TemplateAction[];\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ConflictError, NotFoundError } from '@backstage/errors';\nimport { TemplateAction } from '@backstage/plugin-scaffolder-node';\n/**\n * Registry of all registered template actions.\n * @public\n */\nexport class TemplateActionRegistry {\n  private readonly actions = new Map<string, TemplateAction>();\n\n  register(action: TemplateAction) {\n    if (this.actions.has(action.id)) {\n      throw new ConflictError(\n        `Template action with ID '${action.id}' has already been registered`,\n      );\n    }\n\n    this.actions.set(action.id, action);\n  }\n\n  get(actionId: string): TemplateAction {\n    const action = this.actions.get(actionId);\n    if (!action) {\n      throw new NotFoundError(\n        `Template action with ID '${actionId}' is not registered.`,\n      );\n    }\n    return action;\n  }\n\n  list(): TemplateAction[] {\n    return [...this.actions.values()];\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { JsonObject } from '@backstage/types';\nimport {\n  PluginDatabaseManager,\n  resolvePackagePath,\n} from '@backstage/backend-common';\nimport { ConflictError, NotFoundError } from '@backstage/errors';\nimport { Knex } from 'knex';\nimport { v4 as uuid } from 'uuid';\nimport {\n  SerializedTaskEvent,\n  SerializedTask,\n  TaskStatus,\n  TaskEventType,\n  TaskStore,\n  TaskStoreEmitOptions,\n  TaskStoreListEventsOptions,\n  TaskStoreCreateTaskOptions,\n  TaskStoreCreateTaskResult,\n  TaskStoreShutDownTaskOptions,\n} from './types';\nimport { DateTime } from 'luxon';\n\nconst migrationsDir = resolvePackagePath(\n  '@backstage/plugin-scaffolder-backend',\n  'migrations',\n);\n\nexport type RawDbTaskRow = {\n  id: string;\n  spec: string;\n  status: TaskStatus;\n  last_heartbeat_at?: string;\n  created_at: string;\n  created_by: string | null;\n  secrets?: string | null;\n};\n\nexport type RawDbTaskEventRow = {\n  id: number;\n  task_id: string;\n  body: string;\n  event_type: TaskEventType;\n  created_at: string;\n};\n\n/**\n * DatabaseTaskStore\n *\n * @public\n */\nexport type DatabaseTaskStoreOptions = {\n  database: PluginDatabaseManager | Knex;\n};\n\n/**\n * Typeguard to help DatabaseTaskStore understand when database is PluginDatabaseManager vs. when database is a Knex instance.\n *\n * * @public\n */\nfunction isPluginDatabaseManager(\n  opt: PluginDatabaseManager | Knex,\n): opt is PluginDatabaseManager {\n  return (opt as PluginDatabaseManager).getClient !== undefined;\n}\n\nconst parseSqlDateToIsoString = <T>(input: T): T | string => {\n  if (typeof input === 'string') {\n    return DateTime.fromSQL(input, { zone: 'UTC' }).toISO();\n  }\n\n  return input;\n};\n\n/**\n * DatabaseTaskStore\n *\n * @public\n */\nexport class DatabaseTaskStore implements TaskStore {\n  private readonly db: Knex;\n\n  static async create(\n    options: DatabaseTaskStoreOptions,\n  ): Promise<DatabaseTaskStore> {\n    const { database } = options;\n    const client = await this.getClient(database);\n\n    await this.runMigrations(database, client);\n\n    return new DatabaseTaskStore(client);\n  }\n\n  private static async getClient(\n    database: PluginDatabaseManager | Knex,\n  ): Promise<Knex> {\n    if (isPluginDatabaseManager(database)) {\n      return database.getClient();\n    }\n\n    return database;\n  }\n\n  private static async runMigrations(\n    database: PluginDatabaseManager | Knex,\n    client: Knex,\n  ): Promise<void> {\n    if (!isPluginDatabaseManager(database)) {\n      await client.migrate.latest({\n        directory: migrationsDir,\n      });\n\n      return;\n    }\n\n    if (!database.migrations?.skip) {\n      await client.migrate.latest({\n        directory: migrationsDir,\n      });\n    }\n  }\n\n  private constructor(client: Knex) {\n    this.db = client;\n  }\n\n  async list(options: {\n    createdBy?: string;\n  }): Promise<{ tasks: SerializedTask[] }> {\n    const queryBuilder = this.db<RawDbTaskRow>('tasks');\n\n    if (options.createdBy) {\n      queryBuilder.where({\n        created_by: options.createdBy,\n      });\n    }\n\n    const results = await queryBuilder.orderBy('created_at', 'desc').select();\n\n    const tasks = results.map(result => ({\n      id: result.id,\n      spec: JSON.parse(result.spec),\n      status: result.status,\n      createdBy: result.created_by ?? undefined,\n      lastHeartbeatAt: parseSqlDateToIsoString(result.last_heartbeat_at),\n      createdAt: parseSqlDateToIsoString(result.created_at),\n    }));\n\n    return { tasks };\n  }\n\n  async getTask(taskId: string): Promise<SerializedTask> {\n    const [result] = await this.db<RawDbTaskRow>('tasks')\n      .where({ id: taskId })\n      .select();\n    if (!result) {\n      throw new NotFoundError(`No task with id '${taskId}' found`);\n    }\n    try {\n      const spec = JSON.parse(result.spec);\n      const secrets = result.secrets ? JSON.parse(result.secrets) : undefined;\n      return {\n        id: result.id,\n        spec,\n        status: result.status,\n        lastHeartbeatAt: parseSqlDateToIsoString(result.last_heartbeat_at),\n        createdAt: parseSqlDateToIsoString(result.created_at),\n        createdBy: result.created_by ?? undefined,\n        secrets,\n      };\n    } catch (error) {\n      throw new Error(`Failed to parse spec of task '${taskId}', ${error}`);\n    }\n  }\n\n  async createTask(\n    options: TaskStoreCreateTaskOptions,\n  ): Promise<TaskStoreCreateTaskResult> {\n    const taskId = uuid();\n    await this.db<RawDbTaskRow>('tasks').insert({\n      id: taskId,\n      spec: JSON.stringify(options.spec),\n      secrets: options.secrets ? JSON.stringify(options.secrets) : undefined,\n      created_by: options.createdBy ?? null,\n      status: 'open',\n    });\n    return { taskId };\n  }\n\n  async claimTask(): Promise<SerializedTask | undefined> {\n    return this.db.transaction(async tx => {\n      const [task] = await tx<RawDbTaskRow>('tasks')\n        .where({\n          status: 'open',\n        })\n        .limit(1)\n        .select();\n\n      if (!task) {\n        return undefined;\n      }\n\n      const updateCount = await tx<RawDbTaskRow>('tasks')\n        .where({ id: task.id, status: 'open' })\n        .update({\n          status: 'processing',\n          last_heartbeat_at: this.db.fn.now(),\n          // remove the secrets when moving to processing state.\n          secrets: null,\n        });\n\n      if (updateCount < 1) {\n        return undefined;\n      }\n\n      try {\n        const spec = JSON.parse(task.spec);\n        const secrets = task.secrets ? JSON.parse(task.secrets) : undefined;\n        return {\n          id: task.id,\n          spec,\n          status: 'processing',\n          lastHeartbeatAt: task.last_heartbeat_at,\n          createdAt: task.created_at,\n          createdBy: task.created_by ?? undefined,\n          secrets,\n        };\n      } catch (error) {\n        throw new Error(`Failed to parse spec of task '${task.id}', ${error}`);\n      }\n    });\n  }\n\n  async heartbeatTask(taskId: string): Promise<void> {\n    const updateCount = await this.db<RawDbTaskRow>('tasks')\n      .where({ id: taskId, status: 'processing' })\n      .update({\n        last_heartbeat_at: this.db.fn.now(),\n      });\n    if (updateCount === 0) {\n      throw new ConflictError(`No running task with taskId ${taskId} found`);\n    }\n  }\n\n  async listStaleTasks(options: { timeoutS: number }): Promise<{\n    tasks: { taskId: string }[];\n  }> {\n    const { timeoutS } = options;\n\n    const rawRows = await this.db<RawDbTaskRow>('tasks')\n      .where('status', 'processing')\n      .andWhere(\n        'last_heartbeat_at',\n        '<=',\n        this.db.client.config.client.includes('sqlite3')\n          ? this.db.raw(`datetime('now', ?)`, [`-${timeoutS} seconds`])\n          : this.db.raw(`? - interval '${timeoutS} seconds'`, [\n              this.db.fn.now(),\n            ]),\n      );\n    const tasks = rawRows.map(row => ({\n      taskId: row.id,\n    }));\n    return { tasks };\n  }\n\n  async completeTask(options: {\n    taskId: string;\n    status: TaskStatus;\n    eventBody: JsonObject;\n  }): Promise<void> {\n    const { taskId, status, eventBody } = options;\n\n    let oldStatus: string;\n    if (['failed', 'completed', 'cancelled'].includes(status)) {\n      oldStatus = 'processing';\n    } else {\n      throw new Error(\n        `Invalid status update of run '${taskId}' to status '${status}'`,\n      );\n    }\n\n    await this.db.transaction(async tx => {\n      const [task] = await tx<RawDbTaskRow>('tasks')\n        .where({\n          id: taskId,\n        })\n        .limit(1)\n        .select();\n\n      const updateTask = async (criteria: {\n        id: string;\n        status?: TaskStatus;\n      }) => {\n        const updateCount = await tx<RawDbTaskRow>('tasks')\n          .where(criteria)\n          .update({\n            status,\n          });\n\n        if (updateCount !== 1) {\n          throw new ConflictError(\n            `Failed to update status to '${status}' for taskId ${taskId}`,\n          );\n        }\n\n        await tx<RawDbTaskEventRow>('task_events').insert({\n          task_id: taskId,\n          event_type: 'completion',\n          body: JSON.stringify(eventBody),\n        });\n      };\n\n      if (status === 'cancelled') {\n        await updateTask({\n          id: taskId,\n        });\n        return;\n      }\n\n      if (task.status === 'cancelled') {\n        return;\n      }\n\n      if (!task) {\n        throw new Error(`No task with taskId ${taskId} found`);\n      }\n      if (task.status !== oldStatus) {\n        throw new ConflictError(\n          `Refusing to update status of run '${taskId}' to status '${status}' ` +\n            `as it is currently '${task.status}', expected '${oldStatus}'`,\n        );\n      }\n\n      await updateTask({\n        id: taskId,\n        status: oldStatus,\n      });\n    });\n  }\n\n  async emitLogEvent(\n    options: TaskStoreEmitOptions<{ message: string } & JsonObject>,\n  ): Promise<void> {\n    const { taskId, body } = options;\n    const serializedBody = JSON.stringify(body);\n    await this.db<RawDbTaskEventRow>('task_events').insert({\n      task_id: taskId,\n      event_type: 'log',\n      body: serializedBody,\n    });\n  }\n\n  async listEvents(\n    options: TaskStoreListEventsOptions,\n  ): Promise<{ events: SerializedTaskEvent[] }> {\n    const { taskId, after } = options;\n    const rawEvents = await this.db<RawDbTaskEventRow>('task_events')\n      .where({\n        task_id: taskId,\n      })\n      .andWhere(builder => {\n        if (typeof after === 'number') {\n          builder.where('id', '>', after).orWhere('event_type', 'completion');\n        }\n      })\n      .orderBy('id')\n      .select();\n\n    const events = rawEvents.map(event => {\n      try {\n        const body = JSON.parse(event.body) as JsonObject;\n        return {\n          id: Number(event.id),\n          taskId,\n          body,\n          type: event.event_type,\n          createdAt: parseSqlDateToIsoString(event.created_at),\n        };\n      } catch (error) {\n        throw new Error(\n          `Failed to parse event body from event taskId=${taskId} id=${event.id}, ${error}`,\n        );\n      }\n    });\n    return { events };\n  }\n\n  async shutdownTask(options: TaskStoreShutDownTaskOptions): Promise<void> {\n    const { taskId } = options;\n    const message = `This task was marked as stale as it exceeded its timeout`;\n\n    const statusStepEvents = (await this.listEvents({ taskId })).events.filter(\n      ({ body }) => body?.stepId,\n    );\n\n    const completedSteps = statusStepEvents\n      .filter(\n        ({ body: { status } }) => status === 'failed' || status === 'completed',\n      )\n      .map(step => step.body.stepId);\n\n    const hungProcessingSteps = statusStepEvents\n      .filter(({ body: { status } }) => status === 'processing')\n      .map(event => event.body.stepId)\n      .filter(step => !completedSteps.includes(step));\n\n    for (const step of hungProcessingSteps) {\n      await this.emitLogEvent({\n        taskId,\n        body: {\n          message,\n          stepId: step,\n          status: 'failed',\n        },\n      });\n    }\n\n    await this.completeTask({\n      taskId,\n      status: 'failed',\n      eventBody: {\n        message,\n      },\n    });\n  }\n\n  async cancelTask(\n    options: TaskStoreEmitOptions<{ message: string } & JsonObject>,\n  ): Promise<void> {\n    const { taskId, body } = options;\n    const serializedBody = JSON.stringify(body);\n    await this.db<RawDbTaskEventRow>('task_events').insert({\n      task_id: taskId,\n      event_type: 'cancelled',\n      body: serializedBody,\n    });\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TaskSpec } from '@backstage/plugin-scaffolder-common';\nimport { TaskSecrets } from '@backstage/plugin-scaffolder-node';\nimport { JsonObject, Observable } from '@backstage/types';\nimport { Logger } from 'winston';\nimport ObservableImpl from 'zen-observable';\nimport {\n  SerializedTask,\n  SerializedTaskEvent,\n  TaskBroker,\n  TaskBrokerDispatchOptions,\n  TaskCompletionState,\n  TaskContext,\n  TaskStore,\n} from './types';\n\n/**\n * TaskManager\n *\n * @public\n */\nexport class TaskManager implements TaskContext {\n  private isDone = false;\n\n  private heartbeatTimeoutId?: ReturnType<typeof setInterval>;\n\n  static create(\n    task: CurrentClaimedTask,\n    storage: TaskStore,\n    abortSignal: AbortSignal,\n    logger: Logger,\n  ) {\n    const agent = new TaskManager(task, storage, abortSignal, logger);\n    agent.startTimeout();\n    return agent;\n  }\n\n  // Runs heartbeat internally\n  private constructor(\n    private readonly task: CurrentClaimedTask,\n    private readonly storage: TaskStore,\n    private readonly signal: AbortSignal,\n    private readonly logger: Logger,\n  ) {}\n\n  get spec() {\n    return this.task.spec;\n  }\n\n  get cancelSignal() {\n    return this.signal;\n  }\n\n  get secrets() {\n    return this.task.secrets;\n  }\n\n  get createdBy() {\n    return this.task.createdBy;\n  }\n\n  async getWorkspaceName() {\n    return this.task.taskId;\n  }\n\n  get done() {\n    return this.isDone;\n  }\n\n  async emitLog(message: string, logMetadata?: JsonObject): Promise<void> {\n    await this.storage.emitLogEvent({\n      taskId: this.task.taskId,\n      body: { message, ...logMetadata },\n    });\n  }\n\n  async complete(\n    result: TaskCompletionState,\n    metadata?: JsonObject,\n  ): Promise<void> {\n    await this.storage.completeTask({\n      taskId: this.task.taskId,\n      status: result === 'failed' ? 'failed' : 'completed',\n      eventBody: {\n        message: `Run completed with status: ${result}`,\n        ...metadata,\n      },\n    });\n    this.isDone = true;\n    if (this.heartbeatTimeoutId) {\n      clearTimeout(this.heartbeatTimeoutId);\n    }\n  }\n\n  private startTimeout() {\n    this.heartbeatTimeoutId = setTimeout(async () => {\n      try {\n        await this.storage.heartbeatTask(this.task.taskId);\n        this.startTimeout();\n      } catch (error) {\n        this.isDone = true;\n\n        this.logger.error(\n          `Heartbeat for task ${this.task.taskId} failed`,\n          error,\n        );\n      }\n    }, 1000);\n  }\n}\n\n/**\n * Stores the state of the current claimed task passed to the TaskContext\n *\n * @public\n */\nexport interface CurrentClaimedTask {\n  /**\n   * The TaskSpec of the current claimed task.\n   */\n  spec: TaskSpec;\n  /**\n   * The uuid of the current claimed task.\n   */\n  taskId: string;\n  /**\n   * The secrets that are stored with the task.\n   */\n  secrets?: TaskSecrets;\n  /**\n   * The creator of the task.\n   */\n  createdBy?: string;\n}\n\nfunction defer() {\n  let resolve = () => {};\n  const promise = new Promise<void>(_resolve => {\n    resolve = _resolve;\n  });\n  return { promise, resolve };\n}\n\nexport class StorageTaskBroker implements TaskBroker {\n  constructor(\n    private readonly storage: TaskStore,\n    private readonly logger: Logger,\n  ) {}\n\n  async list(options?: {\n    createdBy?: string;\n  }): Promise<{ tasks: SerializedTask[] }> {\n    if (!this.storage.list) {\n      throw new Error(\n        'TaskStore does not implement the list method. Please implement the list method to be able to list tasks',\n      );\n    }\n    return await this.storage.list({ createdBy: options?.createdBy });\n  }\n\n  private deferredDispatch = defer();\n\n  private async registerCancellable(\n    taskId: string,\n    abortController: AbortController,\n  ) {\n    let shouldUnsubscribe = false;\n    const subscription = this.event$({ taskId, after: undefined }).subscribe({\n      error: _ => {\n        subscription.unsubscribe();\n      },\n      next: ({ events }) => {\n        for (const event of events) {\n          if (event.type === 'cancelled') {\n            abortController.abort();\n            shouldUnsubscribe = true;\n          }\n\n          if (event.type === 'completion') {\n            shouldUnsubscribe = true;\n          }\n        }\n        if (shouldUnsubscribe) {\n          subscription.unsubscribe();\n        }\n      },\n    });\n  }\n\n  /**\n   * {@inheritdoc TaskBroker.claim}\n   */\n  async claim(): Promise<TaskContext> {\n    for (;;) {\n      const pendingTask = await this.storage.claimTask();\n      if (pendingTask) {\n        const abortController = new AbortController();\n        await this.registerCancellable(pendingTask.id, abortController);\n        return TaskManager.create(\n          {\n            taskId: pendingTask.id,\n            spec: pendingTask.spec,\n            secrets: pendingTask.secrets,\n            createdBy: pendingTask.createdBy,\n          },\n          this.storage,\n          abortController.signal,\n          this.logger,\n        );\n      }\n\n      await this.waitForDispatch();\n    }\n  }\n\n  /**\n   * {@inheritdoc TaskBroker.dispatch}\n   */\n  async dispatch(\n    options: TaskBrokerDispatchOptions,\n  ): Promise<{ taskId: string }> {\n    const taskRow = await this.storage.createTask(options);\n    this.signalDispatch();\n    return {\n      taskId: taskRow.taskId,\n    };\n  }\n\n  /**\n   * {@inheritdoc TaskBroker.get}\n   */\n  async get(taskId: string): Promise<SerializedTask> {\n    return this.storage.getTask(taskId);\n  }\n\n  /**\n   * {@inheritdoc TaskBroker.event$}\n   */\n  event$(options: {\n    taskId: string;\n    after?: number;\n  }): Observable<{ events: SerializedTaskEvent[] }> {\n    return new ObservableImpl(observer => {\n      const { taskId } = options;\n\n      let after = options.after;\n      let cancelled = false;\n\n      (async () => {\n        while (!cancelled) {\n          const result = await this.storage.listEvents({ taskId, after });\n          const { events } = result;\n          if (events.length) {\n            after = events[events.length - 1].id;\n            observer.next(result);\n          }\n\n          await new Promise(resolve => setTimeout(resolve, 1000));\n        }\n      })();\n\n      return () => {\n        cancelled = true;\n      };\n    });\n  }\n\n  /**\n   * {@inheritdoc TaskBroker.vacuumTasks}\n   */\n  async vacuumTasks(options: { timeoutS: number }): Promise<void> {\n    const { tasks } = await this.storage.listStaleTasks(options);\n    await Promise.all(\n      tasks.map(async task => {\n        try {\n          await this.storage.completeTask({\n            taskId: task.taskId,\n            status: 'failed',\n            eventBody: {\n              message:\n                'The task was cancelled because the task worker lost connection to the task broker',\n            },\n          });\n        } catch (error) {\n          this.logger.warn(`Failed to cancel task '${task.taskId}', ${error}`);\n        }\n      }),\n    );\n  }\n\n  private waitForDispatch() {\n    return this.deferredDispatch.promise;\n  }\n\n  private signalDispatch() {\n    this.deferredDispatch.resolve();\n    this.deferredDispatch = defer();\n  }\n\n  async cancel(taskId: string) {\n    const { events } = await this.storage.listEvents({ taskId });\n    const currentStepId =\n      events.length > 0\n        ? events\n            .filter(({ body }) => body?.stepId)\n            .reduce((prev, curr) => (prev.id > curr.id ? prev : curr)).body\n            .stepId\n        : 0;\n\n    await this.storage.cancelTask?.({\n      taskId,\n      body: {\n        message: `Step ${currentStepId} has been cancelled.`,\n        stepId: currentStepId,\n        status: 'cancelled',\n      },\n    });\n  }\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isArray } from 'lodash';\nimport { Schema } from 'jsonschema';\n\n/**\n * Returns true if the input is not `false`, `undefined`, `null`, `\"\"`, `0`, or\n * `[]`. This behavior is based on the behavior of handlebars, see\n * https://handlebarsjs.com/guide/builtin-helpers.html#if\n */\nexport function isTruthy(value: any): boolean {\n  return isArray(value) ? value.length > 0 : !!value;\n}\n\nexport function generateExampleOutput(schema: Schema): unknown {\n  const { examples } = schema as { examples?: unknown };\n  if (examples && Array.isArray(examples)) {\n    return examples[0];\n  }\n  if (schema.type === 'object') {\n    return Object.fromEntries(\n      Object.entries(schema.properties ?? {}).map(([key, value]) => [\n        key,\n        generateExampleOutput(value),\n      ]),\n    );\n  } else if (schema.type === 'array') {\n    const [firstSchema] = [schema.items]?.flat();\n    if (firstSchema) {\n      return [generateExampleOutput(firstSchema)];\n    }\n    return [];\n  } else if (schema.type === 'string') {\n    return '<example>';\n  } else if (schema.type === 'number') {\n    return 0;\n  } else if (schema.type === 'boolean') {\n    return false;\n  }\n  return '<unknown>';\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Counter,\n  CounterConfiguration,\n  Gauge,\n  GaugeConfiguration,\n  Histogram,\n  HistogramConfiguration,\n  register,\n  Summary,\n  SummaryConfiguration,\n} from 'prom-client';\n\nexport function createCounterMetric<T extends string>(\n  config: CounterConfiguration<T>,\n): Counter<T> {\n  let metric = register.getSingleMetric(config.name);\n  if (!metric) {\n    metric = new Counter<T>(config);\n    register.registerMetric(metric);\n  }\n  return metric as Counter<T>;\n}\n\nexport function createGaugeMetric<T extends string>(\n  config: GaugeConfiguration<T>,\n): Gauge<T> {\n  let metric = register.getSingleMetric(config.name);\n  if (!metric) {\n    metric = new Gauge<T>(config);\n    register.registerMetric(metric);\n  }\n  return metric as Gauge<T>;\n}\n\nexport function createSummaryMetric<T extends string>(\n  config: SummaryConfiguration<T>,\n): Summary<T> {\n  let metric = register.getSingleMetric(config.name);\n  if (!metric) {\n    metric = new Summary<T>(config);\n    register.registerMetric(metric);\n  }\n\n  return metric as Summary<T>;\n}\n\nexport function createHistogramMetric<T extends string>(\n  config: HistogramConfiguration<T>,\n): Histogram<T> {\n  let metric = register.getSingleMetric(config.name);\n  if (!metric) {\n    metric = new Histogram<T>(config);\n    register.registerMetric(metric);\n  }\n\n  return metric as Histogram<T>;\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { makeCreatePermissionRule } from '@backstage/plugin-permission-node';\nimport {\n  RESOURCE_TYPE_SCAFFOLDER_TEMPLATE,\n  RESOURCE_TYPE_SCAFFOLDER_ACTION,\n} from '@backstage/plugin-scaffolder-common/alpha';\n\nimport {\n  TemplateEntityStepV1beta3,\n  TemplateParametersV1beta3,\n} from '@backstage/plugin-scaffolder-common';\n\nimport { z } from 'zod';\nimport { JsonObject, JsonPrimitive } from '@backstage/types';\nimport { get } from 'lodash';\n\nexport const createTemplatePermissionRule = makeCreatePermissionRule<\n  TemplateEntityStepV1beta3 | TemplateParametersV1beta3,\n  {},\n  typeof RESOURCE_TYPE_SCAFFOLDER_TEMPLATE\n>();\n\nexport const hasTag = createTemplatePermissionRule({\n  name: 'HAS_TAG',\n  resourceType: RESOURCE_TYPE_SCAFFOLDER_TEMPLATE,\n  description: `Match parameters or steps with the given tag`,\n  paramsSchema: z.object({\n    tag: z.string().describe('Name of the tag to match on'),\n  }),\n  apply: (resource, { tag }) => {\n    return resource['backstage:permissions']?.tags?.includes(tag) ?? false;\n  },\n  toQuery: () => ({}),\n});\n\nexport const createActionPermissionRule = makeCreatePermissionRule<\n  {\n    action: string;\n    input: JsonObject | undefined;\n  },\n  {},\n  typeof RESOURCE_TYPE_SCAFFOLDER_ACTION\n>();\n\nexport const hasActionId = createActionPermissionRule({\n  name: 'HAS_ACTION_ID',\n  resourceType: RESOURCE_TYPE_SCAFFOLDER_ACTION,\n  description: `Match actions with the given actionId`,\n  paramsSchema: z.object({\n    actionId: z.string().describe('Name of the actionId to match on'),\n  }),\n  apply: (resource, { actionId }) => {\n    return resource.action === actionId;\n  },\n  toQuery: () => ({}),\n});\n\nexport const hasProperty = buildHasProperty({\n  name: 'HAS_PROPERTY',\n  valueSchema: z.union([z.string(), z.number(), z.boolean(), z.null()]),\n  validateProperty: false,\n});\n\nexport const hasBooleanProperty = buildHasProperty({\n  name: 'HAS_BOOLEAN_PROPERTY',\n  valueSchema: z.boolean(),\n});\nexport const hasNumberProperty = buildHasProperty({\n  name: 'HAS_NUMBER_PROPERTY',\n  valueSchema: z.number(),\n});\nexport const hasStringProperty = buildHasProperty({\n  name: 'HAS_STRING_PROPERTY',\n  valueSchema: z.string(),\n});\n\nfunction buildHasProperty<Schema extends z.ZodType<JsonPrimitive>>({\n  name,\n  valueSchema,\n  validateProperty = true,\n}: {\n  name: string;\n  valueSchema: Schema;\n  validateProperty?: boolean;\n}) {\n  return createActionPermissionRule({\n    name,\n    description: `Allow actions with the specified property`,\n    resourceType: RESOURCE_TYPE_SCAFFOLDER_ACTION,\n    paramsSchema: z.object({\n      key: z\n        .string()\n        .describe(`Property within the action parameters to match on`),\n      value: valueSchema.describe(`Value of the given property to match on`),\n    }) as unknown as z.ZodType<{ key: string; value?: z.infer<Schema> }>,\n    apply: (resource, { key, value }) => {\n      const foundValue = get(resource.input, key);\n\n      if (validateProperty && !valueSchema.safeParse(foundValue).success) {\n        return false;\n      }\n      if (value !== undefined) {\n        if (valueSchema.safeParse(value).success) {\n          return value === foundValue;\n        }\n        return false;\n      }\n\n      return foundValue !== undefined;\n    },\n    toQuery: () => ({}),\n  });\n}\n\nexport const scaffolderTemplateRules = { hasTag };\nexport const scaffolderActionRules = {\n  hasActionId,\n  hasBooleanProperty,\n  hasNumberProperty,\n  hasStringProperty,\n};\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ScmIntegrations } from '@backstage/integration';\nimport {\n  TaskContext,\n  TaskTrackType,\n  WorkflowResponse,\n  WorkflowRunner,\n} from './types';\nimport * as winston from 'winston';\nimport fs from 'fs-extra';\nimport path from 'path';\nimport nunjucks from 'nunjucks';\nimport { JsonObject, JsonValue } from '@backstage/types';\nimport { InputError, NotAllowedError } from '@backstage/errors';\nimport { PassThrough } from 'stream';\nimport { generateExampleOutput, isTruthy } from './helper';\nimport { validate as validateJsonSchema } from 'jsonschema';\nimport { TemplateActionRegistry } from '../actions';\nimport {\n  TemplateFilter,\n  SecureTemplater,\n  SecureTemplateRenderer,\n  TemplateGlobal,\n} from '../../lib/templating/SecureTemplater';\nimport {\n  TaskSpec,\n  TaskSpecV1beta3,\n  TaskStep,\n} from '@backstage/plugin-scaffolder-common';\n\nimport { TemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { createConditionAuthorizer } from '@backstage/plugin-permission-node';\nimport { UserEntity } from '@backstage/catalog-model';\nimport { createCounterMetric, createHistogramMetric } from '../../util/metrics';\nimport { createDefaultFilters } from '../../lib/templating/filters';\nimport {\n  AuthorizeResult,\n  PermissionEvaluator,\n  PolicyDecision,\n} from '@backstage/plugin-permission-common';\nimport { scaffolderActionRules } from '../../service/rules';\nimport { actionExecutePermission } from '@backstage/plugin-scaffolder-common/alpha';\n\ntype NunjucksWorkflowRunnerOptions = {\n  workingDirectory: string;\n  actionRegistry: TemplateActionRegistry;\n  integrations: ScmIntegrations;\n  logger: winston.Logger;\n  additionalTemplateFilters?: Record<string, TemplateFilter>;\n  additionalTemplateGlobals?: Record<string, TemplateGlobal>;\n  permissions?: PermissionEvaluator;\n};\n\ntype TemplateContext = {\n  parameters: JsonObject;\n  steps: {\n    [stepName: string]: { output: { [outputName: string]: JsonValue } };\n  };\n  secrets?: Record<string, string>;\n  user?: {\n    entity?: UserEntity;\n    ref?: string;\n  };\n};\n\nconst isValidTaskSpec = (taskSpec: TaskSpec): taskSpec is TaskSpecV1beta3 => {\n  return taskSpec.apiVersion === 'scaffolder.backstage.io/v1beta3';\n};\n\nconst createStepLogger = ({\n  task,\n  step,\n}: {\n  task: TaskContext;\n  step: TaskStep;\n}) => {\n  const metadata = { stepId: step.id };\n  const taskLogger = winston.createLogger({\n    level: process.env.LOG_LEVEL || 'info',\n    format: winston.format.combine(\n      winston.format.colorize(),\n      winston.format.simple(),\n    ),\n    defaultMeta: {},\n  });\n\n  const streamLogger = new PassThrough();\n  streamLogger.on('data', async data => {\n    const message = data.toString().trim();\n    if (message?.length > 1) {\n      await task.emitLog(message, metadata);\n    }\n  });\n\n  taskLogger.add(new winston.transports.Stream({ stream: streamLogger }));\n\n  return { taskLogger, streamLogger };\n};\n\nconst isActionAuthorized = createConditionAuthorizer(\n  Object.values(scaffolderActionRules),\n);\n\nexport class NunjucksWorkflowRunner implements WorkflowRunner {\n  private readonly defaultTemplateFilters: Record<string, TemplateFilter>;\n  constructor(private readonly options: NunjucksWorkflowRunnerOptions) {\n    this.defaultTemplateFilters = createDefaultFilters({\n      integrations: this.options.integrations,\n    });\n  }\n\n  private readonly tracker = scaffoldingTracker();\n\n  private isSingleTemplateString(input: string) {\n    const { parser, nodes } = nunjucks as unknown as {\n      parser: {\n        parse(\n          template: string,\n          ctx: object,\n          options: nunjucks.ConfigureOptions,\n        ): { children: { children?: unknown[] }[] };\n      };\n      nodes: { TemplateData: Function };\n    };\n\n    const parsed = parser.parse(\n      input,\n      {},\n      {\n        autoescape: false,\n        tags: {\n          variableStart: '${{',\n          variableEnd: '}}',\n        },\n      },\n    );\n\n    return (\n      parsed.children.length === 1 &&\n      !(parsed.children[0]?.children?.[0] instanceof nodes.TemplateData)\n    );\n  }\n\n  private render<T>(\n    input: T,\n    context: TemplateContext,\n    renderTemplate: SecureTemplateRenderer,\n  ): T {\n    return JSON.parse(JSON.stringify(input), (_key, value) => {\n      try {\n        if (typeof value === 'string') {\n          try {\n            if (this.isSingleTemplateString(value)) {\n              // Lets convert ${{ parameters.bob }} to ${{ (parameters.bob) | dump }} so we can keep the input type\n              const wrappedDumped = value.replace(\n                /\\${{(.+)}}/g,\n                '${{ ( $1 ) | dump }}',\n              );\n\n              // Run the templating\n              const templated = renderTemplate(wrappedDumped, context);\n\n              // If there's an empty string returned, then it's undefined\n              if (templated === '') {\n                return undefined;\n              }\n\n              // Reparse the dumped string\n              return JSON.parse(templated);\n            }\n          } catch (ex) {\n            this.options.logger.error(\n              `Failed to parse template string: ${value} with error ${ex.message}`,\n            );\n          }\n\n          // Fallback to default behaviour\n          const templated = renderTemplate(value, context);\n\n          if (templated === '') {\n            return undefined;\n          }\n\n          return templated;\n        }\n      } catch {\n        return value;\n      }\n      return value;\n    });\n  }\n\n  async executeStep(\n    task: TaskContext,\n    step: TaskStep,\n    context: TemplateContext,\n    renderTemplate: (template: string, values: unknown) => string,\n    taskTrack: TaskTrackType,\n    workspacePath: string,\n    decision: PolicyDecision,\n  ) {\n    const stepTrack = await this.tracker.stepStart(task, step);\n\n    if (task.cancelSignal.aborted) {\n      throw new Error(`Step ${step.name} has been cancelled.`);\n    }\n\n    try {\n      if (step.if) {\n        const ifResult = await this.render(step.if, context, renderTemplate);\n        if (!isTruthy(ifResult)) {\n          await stepTrack.skipFalsy();\n          return;\n        }\n      }\n\n      const action: TemplateAction<JsonObject> =\n        this.options.actionRegistry.get(step.action);\n      const { taskLogger, streamLogger } = createStepLogger({ task, step });\n\n      if (task.isDryRun) {\n        const redactedSecrets = Object.fromEntries(\n          Object.entries(task.secrets ?? {}).map(secret => [\n            secret[0],\n            '[REDACTED]',\n          ]),\n        );\n        const debugInput =\n          (step.input &&\n            this.render(\n              step.input,\n              {\n                ...context,\n                secrets: redactedSecrets,\n              },\n              renderTemplate,\n            )) ??\n          {};\n        taskLogger.info(\n          `Running ${\n            action.id\n          } in dry-run mode with inputs (secrets redacted): ${JSON.stringify(\n            debugInput,\n            undefined,\n            2,\n          )}`,\n        );\n        if (!action.supportsDryRun) {\n          await taskTrack.skipDryRun(step, action);\n          const outputSchema = action.schema?.output;\n          if (outputSchema) {\n            context.steps[step.id] = {\n              output: generateExampleOutput(outputSchema) as {\n                [name in string]: JsonValue;\n              },\n            };\n          } else {\n            context.steps[step.id] = { output: {} };\n          }\n          return;\n        }\n      }\n\n      // Secrets are only passed when templating the input to actions for security reasons\n      const input =\n        (step.input &&\n          this.render(\n            step.input,\n            { ...context, secrets: task.secrets ?? {} },\n            renderTemplate,\n          )) ??\n        {};\n\n      if (action.schema?.input) {\n        const validateResult = validateJsonSchema(input, action.schema.input);\n        if (!validateResult.valid) {\n          const errors = validateResult.errors.join(', ');\n          throw new InputError(\n            `Invalid input passed to action ${action.id}, ${errors}`,\n          );\n        }\n      }\n\n      if (!isActionAuthorized(decision, { action: action.id, input })) {\n        throw new NotAllowedError(\n          `Unauthorized action: ${\n            action.id\n          }. The action is not allowed. Input: ${JSON.stringify(\n            input,\n            null,\n            2,\n          )}`,\n        );\n      }\n\n      const tmpDirs = new Array<string>();\n      const stepOutput: { [outputName: string]: JsonValue } = {};\n\n      await action.handler({\n        input,\n        secrets: task.secrets ?? {},\n        logger: taskLogger,\n        logStream: streamLogger,\n        workspacePath,\n        createTemporaryDirectory: async () => {\n          const tmpDir = await fs.mkdtemp(`${workspacePath}_step-${step.id}-`);\n          tmpDirs.push(tmpDir);\n          return tmpDir;\n        },\n        output(name: string, value: JsonValue) {\n          stepOutput[name] = value;\n        },\n        templateInfo: task.spec.templateInfo,\n        user: task.spec.user,\n        isDryRun: task.isDryRun,\n        signal: task.cancelSignal,\n      });\n\n      // Remove all temporary directories that were created when executing the action\n      for (const tmpDir of tmpDirs) {\n        await fs.remove(tmpDir);\n      }\n\n      context.steps[step.id] = { output: stepOutput };\n\n      if (task.cancelSignal.aborted) {\n        throw new Error(`Step ${step.name} has been cancelled.`);\n      }\n\n      await stepTrack.markSuccessful();\n    } catch (err) {\n      await taskTrack.markFailed(step, err);\n      await stepTrack.markFailed();\n      throw err;\n    }\n  }\n\n  async execute(task: TaskContext): Promise<WorkflowResponse> {\n    if (!isValidTaskSpec(task.spec)) {\n      throw new InputError(\n        'Wrong template version executed with the workflow engine',\n      );\n    }\n    const workspacePath = path.join(\n      this.options.workingDirectory,\n      await task.getWorkspaceName(),\n    );\n\n    const { additionalTemplateFilters, additionalTemplateGlobals } =\n      this.options;\n\n    const renderTemplate = await SecureTemplater.loadRenderer({\n      templateFilters: {\n        ...this.defaultTemplateFilters,\n        ...additionalTemplateFilters,\n      },\n      templateGlobals: additionalTemplateGlobals,\n    });\n\n    try {\n      const taskTrack = await this.tracker.taskStart(task);\n      await fs.ensureDir(workspacePath);\n\n      const context: TemplateContext = {\n        parameters: task.spec.parameters,\n        steps: {},\n        user: task.spec.user,\n      };\n\n      const [decision]: PolicyDecision[] =\n        this.options.permissions && task.spec.steps.length\n          ? await this.options.permissions.authorizeConditional(\n              [{ permission: actionExecutePermission }],\n              { token: task.secrets?.backstageToken },\n            )\n          : [{ result: AuthorizeResult.ALLOW }];\n\n      for (const step of task.spec.steps) {\n        await this.executeStep(\n          task,\n          step,\n          context,\n          renderTemplate,\n          taskTrack,\n          workspacePath,\n          decision,\n        );\n      }\n\n      const output = this.render(task.spec.output, context, renderTemplate);\n      await taskTrack.markSuccessful();\n\n      return { output };\n    } finally {\n      if (workspacePath) {\n        await fs.remove(workspacePath);\n      }\n    }\n  }\n}\n\nfunction scaffoldingTracker() {\n  const taskCount = createCounterMetric({\n    name: 'scaffolder_task_count',\n    help: 'Count of task runs',\n    labelNames: ['template', 'user', 'result'],\n  });\n  const taskDuration = createHistogramMetric({\n    name: 'scaffolder_task_duration',\n    help: 'Duration of a task run',\n    labelNames: ['template', 'result'],\n  });\n  const stepCount = createCounterMetric({\n    name: 'scaffolder_step_count',\n    help: 'Count of step runs',\n    labelNames: ['template', 'step', 'result'],\n  });\n  const stepDuration = createHistogramMetric({\n    name: 'scaffolder_step_duration',\n    help: 'Duration of a step runs',\n    labelNames: ['template', 'step', 'result'],\n  });\n\n  async function taskStart(task: TaskContext) {\n    await task.emitLog(`Starting up task with ${task.spec.steps.length} steps`);\n    const template = task.spec.templateInfo?.entityRef || '';\n    const user = task.spec.user?.ref || '';\n\n    const taskTimer = taskDuration.startTimer({\n      template,\n    });\n\n    async function skipDryRun(\n      step: TaskStep,\n      action: TemplateAction<JsonObject>,\n    ) {\n      task.emitLog(`Skipping because ${action.id} does not support dry-run`, {\n        stepId: step.id,\n        status: 'skipped',\n      });\n    }\n\n    async function markSuccessful() {\n      taskCount.inc({\n        template,\n        user,\n        result: 'ok',\n      });\n      taskTimer({ result: 'ok' });\n    }\n\n    async function markFailed(step: TaskStep, err: Error) {\n      await task.emitLog(String(err.stack), {\n        stepId: step.id,\n        status: 'failed',\n      });\n      taskCount.inc({\n        template,\n        user,\n        result: 'failed',\n      });\n      taskTimer({ result: 'failed' });\n    }\n\n    async function markCancelled(step: TaskStep) {\n      await task.emitLog(`Step ${step.id} has been cancelled.`, {\n        stepId: step.id,\n        status: 'cancelled',\n      });\n      taskCount.inc({\n        template,\n        user,\n        result: 'cancelled',\n      });\n      taskTimer({ result: 'cancelled' });\n    }\n\n    return {\n      skipDryRun,\n      markCancelled,\n      markSuccessful,\n      markFailed,\n    };\n  }\n\n  async function stepStart(task: TaskContext, step: TaskStep) {\n    await task.emitLog(`Beginning step ${step.name}`, {\n      stepId: step.id,\n      status: 'processing',\n    });\n    const template = task.spec.templateInfo?.entityRef || '';\n\n    const stepTimer = stepDuration.startTimer({\n      template,\n      step: step.name,\n    });\n\n    async function markSuccessful() {\n      await task.emitLog(`Finished step ${step.name}`, {\n        stepId: step.id,\n        status: 'completed',\n      });\n      stepCount.inc({\n        template,\n        step: step.name,\n        result: 'ok',\n      });\n      stepTimer({ result: 'ok' });\n    }\n\n    async function markCancelled() {\n      stepCount.inc({\n        template,\n        step: step.name,\n        result: 'cancelled',\n      });\n      stepTimer({ result: 'cancelled' });\n    }\n\n    async function markFailed() {\n      stepCount.inc({\n        template,\n        step: step.name,\n        result: 'failed',\n      });\n      stepTimer({ result: 'failed' });\n    }\n\n    async function skipFalsy() {\n      await task.emitLog(\n        `Skipping step ${step.id} because its if condition was false`,\n        { stepId: step.id, status: 'skipped' },\n      );\n      stepTimer({ result: 'skipped' });\n    }\n\n    return {\n      markCancelled,\n      markFailed,\n      markSuccessful,\n      skipFalsy,\n    };\n  }\n\n  return {\n    taskStart,\n    stepStart,\n  };\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TaskContext, TaskBroker, WorkflowRunner } from './types';\nimport PQueue from 'p-queue';\nimport { NunjucksWorkflowRunner } from './NunjucksWorkflowRunner';\nimport { Logger } from 'winston';\nimport { TemplateActionRegistry } from '../actions';\nimport { ScmIntegrations } from '@backstage/integration';\nimport { assertError } from '@backstage/errors';\nimport { TemplateFilter, TemplateGlobal } from '../../lib';\nimport { PermissionEvaluator } from '@backstage/plugin-permission-common';\n/**\n * TaskWorkerOptions\n *\n * @public\n */\nexport type TaskWorkerOptions = {\n  taskBroker: TaskBroker;\n  runners: {\n    workflowRunner: WorkflowRunner;\n  };\n  concurrentTasksLimit: number;\n  permissions?: PermissionEvaluator;\n};\n\n/**\n * CreateWorkerOptions\n *\n * @public\n */\nexport type CreateWorkerOptions = {\n  taskBroker: TaskBroker;\n  actionRegistry: TemplateActionRegistry;\n  integrations: ScmIntegrations;\n  workingDirectory: string;\n  logger: Logger;\n  additionalTemplateFilters?: Record<string, TemplateFilter>;\n  /**\n   * The number of tasks that can be executed at the same time by the worker\n   * @defaultValue 10\n   * @example\n   * ```\n   * {\n   *   concurrentTasksLimit: 1,\n   *   // OR\n   *   concurrentTasksLimit: Infinity\n   * }\n   * ```\n   */\n  concurrentTasksLimit?: number;\n  additionalTemplateGlobals?: Record<string, TemplateGlobal>;\n  permissions?: PermissionEvaluator;\n};\n\n/**\n * TaskWorker\n *\n * @public\n */\nexport class TaskWorker {\n  private taskQueue: PQueue;\n\n  private constructor(private readonly options: TaskWorkerOptions) {\n    this.taskQueue = new PQueue({\n      concurrency: options.concurrentTasksLimit,\n    });\n  }\n\n  static async create(options: CreateWorkerOptions): Promise<TaskWorker> {\n    const {\n      taskBroker,\n      logger,\n      actionRegistry,\n      integrations,\n      workingDirectory,\n      additionalTemplateFilters,\n      concurrentTasksLimit = 10, // from 1 to Infinity\n      additionalTemplateGlobals,\n      permissions,\n    } = options;\n\n    const workflowRunner = new NunjucksWorkflowRunner({\n      actionRegistry,\n      integrations,\n      logger,\n      workingDirectory,\n      additionalTemplateFilters,\n      additionalTemplateGlobals,\n      permissions,\n    });\n\n    return new TaskWorker({\n      taskBroker: taskBroker,\n      runners: { workflowRunner },\n      concurrentTasksLimit,\n      permissions,\n    });\n  }\n\n  start() {\n    (async () => {\n      for (;;) {\n        await this.onReadyToClaimTask();\n        const task = await this.options.taskBroker.claim();\n        this.taskQueue.add(() => this.runOneTask(task));\n      }\n    })();\n  }\n\n  protected onReadyToClaimTask(): Promise<void> {\n    if (this.taskQueue.pending < this.options.concurrentTasksLimit) {\n      return Promise.resolve();\n    }\n    return new Promise(resolve => {\n      // \"next\" event emits when a task completes\n      // https://github.com/sindresorhus/p-queue#next\n      this.taskQueue.once('next', () => {\n        resolve();\n      });\n    });\n  }\n\n  async runOneTask(task: TaskContext) {\n    try {\n      if (task.spec.apiVersion !== 'scaffolder.backstage.io/v1beta3') {\n        throw new Error(\n          `Unsupported Template apiVersion ${task.spec.apiVersion}`,\n        );\n      }\n\n      const { output } = await this.options.runners.workflowRunner.execute(\n        task,\n      );\n\n      await task.complete('completed', { output });\n    } catch (error) {\n      assertError(error);\n      await task.complete('failed', {\n        error: { name: error.name, message: error.message },\n      });\n    }\n  }\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TemplateAction } from '@backstage/plugin-scaffolder-node';\nimport { TemplateActionRegistry } from '../actions';\n\n/** @internal */\nexport class DecoratedActionsRegistry extends TemplateActionRegistry {\n  constructor(\n    private readonly innerRegistry: TemplateActionRegistry,\n    extraActions: Array<TemplateAction>,\n  ) {\n    super();\n    for (const action of extraActions) {\n      this.register(action);\n    }\n  }\n\n  get(actionId: string): TemplateAction {\n    try {\n      return super.get(actionId);\n    } catch {\n      return this.innerRegistry.get(actionId);\n    }\n  }\n}\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ScmIntegrations } from '@backstage/integration';\nimport { TaskSpec } from '@backstage/plugin-scaffolder-common';\nimport { JsonObject } from '@backstage/types';\nimport { v4 as uuid } from 'uuid';\nimport { pathToFileURL } from 'url';\nimport { Logger } from 'winston';\nimport {\n  deserializeDirectoryContents,\n  SerializedFile,\n  serializeDirectoryContents,\n} from '../../lib/files';\nimport { TemplateFilter, TemplateGlobal } from '../../lib';\nimport { TemplateActionRegistry } from '../actions';\nimport { NunjucksWorkflowRunner } from '../tasks/NunjucksWorkflowRunner';\nimport { DecoratedActionsRegistry } from './DecoratedActionsRegistry';\nimport fs from 'fs-extra';\nimport { resolveSafeChildPath } from '@backstage/backend-common';\nimport {\n  createTemplateAction,\n  TaskSecrets,\n} from '@backstage/plugin-scaffolder-node';\nimport { PermissionEvaluator } from '@backstage/plugin-permission-common';\n\ninterface DryRunInput {\n  spec: TaskSpec;\n  secrets?: TaskSecrets;\n  directoryContents: SerializedFile[];\n}\n\ninterface DryRunResult {\n  log: Array<{ body: JsonObject }>;\n  directoryContents: SerializedFile[];\n  output: JsonObject;\n}\n\n/** @internal */\nexport type TemplateTesterCreateOptions = {\n  logger: Logger;\n  integrations: ScmIntegrations;\n  actionRegistry: TemplateActionRegistry;\n  workingDirectory: string;\n  additionalTemplateFilters?: Record<string, TemplateFilter>;\n  additionalTemplateGlobals?: Record<string, TemplateGlobal>;\n  permissions?: PermissionEvaluator;\n};\n\n/**\n * Executes a dry-run of the provided template.\n *\n * The provided content will be extracted into a temporary directory\n * which is then use as the base for any relative file fetch paths.\n *\n * @internal\n */\nexport function createDryRunner(options: TemplateTesterCreateOptions) {\n  return async function dryRun(input: DryRunInput): Promise<DryRunResult> {\n    let contentPromise;\n\n    const workflowRunner = new NunjucksWorkflowRunner({\n      ...options,\n      actionRegistry: new DecoratedActionsRegistry(options.actionRegistry, [\n        createTemplateAction({\n          id: 'dry-run:extract',\n          supportsDryRun: true,\n          async handler(ctx) {\n            contentPromise = serializeDirectoryContents(ctx.workspacePath);\n            await contentPromise.catch(() => {});\n          },\n        }),\n      ]),\n    });\n\n    const dryRunId = uuid();\n    const log = new Array<{ body: JsonObject }>();\n    const contentsPath = resolveSafeChildPath(\n      options.workingDirectory,\n      `dry-run-content-${dryRunId}`,\n    );\n\n    try {\n      await deserializeDirectoryContents(contentsPath, input.directoryContents);\n\n      const abortSignal = new AbortController().signal;\n\n      const result = await workflowRunner.execute({\n        spec: {\n          ...input.spec,\n          steps: [\n            ...input.spec.steps,\n            {\n              id: dryRunId,\n              name: 'dry-run:extract',\n              action: 'dry-run:extract',\n            },\n          ],\n          templateInfo: {\n            entityRef: 'template:default/dry-run',\n            baseUrl: pathToFileURL(\n              resolveSafeChildPath(contentsPath, 'template.yaml'),\n            ).toString(),\n          },\n        },\n        secrets: input.secrets,\n        // No need to update this at the end of the run, so just hard-code it\n        done: false,\n        isDryRun: true,\n        getWorkspaceName: async () => `dry-run-${dryRunId}`,\n        cancelSignal: abortSignal,\n        async emitLog(message: string, logMetadata?: JsonObject) {\n          if (logMetadata?.stepId === dryRunId) {\n            return;\n          }\n          log.push({\n            body: {\n              ...logMetadata,\n              message,\n            },\n          });\n        },\n        complete: async () => {\n          throw new Error('Not implemented');\n        },\n      });\n\n      if (!contentPromise) {\n        throw new Error('Content extraction step was skipped');\n      }\n      const directoryContents = await contentPromise;\n\n      return {\n        log,\n        directoryContents,\n        output: result.output,\n      };\n    } finally {\n      await fs.remove(contentsPath);\n    }\n  };\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CatalogApi } from '@backstage/catalog-client';\nimport {\n  Entity,\n  ANNOTATION_LOCATION,\n  parseLocationRef,\n  ANNOTATION_SOURCE_LOCATION,\n  CompoundEntityRef,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport { Config } from '@backstage/config';\nimport { assertError, InputError, NotFoundError } from '@backstage/errors';\nimport { TemplateEntityV1beta3 } from '@backstage/plugin-scaffolder-common';\nimport fs from 'fs-extra';\nimport os from 'os';\nimport { Logger } from 'winston';\n\nexport async function getWorkingDirectory(\n  config: Config,\n  logger: Logger,\n): Promise<string> {\n  if (!config.has('backend.workingDirectory')) {\n    return os.tmpdir();\n  }\n\n  const workingDirectory = config.getString('backend.workingDirectory');\n  try {\n    // Check if working directory exists and is writable\n    await fs.access(workingDirectory, fs.constants.F_OK | fs.constants.W_OK);\n    logger.info(`using working directory: ${workingDirectory}`);\n  } catch (err) {\n    assertError(err);\n    logger.error(\n      `working directory ${workingDirectory} ${\n        err.code === 'ENOENT' ? 'does not exist' : 'is not writable'\n      }`,\n    );\n    throw err;\n  }\n  return workingDirectory;\n}\n\n/**\n * Gets the base URL of the entity location that points to the source location\n * of the entity description within a repo. If there is not source location\n * or if it has an invalid type, undefined will be returned instead.\n *\n * For file locations this will return a `file://` URL.\n */\nexport function getEntityBaseUrl(entity: Entity): string | undefined {\n  let location = entity.metadata.annotations?.[ANNOTATION_SOURCE_LOCATION];\n  if (!location) {\n    location = entity.metadata.annotations?.[ANNOTATION_LOCATION];\n  }\n  if (!location) {\n    return undefined;\n  }\n\n  const { type, target } = parseLocationRef(location);\n  if (type === 'url') {\n    return target;\n  } else if (type === 'file') {\n    return `file://${target}`;\n  }\n\n  // Only url and file location are handled, as we otherwise don't know if\n  // what the url is pointing to makes sense to use as a baseUrl\n  return undefined;\n}\n\n/**\n * Will use the provided CatalogApi to go find the given template entity with an additional token.\n * Returns the matching template, or throws a NotFoundError if no such template existed.\n */\nexport async function findTemplate(options: {\n  entityRef: CompoundEntityRef;\n  token?: string;\n  catalogApi: CatalogApi;\n}): Promise<TemplateEntityV1beta3> {\n  const { entityRef, token, catalogApi } = options;\n\n  if (entityRef.kind.toLocaleLowerCase('en-US') !== 'template') {\n    throw new InputError(`Invalid kind, only 'Template' kind is supported`);\n  }\n\n  const template = await catalogApi.getEntityByRef(entityRef, { token });\n  if (!template) {\n    throw new NotFoundError(\n      `Template ${stringifyEntityRef(entityRef)} not found`,\n    );\n  }\n\n  return template as TemplateEntityV1beta3;\n}\n\nexport type TemplateTransform = (\n  template: TemplateEntityV1beta3,\n) => TemplateEntityV1beta3;\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { PluginDatabaseManager, UrlReader } from '@backstage/backend-common';\nimport { PluginTaskScheduler } from '@backstage/backend-tasks';\nimport { CatalogApi } from '@backstage/catalog-client';\nimport {\n  CompoundEntityRef,\n  Entity,\n  parseEntityRef,\n  stringifyEntityRef,\n  UserEntity,\n} from '@backstage/catalog-model';\nimport { Config } from '@backstage/config';\nimport { InputError, NotFoundError, stringifyError } from '@backstage/errors';\nimport { ScmIntegrations } from '@backstage/integration';\nimport { JsonObject, JsonValue } from '@backstage/types';\nimport {\n  TaskSpec,\n  TemplateEntityV1beta3,\n  templateEntityV1beta3Validator,\n  TemplateParametersV1beta3,\n  TemplateEntityStepV1beta3,\n} from '@backstage/plugin-scaffolder-common';\nimport {\n  RESOURCE_TYPE_SCAFFOLDER_ACTION,\n  RESOURCE_TYPE_SCAFFOLDER_TEMPLATE,\n  scaffolderActionPermissions,\n  scaffolderTemplatePermissions,\n  templateParameterReadPermission,\n  templateStepReadPermission,\n} from '@backstage/plugin-scaffolder-common/alpha';\nimport express from 'express';\nimport Router from 'express-promise-router';\nimport { validate } from 'jsonschema';\nimport { Logger } from 'winston';\nimport { z } from 'zod';\nimport { TemplateFilter, TemplateGlobal } from '../lib';\nimport {\n  createBuiltinActions,\n  DatabaseTaskStore,\n  TaskBroker,\n  TaskWorker,\n  TemplateActionRegistry,\n} from '../scaffolder';\nimport { createDryRunner } from '../scaffolder/dryrun';\nimport { StorageTaskBroker } from '../scaffolder/tasks/StorageTaskBroker';\nimport { findTemplate, getEntityBaseUrl, getWorkingDirectory } from './helpers';\nimport {\n  IdentityApi,\n  IdentityApiGetIdentityRequest,\n} from '@backstage/plugin-auth-node';\nimport { TemplateAction } from '@backstage/plugin-scaffolder-node';\nimport {\n  PermissionEvaluator,\n  PermissionRuleParams,\n} from '@backstage/plugin-permission-common';\nimport {\n  createConditionAuthorizer,\n  createPermissionIntegrationRouter,\n  PermissionRule,\n} from '@backstage/plugin-permission-node';\nimport { scaffolderActionRules, scaffolderTemplateRules } from './rules';\n\n/**\n *\n * @public\n */\nexport type TemplatePermissionRuleInput<\n  TParams extends PermissionRuleParams = PermissionRuleParams,\n> = PermissionRule<\n  TemplateEntityStepV1beta3 | TemplateParametersV1beta3,\n  {},\n  typeof RESOURCE_TYPE_SCAFFOLDER_TEMPLATE,\n  TParams\n>;\nfunction isTemplatePermissionRuleInput(\n  permissionRule: TemplatePermissionRuleInput | ActionPermissionRuleInput,\n): permissionRule is TemplatePermissionRuleInput {\n  return permissionRule.resourceType === RESOURCE_TYPE_SCAFFOLDER_TEMPLATE;\n}\n\n/**\n *\n * @public\n */\nexport type ActionPermissionRuleInput<\n  TParams extends PermissionRuleParams = PermissionRuleParams,\n> = PermissionRule<\n  TemplateEntityStepV1beta3 | TemplateParametersV1beta3,\n  {},\n  typeof RESOURCE_TYPE_SCAFFOLDER_ACTION,\n  TParams\n>;\nfunction isActionPermissionRuleInput(\n  permissionRule: TemplatePermissionRuleInput | ActionPermissionRuleInput,\n): permissionRule is ActionPermissionRuleInput {\n  return permissionRule.resourceType === RESOURCE_TYPE_SCAFFOLDER_ACTION;\n}\n\n/**\n * RouterOptions\n *\n * @public\n */\nexport interface RouterOptions {\n  logger: Logger;\n  config: Config;\n  reader: UrlReader;\n  database: PluginDatabaseManager;\n  catalogClient: CatalogApi;\n  scheduler?: PluginTaskScheduler;\n  actions?: TemplateAction<any, any>[];\n  /**\n   * @deprecated taskWorkers is deprecated in favor of concurrentTasksLimit option with a single TaskWorker\n   * @defaultValue 1\n   */\n  taskWorkers?: number;\n  /**\n   * Sets the number of concurrent tasks that can be run at any given time on the TaskWorker\n   * @defaultValue 10\n   */\n  concurrentTasksLimit?: number;\n  taskBroker?: TaskBroker;\n  additionalTemplateFilters?: Record<string, TemplateFilter>;\n  additionalTemplateGlobals?: Record<string, TemplateGlobal>;\n  permissions?: PermissionEvaluator;\n  permissionRules?: Array<\n    TemplatePermissionRuleInput | ActionPermissionRuleInput\n  >;\n  identity?: IdentityApi;\n}\n\nfunction isSupportedTemplate(entity: TemplateEntityV1beta3) {\n  return entity.apiVersion === 'scaffolder.backstage.io/v1beta3';\n}\n\n/*\n * @deprecated This function remains as the DefaultIdentityClient behaves slightly differently to the pre-existing\n * scaffolder behaviour. Specifically if the token fails to parse, the DefaultIdentityClient will raise an error.\n * The scaffolder did not raise an error in this case. As such we chose to allow it to behave as it did previously\n * until someone explicitly passes an IdentityApi. When we have reasonable confidence that most backstage deployments\n * are using the IdentityApi, we can remove this function.\n */\nfunction buildDefaultIdentityClient(options: RouterOptions): IdentityApi {\n  return {\n    getIdentity: async ({ request }: IdentityApiGetIdentityRequest) => {\n      const header = request.headers.authorization;\n      const { logger } = options;\n\n      if (!header) {\n        return undefined;\n      }\n\n      try {\n        const token = header.match(/^Bearer\\s(\\S+\\.\\S+\\.\\S+)$/i)?.[1];\n        if (!token) {\n          throw new TypeError('Expected Bearer with JWT');\n        }\n\n        const [_header, rawPayload, _signature] = token.split('.');\n        const payload: JsonValue = JSON.parse(\n          Buffer.from(rawPayload, 'base64').toString(),\n        );\n\n        if (\n          typeof payload !== 'object' ||\n          payload === null ||\n          Array.isArray(payload)\n        ) {\n          throw new TypeError('Malformed JWT payload');\n        }\n\n        const sub = payload.sub;\n        if (typeof sub !== 'string') {\n          throw new TypeError('Expected string sub claim');\n        }\n\n        if (sub === 'backstage-server') {\n          return undefined;\n        }\n\n        // Check that it's a valid ref, otherwise this will throw.\n        parseEntityRef(sub);\n\n        return {\n          identity: {\n            userEntityRef: sub,\n            ownershipEntityRefs: [],\n            type: 'user',\n          },\n          token,\n        };\n      } catch (e) {\n        logger.error(`Invalid authorization header: ${stringifyError(e)}`);\n        return undefined;\n      }\n    },\n  };\n}\n\n/**\n * A method to create a router for the scaffolder backend plugin.\n * @public\n */\nexport async function createRouter(\n  options: RouterOptions,\n): Promise<express.Router> {\n  const router = Router();\n  // Be generous in upload size to support a wide range of templates in dry-run mode.\n  router.use(express.json({ limit: '10MB' }));\n\n  const {\n    logger: parentLogger,\n    config,\n    reader,\n    database,\n    catalogClient,\n    actions,\n    taskWorkers,\n    concurrentTasksLimit,\n    scheduler,\n    additionalTemplateFilters,\n    additionalTemplateGlobals,\n    permissions,\n    permissionRules,\n  } = options;\n\n  const logger = parentLogger.child({ plugin: 'scaffolder' });\n\n  const identity: IdentityApi =\n    options.identity || buildDefaultIdentityClient(options);\n  const workingDirectory = await getWorkingDirectory(config, logger);\n  const integrations = ScmIntegrations.fromConfig(config);\n\n  let taskBroker: TaskBroker;\n  if (!options.taskBroker) {\n    const databaseTaskStore = await DatabaseTaskStore.create({ database });\n    taskBroker = new StorageTaskBroker(databaseTaskStore, logger);\n\n    if (scheduler && databaseTaskStore.listStaleTasks) {\n      await scheduler.scheduleTask({\n        id: 'close_stale_tasks',\n        frequency: { cron: '*/5 * * * *' }, // every 5 minutes, also supports Duration\n        timeout: { minutes: 15 },\n        fn: async () => {\n          const { tasks } = await databaseTaskStore.listStaleTasks({\n            timeoutS: 86400,\n          });\n\n          for (const task of tasks) {\n            await databaseTaskStore.shutdownTask(task);\n            logger.info(`Successfully closed stale task ${task.taskId}`);\n          }\n        },\n      });\n    }\n  } else {\n    taskBroker = options.taskBroker;\n  }\n\n  const actionRegistry = new TemplateActionRegistry();\n\n  const workers = [];\n  for (let i = 0; i < (taskWorkers || 1); i++) {\n    const worker = await TaskWorker.create({\n      taskBroker,\n      actionRegistry,\n      integrations,\n      logger,\n      workingDirectory,\n      additionalTemplateFilters,\n      additionalTemplateGlobals,\n      concurrentTasksLimit,\n      permissions,\n    });\n    workers.push(worker);\n  }\n\n  const actionsToRegister = Array.isArray(actions)\n    ? actions\n    : createBuiltinActions({\n        integrations,\n        catalogClient,\n        reader,\n        config,\n        additionalTemplateFilters,\n        additionalTemplateGlobals,\n      });\n\n  actionsToRegister.forEach(action => actionRegistry.register(action));\n  workers.forEach(worker => worker.start());\n\n  const dryRunner = createDryRunner({\n    actionRegistry,\n    integrations,\n    logger,\n    workingDirectory,\n    additionalTemplateFilters,\n    additionalTemplateGlobals,\n    permissions,\n  });\n\n  const templateRules: TemplatePermissionRuleInput[] = Object.values(\n    scaffolderTemplateRules,\n  );\n  const actionRules: ActionPermissionRuleInput[] = Object.values(\n    scaffolderActionRules,\n  );\n\n  if (permissionRules) {\n    templateRules.push(\n      ...permissionRules.filter(isTemplatePermissionRuleInput),\n    );\n    actionRules.push(...permissionRules.filter(isActionPermissionRuleInput));\n  }\n\n  const isAuthorized = createConditionAuthorizer(Object.values(templateRules));\n\n  const permissionIntegrationRouter = createPermissionIntegrationRouter({\n    resources: [\n      {\n        resourceType: RESOURCE_TYPE_SCAFFOLDER_TEMPLATE,\n        permissions: scaffolderTemplatePermissions,\n        rules: templateRules,\n      },\n      {\n        resourceType: RESOURCE_TYPE_SCAFFOLDER_ACTION,\n        permissions: scaffolderActionPermissions,\n        rules: actionRules,\n      },\n    ],\n  });\n\n  router.use(permissionIntegrationRouter);\n\n  router\n    .get(\n      '/v2/templates/:namespace/:kind/:name/parameter-schema',\n      async (req, res) => {\n        const userIdentity = await identity.getIdentity({\n          request: req,\n        });\n        const token = userIdentity?.token;\n\n        const template = await authorizeTemplate(req.params, token);\n\n        const parameters = [template.spec.parameters ?? []].flat();\n        res.json({\n          title: template.metadata.title ?? template.metadata.name,\n          description: template.metadata.description,\n          'ui:options': template.metadata['ui:options'],\n          steps: parameters.map(schema => ({\n            title: schema.title ?? 'Please enter the following information',\n            description: schema.description,\n            schema,\n          })),\n        });\n      },\n    )\n    .get('/v2/actions', async (_req, res) => {\n      const actionsList = actionRegistry.list().map(action => {\n        return {\n          id: action.id,\n          description: action.description,\n          examples: action.examples,\n          schema: action.schema,\n        };\n      });\n      res.json(actionsList);\n    })\n    .post('/v2/tasks', async (req, res) => {\n      const templateRef: string = req.body.templateRef;\n      const { kind, namespace, name } = parseEntityRef(templateRef, {\n        defaultKind: 'template',\n      });\n\n      const callerIdentity = await identity.getIdentity({\n        request: req,\n      });\n      const token = callerIdentity?.token;\n      const userEntityRef = callerIdentity?.identity.userEntityRef;\n\n      const userEntity = userEntityRef\n        ? await catalogClient.getEntityByRef(userEntityRef, { token })\n        : undefined;\n\n      let auditLog = `Scaffolding task for ${templateRef}`;\n      if (userEntityRef) {\n        auditLog += ` created by ${userEntityRef}`;\n      }\n      logger.info(auditLog);\n\n      const values = req.body.values;\n\n      const template = await authorizeTemplate(\n        { kind, namespace, name },\n        token,\n      );\n\n      for (const parameters of [template.spec.parameters ?? []].flat()) {\n        const result = validate(values, parameters);\n\n        if (!result.valid) {\n          res.status(400).json({ errors: result.errors });\n          return;\n        }\n      }\n\n      const baseUrl = getEntityBaseUrl(template);\n\n      const taskSpec: TaskSpec = {\n        apiVersion: template.apiVersion,\n        steps: template.spec.steps.map((step, index) => ({\n          ...step,\n          id: step.id ?? `step-${index + 1}`,\n          name: step.name ?? step.action,\n        })),\n        output: template.spec.output ?? {},\n        parameters: values,\n        user: {\n          entity: userEntity as UserEntity,\n          ref: userEntityRef,\n        },\n        templateInfo: {\n          entityRef: stringifyEntityRef({ kind, name, namespace }),\n          baseUrl,\n          entity: {\n            metadata: template.metadata,\n          },\n        },\n      };\n\n      const result = await taskBroker.dispatch({\n        spec: taskSpec,\n        createdBy: userEntityRef,\n        secrets: {\n          ...req.body.secrets,\n          backstageToken: token,\n        },\n      });\n\n      res.status(201).json({ id: result.taskId });\n    })\n    .get('/v2/tasks', async (req, res) => {\n      const [userEntityRef] = [req.query.createdBy].flat();\n\n      if (\n        typeof userEntityRef !== 'string' &&\n        typeof userEntityRef !== 'undefined'\n      ) {\n        throw new InputError('createdBy query parameter must be a string');\n      }\n\n      if (!taskBroker.list) {\n        throw new Error(\n          'TaskBroker does not support listing tasks, please implement the list method on the TaskBroker.',\n        );\n      }\n\n      const tasks = await taskBroker.list({\n        createdBy: userEntityRef,\n      });\n\n      res.status(200).json(tasks);\n    })\n    .get('/v2/tasks/:taskId', async (req, res) => {\n      const { taskId } = req.params;\n      const task = await taskBroker.get(taskId);\n      if (!task) {\n        throw new NotFoundError(`Task with id ${taskId} does not exist`);\n      }\n      // Do not disclose secrets\n      delete task.secrets;\n      res.status(200).json(task);\n    })\n    .post('/v2/tasks/:taskId/cancel', async (req, res) => {\n      const { taskId } = req.params;\n      await taskBroker.cancel?.(taskId);\n      res.status(200).json({ status: 'cancelled' });\n    })\n    .get('/v2/tasks/:taskId/eventstream', async (req, res) => {\n      const { taskId } = req.params;\n      const after =\n        req.query.after !== undefined ? Number(req.query.after) : undefined;\n\n      logger.debug(`Event stream observing taskId '${taskId}' opened`);\n\n      // Mandatory headers and http status to keep connection open\n      res.writeHead(200, {\n        Connection: 'keep-alive',\n        'Cache-Control': 'no-cache',\n        'Content-Type': 'text/event-stream',\n      });\n\n      // After client opens connection send all events as string\n      const subscription = taskBroker.event$({ taskId, after }).subscribe({\n        error: error => {\n          logger.error(\n            `Received error from event stream when observing taskId '${taskId}', ${error}`,\n          );\n          res.end();\n        },\n        next: ({ events }) => {\n          let shouldUnsubscribe = false;\n          for (const event of events) {\n            res.write(\n              `event: ${event.type}\\ndata: ${JSON.stringify(event)}\\n\\n`,\n            );\n            if (event.type === 'completion') {\n              shouldUnsubscribe = true;\n            }\n          }\n          // res.flush() is only available with the compression middleware\n          res.flush?.();\n          if (shouldUnsubscribe) {\n            subscription.unsubscribe();\n            res.end();\n          }\n        },\n      });\n\n      // When client closes connection we update the clients list\n      // avoiding the disconnected one\n      req.on('close', () => {\n        subscription.unsubscribe();\n        logger.debug(`Event stream observing taskId '${taskId}' closed`);\n      });\n    })\n    .get('/v2/tasks/:taskId/events', async (req, res) => {\n      const { taskId } = req.params;\n      const after = Number(req.query.after) || undefined;\n\n      // cancel the request after 30 seconds. this aligns with the recommendations of RFC 6202.\n      const timeout = setTimeout(() => {\n        res.json([]);\n      }, 30_000);\n\n      // Get all known events after an id (always includes the completion event) and return the first callback\n      const subscription = taskBroker.event$({ taskId, after }).subscribe({\n        error: error => {\n          logger.error(\n            `Received error from event stream when observing taskId '${taskId}', ${error}`,\n          );\n        },\n        next: ({ events }) => {\n          clearTimeout(timeout);\n          subscription.unsubscribe();\n          res.json(events);\n        },\n      });\n\n      // When client closes connection we update the clients list\n      // avoiding the disconnected one\n      req.on('close', () => {\n        subscription.unsubscribe();\n        clearTimeout(timeout);\n      });\n    })\n    .post('/v2/dry-run', async (req, res) => {\n      const bodySchema = z.object({\n        template: z.unknown(),\n        values: z.record(z.unknown()),\n        secrets: z.record(z.string()).optional(),\n        directoryContents: z.array(\n          z.object({ path: z.string(), base64Content: z.string() }),\n        ),\n      });\n      const body = await bodySchema.parseAsync(req.body).catch(e => {\n        throw new InputError(`Malformed request: ${e}`);\n      });\n\n      const template = body.template as TemplateEntityV1beta3;\n      if (!(await templateEntityV1beta3Validator.check(template))) {\n        throw new InputError('Input template is not a template');\n      }\n\n      const token = (\n        await identity.getIdentity({\n          request: req,\n        })\n      )?.token;\n\n      for (const parameters of [template.spec.parameters ?? []].flat()) {\n        const result = validate(body.values, parameters);\n        if (!result.valid) {\n          res.status(400).json({ errors: result.errors });\n          return;\n        }\n      }\n\n      const steps = template.spec.steps.map((step, index) => ({\n        ...step,\n        id: step.id ?? `step-${index + 1}`,\n        name: step.name ?? step.action,\n      }));\n\n      const result = await dryRunner({\n        spec: {\n          apiVersion: template.apiVersion,\n          steps,\n          output: template.spec.output ?? {},\n          parameters: body.values as JsonObject,\n        },\n        directoryContents: (body.directoryContents ?? []).map(file => ({\n          path: file.path,\n          content: Buffer.from(file.base64Content, 'base64'),\n        })),\n        secrets: {\n          ...body.secrets,\n          ...(token && { backstageToken: token }),\n        },\n      });\n\n      res.status(200).json({\n        ...result,\n        steps,\n        directoryContents: result.directoryContents.map(file => ({\n          path: file.path,\n          executable: file.executable,\n          base64Content: file.content.toString('base64'),\n        })),\n      });\n    });\n\n  const app = express();\n  app.set('logger', logger);\n  app.use('/', router);\n\n  async function authorizeTemplate(\n    entityRef: CompoundEntityRef,\n    token: string | undefined,\n  ) {\n    const template = await findTemplate({\n      catalogApi: catalogClient,\n      entityRef,\n      token,\n    });\n\n    if (!isSupportedTemplate(template)) {\n      throw new InputError(\n        `Unsupported apiVersion field in schema entity, ${\n          (template as Entity).apiVersion\n        }`,\n      );\n    }\n\n    if (!permissions) {\n      return template;\n    }\n\n    const [parameterDecision, stepDecision] =\n      await permissions.authorizeConditional(\n        [\n          { permission: templateParameterReadPermission },\n          { permission: templateStepReadPermission },\n        ],\n        { token },\n      );\n\n    // Authorize parameters\n    if (Array.isArray(template.spec.parameters)) {\n      template.spec.parameters = template.spec.parameters.filter(step =>\n        isAuthorized(parameterDecision, step),\n      );\n    } else if (\n      template.spec.parameters &&\n      !isAuthorized(parameterDecision, template.spec.parameters)\n    ) {\n      template.spec.parameters = undefined;\n    }\n\n    // Authorize steps\n    template.spec.steps = template.spec.steps.filter(step =>\n      isAuthorized(stepDecision, step),\n    );\n\n    return template;\n  }\n\n  return app;\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Entity,\n  getCompoundEntityRef,\n  parseEntityRef,\n  RELATION_OWNED_BY,\n  RELATION_OWNER_OF,\n} from '@backstage/catalog-model';\nimport {\n  CatalogProcessor,\n  CatalogProcessorEmit,\n  processingResult,\n} from '@backstage/plugin-catalog-node';\nimport { LocationSpec } from '@backstage/plugin-catalog-common';\nimport {\n  TemplateEntityV1beta3,\n  templateEntityV1beta3Validator,\n} from '@backstage/plugin-scaffolder-common';\n\n/** @public */\nexport class ScaffolderEntitiesProcessor implements CatalogProcessor {\n  getProcessorName(): string {\n    return 'ScaffolderEntitiesProcessor';\n  }\n\n  private readonly validators = [templateEntityV1beta3Validator];\n\n  async validateEntityKind(entity: Entity): Promise<boolean> {\n    for (const validator of this.validators) {\n      if (await validator.check(entity)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  async postProcessEntity(\n    entity: Entity,\n    _location: LocationSpec,\n    emit: CatalogProcessorEmit,\n  ): Promise<Entity> {\n    const selfRef = getCompoundEntityRef(entity);\n\n    if (\n      entity.apiVersion === 'scaffolder.backstage.io/v1beta3' &&\n      entity.kind === 'Template'\n    ) {\n      const template = entity as TemplateEntityV1beta3;\n\n      const target = template.spec.owner;\n      if (target) {\n        const targetRef = parseEntityRef(target, {\n          defaultKind: 'Group',\n          defaultNamespace: selfRef.namespace,\n        });\n        emit(\n          processingResult.relation({\n            source: selfRef,\n            type: RELATION_OWNED_BY,\n            target: {\n              kind: targetRef.kind,\n              namespace: targetRef.namespace,\n              name: targetRef.name,\n            },\n          }),\n        );\n        emit(\n          processingResult.relation({\n            source: {\n              kind: targetRef.kind,\n              namespace: targetRef.namespace,\n              name: targetRef.name,\n            },\n            type: RELATION_OWNER_OF,\n            target: selfRef,\n          }),\n        );\n      }\n    }\n\n    return entity;\n  }\n}\n"],"names":["id","examples","yaml","createTemplateAction","InputError","stringifyEntityRef","z","fs","resolveSafeChildPath","parseEntityRef","relative","readdir","join","stat","Duration","_a","path","VM","resolvePackagePath","normalizePath","joinPath","isChildPath","get","globby","extname","isBinaryFile","PassThrough","spawn","Git","assertError","DefaultGithubCredentialsProvider","NotFoundError","Octokit","inputProps.repoUrl","inputProps.description","inputProps.homepage","inputProps.access","inputProps.requireCodeOwnerReviews","inputProps.bypassPullRequestAllowances","inputProps.requiredApprovingReviewCount","inputProps.restrictions","inputProps.requiredStatusCheckContexts","inputProps.requireBranchesToBeUpToDate","inputProps.requiredConversationResolution","inputProps.repoVisibility","inputProps.deleteBranchOnMerge","inputProps.allowMergeCommit","inputProps.allowSquashMerge","inputProps.squashMergeCommitTitle","inputProps.squashMergeCommitMessage","inputProps.allowRebaseMerge","inputProps.allowAutoMerge","inputProps.collaborators","inputProps.hasProjects","inputProps.hasWiki","inputProps.hasIssues","inputProps.token","inputProps.topics","inputProps.requiredCommitSigning","outputProps.remoteUrl","outputProps.repoContentsUrl","inputProps.dismissStaleReviews","inputProps.defaultBranch","inputProps.protectDefaultBranch","inputProps.protectEnforceAdmins","inputProps.gitCommitMessage","inputProps.gitAuthorName","inputProps.gitAuthorEmail","inputProps.sourcePath","outputProps.commitHash","emitterEventNames","getPersonalAccessTokenHandler","WebApi","fetch","getAuthorizationHeader","performEnableLFS","createRepository","getBitbucketServerRequestOptions","getGerritRequestOptions","crypto","limiterFactory","isError","dirname","CustomErrorBase","createPullRequest","Gitlab","ConflictError","DateTime","uuid","ObservableImpl","isArray","register","Counter","Histogram","makeCreatePermissionRule","RESOURCE_TYPE_SCAFFOLDER_TEMPLATE","RESOURCE_TYPE_SCAFFOLDER_ACTION","winston","createConditionAuthorizer","nunjucks","templated","validateJsonSchema","errors","NotAllowedError","actionExecutePermission","AuthorizeResult","PQueue","pathToFileURL","os","ANNOTATION_SOURCE_LOCATION","ANNOTATION_LOCATION","parseLocationRef","stringifyError","Router","express","ScmIntegrations","createPermissionIntegrationRouter","scaffolderTemplatePermissions","scaffolderActionPermissions","result","validate","_b","templateEntityV1beta3Validator","templateParameterReadPermission","templateStepReadPermission","getCompoundEntityRef","processingResult","RELATION_OWNED_BY","RELATION_OWNER_OF"],"mappings":"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"}